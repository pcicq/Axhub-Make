# 需求对齐规则

本文档指导 AI Agent 如何与用户沟通需求，并根据不同的生成模式产出相应的文档。

## 🎯 目标

通过结构化的沟通流程，确保：
1. 准确理解用户需求
2. 明确功能边界和实现细节
3. 根据选择的模式产出相应文档
4. 为后续开发提供明确指引

## 📋 生成模式

系统支持三种生成模式，由用户根据项目需求选择：

| 模式 | 流程 | 使用模板 |
|------|------|----------|
| 模式 1：直接生成 | 用户需求 → spec.md + index.tsx（同时生成） | `assets/templates/all-in-spec-template.md` |
| 模式 2：规格优先 | 用户需求 → spec.md（确认）→ index.tsx | `assets/templates/spec-template.md` |
| 模式 3：完整流程 | 用户需求 → prd.md（确认）→ spec.md（确认）→ index.tsx | PRD: `assets/templates/prd-template.md`<br>Spec: `assets/templates/spec-template.md` |

## 📝 沟通流程

### 需求确认清单

#### 1. 核心功能
- [ ] 核心功能：一句话描述主要功能
- [ ] 关键功能点：列出 3-5 个核心功能

#### 2. 交互与数据
- [ ] 用户操作：可进行哪些操作？
- [ ] 事件响应：需要响应哪些事件及预期结果？
- [ ] 输入数据：接收哪些数据（结构、字段、类型、必填/可选）？
- [ ] 输出变量：暴露哪些变量（状态、计算结果）？

#### 3. 配置与样式
- [ ] 配置项：文本内容、样式配置、行为配置
- [ ] 视觉样式：用一句话描述整体视觉风格和布局
- [ ] 边界情况：空数据、错误状态的处理方式

### 沟通策略

#### 前置准备

**在提问之前，必须充分阅读用户提供的所有资料**：

- [ ] 检查用户是否提供了参考文档、设计稿、原型链接
- [ ] 如 Prompt 中包含“关联内容”，必须先阅读这些页面/元素的 `spec.md` 与 `index.tsx`
- [ ] 仔细阅读所有提供的资料，理解已有信息
- [ ] 识别资料中已经明确的需求点
- [ ] 只针对资料中未明确的部分进行提问

**原则**：
- 不要询问资料中已经说明的内容
- 基于已有信息进行深入提问
- 展示你已经理解了提供的资料

**示例**：
```
❌ 错误：用户提供了设计稿，但仍然问"需要什么样式？"
✅ 正确：用户提供了设计稿，说"我看到设计稿中使用了蓝色主题和圆角按钮，请问..."
```

#### 分阶段沟通

| 阶段 | 重点 | 方法 |
|------|------|------|
| 初步理解 | 类型、核心功能 | 确认大方向，避免细节 |
| 功能细节 | 交互、数据、配置 | 逐项确认，使用示例 |
| 视觉规范 | 样式、布局 | 参考设计系统 |
| 技术约束 | 兼容性、性能 | 明确限制和建议 |

## 🔗 关联内容使用规则

当 Prompt 提供了“关联内容”（页面/元素列表）时，视为强约束与重要上下文：

- **同步修改**：若新需求会影响关联内容（数据结构、组件 API、样式 Token、公共状态等），需要同步评估并在实现中一起修改，避免引入不一致或破坏性变更
- **引用与复用**：优先复用关联内容中已经存在的组件、工具函数、样式写法与交互模式，减少重复实现
- **辅助参考**：当需求描述不完整时，可用关联内容推断默认行为与视觉规范，但仍需对不确定点向用户确认
- **文档表达**：在 `spec.md` 中显式列出相关联的页面/元素，并说明依赖关系、影响面与兼容性策略

## 📄 文档模板

根据选择的生成模式，使用对应的模板：

| 模式 | 文档类型 | 模板路径 |
|------|----------|----------|
| 直接生成 | Spec | `assets/templates/all-in-spec-template.md` |
| 规格优先 | Spec | `assets/templates/spec-template.md` |
| 完整流程 | PRD | `assets/templates/prd-template.md` |
| 完整流程 | Spec | `assets/templates/spec-template.md` |

### 模板使用说明

- **all-in-spec-template.md**：包含业务需求和技术规格的一体化模板
- **prd-template.md**：专注于业务需求，不涉及技术实现
- **spec-template.md**：专注于技术规格，可选地引用 PRD

## ✅ 检查清单

### 功能完整性
- [ ] 核心功能描述清晰
- [ ] 所有交互行为已定义
- [ ] 边界情况已考虑（空数据、错误状态）

### 接口定义
- [ ] 事件列表完整（触发时机、数据结构）
- [ ] 动作列表完整（参数说明）
- [ ] 变量列表完整（数据类型）
- [ ] 配置项列表完整（默认值）

### 数据结构
- [ ] 输入数据格式明确
- [ ] 字段类型和必填项已标注
- [ ] 提供了示例数据

### 视觉规范
- [ ] 样式要求明确
- [ ] 色彩方案确定
- [ ] 布局方式清晰

### 技术可行性
- [ ] 技术方案可行
- [ ] 性能要求合理
- [ ] 兼容性要求明确

### 文档规范
- [ ] 未使用 Markdown 链接格式引用其他文档
- [ ] 使用纯文本提及关联文档名称

## 💡 最佳实践

- **渐进式沟通**：先确认大方向（类型、核心功能），再深入细节（交互、数据），最后确认视觉和技术约束
- **使用示例**：提供类似组件的参考，用具体场景举例说明，展示数据结构示例
- **确认理解**：复述用户需求确认理解正确，对模糊需求主动提出澄清问题，对冲突需求指出并协商解决方案
- **管理预期**：明确技术限制和实现难度，对复杂需求提出分阶段实现建议，说明可能的性能影响
- **文档链接规范**：在生成的文档中不要使用 Markdown 链接格式（如 `[文档](./path.md)`），直接使用纯文本提及文档名称（如 `详见 prd.md`）
- **可视化流程**：涉及复杂流程、状态转换或多步骤交互时，使用 Mermaid 图表（flowchart、stateDiagram、sequenceDiagram 等）辅助说明

## 常见错误

| 错误类型 | 错误做法 | 正确做法 |
|----------|----------|----------|
| 未读用户资料 | 用户提供了设计稿，仍然问"需要什么样式？" | 先阅读设计稿，基于设计稿内容提问 |
| 需求理解不充分 | 用户说"做一个按钮"，立即开始写代码 | 询问按钮的用途、样式、交互行为 |
| 文档不完整 | 只写功能描述，没有事件和动作列表 | 按照模板完整填写所有章节 |

## 示例对话

**Agent**: 您好！我了解到您需要创建一个按钮组件。这是一个可复用的元素，对吗？

**User**: 是的，一个通用按钮。

**Agent**: 好的。请问需要哪些样式类型？是否需要禁用状态？点击后触发什么事件？

**User**: 需要主要和次要两种样式，要支持禁用状态，点击后触发 onClick 事件。

**Agent**: 明白了。按钮文字和颜色是否可配置？是否需要暴露内部状态？

**User**: 文字和颜色可配置，暴露点击次数。

**Agent**: 完美！我现在为您生成 spec 文档和代码实现...