# 需求对齐规则

本文档指导 AI Agent 如何与用户沟通需求，并产出完整的 spec 文档。

## 🎯 目标

通过结构化的沟通流程，确保：
1. 准确理解用户需求
2. 明确功能边界和实现细节
3. 产出清晰、完整的 spec.md 文档
4. 为后续开发提供明确指引

## 📝 沟通流程

### 1. 需求初步理解

**询问关键问题：**

- **类型确认**：这是一个元素（Element）还是页面（Page）？
  - 元素：可复用的独立组件（如按钮、表单、图表）
  - 页面：完整的业务页面（如用户列表、数据看板）

- **核心功能**：主要实现什么功能？
  - 用一句话描述核心价值
  - 列出 3-5 个关键功能点

- **使用场景**：在什么场景下使用？
  - 目标用户是谁
  - 典型使用流程

### 2. 功能细节确认

**交互行为：**

- 用户可以进行哪些操作？
  - 点击、输入、拖拽、选择等
  - 每个操作的预期结果

- 需要响应哪些事件？
  - 点击事件、输入事件、状态变化事件等
  - 事件触发时机和传递的数据

**数据流转：**

- 需要接收哪些数据？
  - 数据结构和字段说明
  - 必填项和可选项
  - 数据格式要求

- 需要暴露哪些变量？
  - 组件内部状态
  - 计算结果
  - 选中项等

**配置选项：**

- 需要哪些可配置项？
  - 文本内容（标题、按钮文字等）
  - 样式配置（颜色、尺寸等）
  - 行为配置（是否可编辑、最大值等）

### 3. 视觉和样式

**外观要求：**

- 整体风格：现代化、扁平化、拟物化？
- 色彩方案：主色调、辅助色
- 布局方式：横向、纵向、网格、自由布局
- 响应式需求：是否需要适配不同屏幕尺寸

**参考设计：**

- 是否有参考的 UI 设计？
- 是否需要遵循特定的设计系统（如 Ant Design、Material Design）？


## 📄 Spec 文档模板

根据沟通结果,产出 spec.md 文档。

**请查看 `docs/spec-template.md` 了解完整的文档模板结构。**

## 视觉设计

- **主色调**：#1890ff
- **布局方式**：[描述]
- **特殊样式**：[描述]


## ✅ 检查清单

产出 spec 文档前，确认以下内容：

### 功能完整性
- [ ] 核心功能描述清晰
- [ ] 所有交互行为已定义
- [ ] 边界情况已考虑（如空数据、错误状态）

### 接口定义
- [ ] 事件列表完整，包含触发时机和数据结构
- [ ] 动作列表完整，包含参数说明
- [ ] 变量列表完整，包含数据类型
- [ ] 配置项列表完整，包含默认值

### 数据结构
- [ ] 输入数据格式明确
- [ ] 字段类型和必填项已标注
- [ ] 提供了示例数据

### 视觉规范
- [ ] 样式要求明确
- [ ] 色彩方案确定
- [ ] 布局方式清晰

### 技术可行性
- [ ] 技术方案可行
- [ ] 性能要求合理
- [ ] 兼容性要求明确

## 💡 最佳实践

### 1. 渐进式沟通

不要一次性抛出所有问题，而是：
1. 先确认大方向（类型、核心功能）
2. 再深入细节（交互、数据）
3. 最后确认视觉和技术约束

### 2. 使用示例

- 提供类似组件的参考
- 用具体场景举例说明
- 展示数据结构示例

### 3. 确认理解

- 复述用户需求，确认理解正确
- 对模糊的需求主动提出澄清问题
- 对冲突的需求指出并协商解决方案

### 4. 管理预期

- 明确技术限制和实现难度
- 对复杂需求提出分阶段实现建议
- 说明可能的性能影响

## 🚫 常见错误

### 1. 需求理解不充分

❌ **错误做法**：
- 用户说"做一个按钮"，立即开始写代码
- 没有确认按钮的具体功能和样式

✅ **正确做法**：
- 询问按钮的用途、样式、交互行为
- 确认是否需要不同状态（禁用、加载中等）
- 明确点击后的行为

### 2. Spec 文档不完整

❌ **错误做法**：
- 只写了功能描述，没有事件和动作列表
- 数据格式没有示例
- 配置项没有默认值

✅ **正确做法**：
- 按照模板完整填写所有章节
- 提供具体的数据示例
- 标注所有默认值和可选项

### 3. 技术方案不明确

❌ **错误做法**：
- 没有考虑兼容性要求
- 没有评估性能影响
- 没有说明依赖库

✅ **正确做法**：
- 明确浏览器兼容性要求
- 对大数据量场景提出性能建议
- 列出所有外部依赖

### 4. 缺少边界情况

❌ **错误做法**：
- 只考虑正常流程
- 没有处理空数据、错误状态

✅ **正确做法**：
- 明确空数据时的显示
- 定义错误状态的处理方式
- 考虑极端情况（如超长文本）

## 📚 示例对话

### 示例 1：创建按钮组件

**Agent**: 您好！我了解到您需要创建一个按钮组件。首先确认一下，这是一个可复用的元素（Element），对吗？

**User**: 是的，一个通用按钮。

**Agent**: 好的。请问这个按钮主要有哪些功能？比如：
1. 是否需要不同的样式类型（主要按钮、次要按钮、危险按钮等）？
2. 是否需要支持禁用状态？
3. 是否需要加载中状态（显示 loading 图标）？
4. 点击后需要触发什么事件？

**User**: 需要主要和次要两种样式，要支持禁用状态，点击后触发 onClick 事件。

**Agent**: 明白了。关于配置项：
1. 按钮文字是否可配置？
2. 按钮颜色是否可配置？
3. 按钮尺寸是否需要可配置（大、中、小）？

**User**: 文字和颜色可配置，尺寸用中等就行。

**Agent**: 好的。最后确认一下数据和变量：
1. 是否需要接收外部数据？
2. 是否需要暴露内部状态（如点击次数）？

**User**: 不需要接收数据，暴露点击次数吧。

**Agent**: 完美！我现在为您整理 spec 文档...

[生成完整的 spec.md]

### 示例 2：创建用户列表页面

**Agent**: 您好！我了解到您需要创建一个用户列表页面。这是一个完整的页面（Page），对吗？

**User**: 对，一个后台管理的用户列表页面。

**Agent**: 好的。请问这个页面需要哪些核心功能？
1. 用户数据的展示方式（表格、卡片、列表）？
2. 是否需要搜索和筛选功能？
3. 是否需要分页？
4. 是否需要对用户进行操作（编辑、删除等）？

**User**: 用表格展示，需要搜索和状态筛选，暂时不需要分页，需要删除功能。

**Agent**: 明白了。关于数据结构：
1. 用户数据包含哪些字段？（如姓名、邮箱、角色、状态等）
2. 状态有哪些类型？（如激活、未激活、已禁用等）

**User**: 包含 id、姓名、邮箱、角色、状态。状态就两种：激活和未激活。

**Agent**: 好的。关于交互：
1. 点击表格行需要做什么？（选中、跳转详情等）
2. 删除用户时是否需要确认？
3. 搜索是实时搜索还是点击按钮搜索？

**User**: 点击行选中并高亮，删除需要确认，搜索是实时的。

**Agent**: 完美！我现在为您整理完整的 spec 文档...

[生成完整的 spec.md]

## 🔄 迭代优化

Spec 文档不是一成不变的，在开发过程中可能需要调整：

1. **发现新需求**：及时更新 spec 文档
2. **技术限制**：调整不可行的需求
3. **用户反馈**：根据测试结果优化
4. **性能优化**：调整实现方案

每次修改 spec 文档时，应：
- 更新对应的代码实现

## 📖 参考资源

- [设计规则](./design-guidelines.md) - 了解设计规范
- [开发规范](./development-standards.md) - 了解技术约束参考示例:
- [折线图组件示例](../src/elements/demo-line-chart/spec.md)
- [健身 App 首页示例](../src/pages/demo-app-home/spec.md)
