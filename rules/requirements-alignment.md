# 需求对齐规则

本文档指导 AI Agent 如何与用户沟通需求，并根据不同的生成模式产出相应的文档。

## 🎯 目标

通过结构化的沟通流程，确保：
1. 准确理解用户需求
2. 明确功能边界和实现细节
3. 根据选择的模式产出相应文档
4. 为后续开发提供明确指引

## 📋 生成模式

系统支持三种生成模式，根据项目复杂度和需求明确程度选择：

### 模式 1：直接生成（Simultaneous）

**流程**：用户需求 → spec.md + index.tsx（同时生成）

**适用场景**：
- 需求明确，功能边界清晰
- 快速迭代，原型验证
- 简单组件或页面

**使用模板**：`assets/templates/all-in-spec-template.md`

**特点**：
- 无需用户确认中间步骤
- 一次性产出规格文档和代码
- 适合快速开发

### 模式 2：规格优先（Spec First）

**流程**：用户需求 → spec.md（确认）→ index.tsx

**适用场景**：
- 需求较复杂，需要详细规划
- 需要在开发前确认设计方案
- 中等复杂度的组件或页面

**使用模板**：`assets/templates/spec-template.md`

**特点**：
- 先生成并确认规格文档
- 确认后再生成代码实现
- 降低返工风险

### 模式 3：完整流程（Full Process）

**流程**：用户需求 → prd.md（确认）→ spec.md（确认）→ index.tsx

**适用场景**：
- 大型项目，需要完整文档
- 业务需求和技术规格需要分离
- 需要多方评审的项目

**使用模板**：
- PRD: `assets/templates/prd-template.md`
- Spec: `assets/templates/spec-template.md`

**特点**：
- 分离业务需求和技术规格
- 每个阶段都需要用户确认
- 提供完整的文档体系

### 模式选择决策

```
需求是否明确？
├─ 是 → 功能是否简单？
│   ├─ 是 → 模式 1：直接生成
│   └─ 否 → 模式 2：规格优先
└─ 否 → 是否需要完整文档？
    ├─ 是 → 模式 3：完整流程
    └─ 否 → 模式 2：规格优先
```

## 📝 沟通流程

### 关键问题清单

#### 1. 类型确认
- [ ] 这是元素（Element）还是页面（Page）？
  - 元素：可复用的独立组件
  - 页面：完整的业务页面

#### 2. 核心功能
- [ ] 主要实现什么功能？（一句话描述）
- [ ] 关键功能点有哪些？（3-5 个）

#### 3. 交互行为
- [ ] 用户可以进行哪些操作？
- [ ] 需要响应哪些事件？
- [ ] 每个操作的预期结果是什么？

#### 4. 数据流转
- [ ] 需要接收哪些数据？（结构、字段、类型）
- [ ] 需要暴露哪些变量？（状态、计算结果）
- [ ] 数据的必填项和可选项是什么？

#### 5. 配置选项
- [ ] 需要哪些可配置项？
  - 文本内容（标题、按钮文字等）
  - 样式配置（颜色、尺寸等）
  - 行为配置（是否可编辑、最大值等）

#### 6. 视觉样式
- [ ] 整体风格是什么？
- [ ] 色彩方案如何？
- [ ] 布局方式是什么？
- [ ] 是否需要响应式设计？

### 沟通策略

#### 前置准备

**在提问之前，必须充分阅读用户提供的所有资料**：

- [ ] 检查用户是否提供了参考文档、设计稿、原型链接
- [ ] 仔细阅读所有提供的资料，理解已有信息
- [ ] 识别资料中已经明确的需求点
- [ ] 只针对资料中未明确的部分进行提问

**原则**：
- 不要询问资料中已经说明的内容
- 基于已有信息进行深入提问
- 展示你已经理解了提供的资料

**示例**：
```
❌ 错误：用户提供了设计稿，但仍然问"需要什么样式？"
✅ 正确：用户提供了设计稿，说"我看到设计稿中使用了蓝色主题和圆角按钮，请问..."
```

#### 分阶段沟通

| 阶段 | 重点 | 方法 |
|------|------|------|
| 初步理解 | 类型、核心功能 | 确认大方向，避免细节 |
| 功能细节 | 交互、数据、配置 | 逐项确认，使用示例 |
| 视觉规范 | 样式、布局 | 参考设计系统 |
| 技术约束 | 兼容性、性能 | 明确限制和建议 |

## 📄 文档模板

根据选择的生成模式，使用对应的模板：

| 模式 | 文档类型 | 模板路径 |
|------|----------|----------|
| 直接生成 | Spec | `assets/templates/all-in-spec-template.md` |
| 规格优先 | Spec | `assets/templates/spec-template.md` |
| 完整流程 | PRD | `assets/templates/prd-template.md` |
| 完整流程 | Spec | `assets/templates/spec-template.md` |

### 模板使用说明

- **all-in-spec-template.md**：包含业务需求和技术规格的一体化模板
- **prd-template.md**：专注于业务需求，不涉及技术实现
- **spec-template.md**：专注于技术规格，可选地引用 PRD

## ✅ 检查清单

### 功能完整性
- [ ] 核心功能描述清晰
- [ ] 所有交互行为已定义
- [ ] 边界情况已考虑（空数据、错误状态）

### 接口定义
- [ ] 事件列表完整（触发时机、数据结构）
- [ ] 动作列表完整（参数说明）
- [ ] 变量列表完整（数据类型）
- [ ] 配置项列表完整（默认值）

### 数据结构
- [ ] 输入数据格式明确
- [ ] 字段类型和必填项已标注
- [ ] 提供了示例数据

### 视觉规范
- [ ] 样式要求明确
- [ ] 色彩方案确定
- [ ] 布局方式清晰

### 技术可行性
- [ ] 技术方案可行
- [ ] 性能要求合理
- [ ] 兼容性要求明确

## 💡 最佳实践

### 渐进式沟通
1. 先确认大方向（类型、核心功能）
2. 再深入细节（交互、数据）
3. 最后确认视觉和技术约束

### 使用示例
- 提供类似组件的参考
- 用具体场景举例说明
- 展示数据结构示例

### 确认理解
- 复述用户需求，确认理解正确
- 对模糊的需求主动提出澄清问题
- 对冲突的需求指出并协商解决方案

### 管理预期
- 明确技术限制和实现难度
- 对复杂需求提出分阶段实现建议
- 说明可能的性能影响

## 🚫 常见错误

| 错误类型 | 错误做法 | 正确做法 |
|----------|----------|----------|
| 未读用户资料 | 用户提供了设计稿，仍然问"需要什么样式？" | 先阅读设计稿，基于设计稿内容提问 |
| 需求理解不充分 | 用户说"做一个按钮"，立即开始写代码 | 询问按钮的用途、样式、交互行为 |
| Spec 文档不完整 | 只写功能描述，没有事件和动作列表 | 按照模板完整填写所有章节 |
| 技术方案不明确 | 没有考虑兼容性要求 | 明确浏览器兼容性和性能要求 |
| 缺少边界情况 | 只考虑正常流程 | 明确空数据、错误状态的处理 |

## 📚 示例对话

### 创建按钮组件（模式 1：直接生成）

**Agent**: 您好！我了解到您需要创建一个按钮组件。这是一个可复用的元素，对吗？

**User**: 是的，一个通用按钮。

**Agent**: 好的。请问：
1. 需要哪些样式类型？（主要、次要、危险等）
2. 是否需要禁用状态？
3. 点击后触发什么事件？

**User**: 需要主要和次要两种样式，要支持禁用状态，点击后触发 onClick 事件。

**Agent**: 明白了。关于配置：
1. 按钮文字和颜色是否可配置？
2. 是否需要暴露内部状态？

**User**: 文字和颜色可配置，暴露点击次数。

**Agent**: 完美！我现在为您生成 spec 文档和代码实现...

[同时生成 spec.md 和 index.tsx]

## 🔄 迭代优化

Spec 文档在开发过程中可能需要调整：

1. **发现新需求**：及时更新文档
2. **技术限制**：调整不可行的需求
3. **用户反馈**：根据测试结果优化
4. **性能优化**：调整实现方案

## 📖 参考资源

- [开发规范](./development-standards.md) - 技术约束和最佳实践
- [Axure API 指南](./axure-api-guide.md) - API 定义规范
- [设计规范](../assets/docs/设计规范.UIGuidelines.md) - UI 设计指南
