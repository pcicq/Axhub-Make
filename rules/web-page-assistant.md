# 普通网页处理助手规范

本文档定义了如何使用 Axhub MCP 和 Firecrawl MCP 工具帮助用户从普通网页中提取资产（主题、数据、文档）以及进行页面还原和优化的完整工作流程。

## 🎯 核心能力

通过 Axhub MCP 和 Firecrawl MCP，我们可以为用户提供以下服务：

1. **提取网页资产**
   - 页面地图（通过 map 工具发现相关链接）
   - 设计主题（theme tokens）
   - 数据模型（data models）
   - 页面文档（documentation）

2. **页面还原与优化**
   - 基于截图的视觉还原
   - 结合主题、文本、节点的精确还原
   - 页面优化建议

## 🔧 工具选择策略

**默认使用 Axhub MCP**（免费且复用鉴权）

**Firecrawl MCP 仅作为备份**，仅在以下情况使用：
- Axhub MCP 调用失败或返回错误
- 链接发现不足（< 5 个）
- 结构化数据提取需求
- 用户明确要求

## 📋 工作流程

### 阶段 0：环境检测

#### 0.1 检测 MCP 安装状态

尝试调用 Axhub MCP 工具（如 `get_page_theme`），检测是否可用。

#### 0.2 检测 Firecrawl MCP（推荐）

检测 Firecrawl MCP 是否可用（用于批量操作和备份）。

**要求**：
- **至少安装一个 MCP**：Axhub MCP 或 Firecrawl MCP
- **推荐全部安装**：获得最佳体验和完整功能

**如果两个 MCP 都未安装**：
提示用户至少安装一个 MCP 工具才能继续，推荐同时安装 Axhub MCP（免费）和 Firecrawl MCP（功能强大）。

### 阶段 1：获取网页链接

如果用户未提供链接，提示用户提供一个或多个网页 URL。无论提供单个还是多个链接，我们都会通过 map 工具发现更多相关页面。

### 阶段 2：发现相关页面

使用 `get_page_map` 提取页面链接，链接不足时使用 `firecrawl_map` 作为备份。

合并和筛选链接，识别页面类型，建议用户选择 5-10 个核心页面进行深度分析。

### 阶段 3：明确用户需求

如果用户未明确需求，提供默认建议：提取设计主题、数据模型、项目文档，并还原 1-2 个示例页面。根据用户反馈调整执行计划。

### 阶段 4：提取设计主题

#### 4.1 选择核心页面

从发现的页面中选择 3-5 个核心页面用于主题提取：
- 优先选择首页、主要功能页
- 选择视觉元素丰富的页面
- 确保页面风格具有代表性

#### 4.2 提取并合并主题

使用 `get_page_theme` 提取主题数据（颜色、字体、间距、圆角、阴影等）。失效可使用 Firecrawl 的 `branding` 格式。

合并多页面主题：
- 统计出现频率，保留主要色系
- 识别主要字体族和字号
- 提取常用间距、圆角、阴影值

#### 4.3 生成主题文件

生成符合 `theme-generation-guide.md` 规范的主题文件：

**输出位置**：`src/themes/<theme-key>/`
**必需文件**：
- `designToken.json`：主题 token（必须包含 `name` 字段）
- `index.tsx`：主题演示页（使用 `ConfigProvider` 注入主题）

### 阶段 5：提取数据模型

#### 5.1 识别数据密集型页面

从发现的页面中识别可能包含数据的页面：
- 列表页（产品列表、文章列表等）
- 详情页（产品详情、文章详情等）
- 表单页（注册、登录等）
- 表格页（数据表格、统计报表等）

#### 5.2 提取页面内容

使用 `get_page_markdown` 提取页面内容。

如需批量操作（> 5 个页面）或结构化提取，可使用 Firecrawl 的 `batch_scrape` 或 `extract`。

#### 5.3 分析数据结构

从提取的内容中识别数据结构：
- 表格列名 → 数据字段
- 列表项模式 → 数据模型
- 表单字段 → 数据字段

#### 5.4 跨页面验证

如果多个页面涉及同一数据模型：
- 合并字段列表
- 去重和规范化
- 识别字段类型和必填/可选属性

#### 5.5 生成数据库文件

**输出位置**：`assets/database/`
**文件命名**：使用模型名称，如 `products.json`

**文件格式**：
```json
{
  "tableName": "表名（中文）",
  "records": [
    { "id": 1, "字段1": "值1", "字段2": "值2" }
  ]
}
```

**关键原则**：
- **字段名优先使用中文**，与网页显示一致
- **保持命名一致性**
- 从网页提取真实数据，不足时生成合理模拟数据
- 每个表生成 10-30 条记录
- 确保 id 字段唯一

### 阶段 6：生成项目文档

#### 6.1 页面地图文档

将发现的页面转换为 Markdown 文档：
- 按页面类型分组
- 每个页面名称必须是可点击的链接
- 标注页面功能和用途

**输出位置**：`assets/docs/page-map.md`

#### 6.2 项目简介文档

基于提取的信息生成项目概览：
- 基本信息（网站名称、页面数量、主要功能）
- 设计风格（主色调、字体、设计风格）
- 数据模型概览

**输出位置**：`assets/docs/project-overview.md`

### 阶段 7：页面还原

#### 7.1 选择还原页面

- 如果用户指定页面：使用用户指定的页面
- 如果用户未指定：从发现的页面中选择 1-2 个核心页面

#### 7.2 获取页面数据

**必需数据**：
1. **截图**：使用 `get_page_screenshot`
2. **主题**：使用 `get_page_theme`（如之前未获取）
3. **内容**：使用 `get_page_markdown`

**可选数据**：
4. **完整数据包**：使用 `download_page_data`（包含主题、DOM、样式、截图、图片）

**备份方案**：仅在 Axhub MCP 失败时使用 Firecrawl 的 `scrape`

#### 7.3 还原策略

**还原优先级**：
1. **截图**（最高优先级）：视觉识别布局、颜色、间距
2. **主题**：应用提取的 design tokens
3. **内容**：填充准确的文案内容
4. **样式细节**（可选）：从完整数据包中提取精确样式

**还原输出**：
- 生成符合 `development-standards.md` 规范的页面组件
- 页面还原完成后，需按开发规范验收

## 💬 用户交互指南

### 初始对话

```
您好！我可以帮您从网页中提取资产和还原页面。

请提供网页链接，我将：
1. 发现相关页面
2. 提取设计主题
3. 识别数据模型
4. 生成项目文档
5. 还原示例页面

请提供网页 URL，或告诉我您的具体需求。
```

### 环境检测失败

```
⚠️ 检测到 MCP 工具未安装或配置有误。

至少需要安装以下一个 MCP 工具：
- Axhub MCP（推荐，免费且复用鉴权）
- Firecrawl MCP（功能强大，用于批量操作）

💡 建议同时安装两个 MCP 以获得最佳体验。
```

### 需求确认

```
✓ 已发现 [X] 个相关页面。

默认方案：
- 从核心页面提取设计主题
- 识别数据模型
- 生成项目文档
- 还原 1-2 个示例页面

回复"接受"按默认方案执行，或告诉我您的具体需求。
```

### 进度通知

```
正在处理...
✓ 已发现相关页面
✓ 已提取主题数据
⏳ 正在分析数据模型...
```

### 完成总结

```
✅ 已完成！

生成的资产：
- 设计主题：src/themes/<theme-key>/
- 数据模型：assets/database/
- 项目文档：assets/docs/
- 还原页面：src/pages/

后续建议：如需还原更多页面，请告诉我页面 URL

💡 我还可以为您生成业务文档（领域模型、业务流程等），需要吗？
```

### 关键原则

- 主动确认重要操作
- 及时反馈进度
- 清晰总结成果
- 提供选项而非强制
- 友好处理错误
- 引导后续操作

## ⚠️ 注意事项

- **工具使用原则**：除非用户明确指定，所有功能默认使用 Axhub MCP
- **Firecrawl 仅作为备份**：仅在 Axhub 出错或特殊情况时使用
- 使用 `get_page_map` 发现链接，不足时（< 5 个）使用 `firecrawl_map`
- 页面还原以截图为主要依据
- 及时反馈进度，明确告知用户正在使用哪个工具
- 尊重网站版权，提取的资产仅用于学习和开发

## 📚 参考资源

- **主题生成规范**：`theme-generation-guide.md`
- **开发标准**：`development-standards.md`

## 📝 业务文档生成指南

当用户请求生成业务文档时，根据已提取数据尝试生成以下文档：

1. **Domain Model（业务领域模型）** - 核心业务对象、字段含义、对象关系
2. **Business Relationship Model（业务关系模型）** - 对象间业务关联和逻辑
3. **Business Flow / Process（业务流程模型）** - 用户/系统操作顺序、页面流
4. **State Machine / Lifecycle（状态与生命周期模型）** - 业务对象状态及流转规则
5. **Permission / Access Model（权限模型）** - 角色与权限、操作可见性

**生成策略**：不要提前评估可行性，当用户请求时直接尝试生成，数据不足时明确告知原因。

**输出位置**：`assets/docs/`
