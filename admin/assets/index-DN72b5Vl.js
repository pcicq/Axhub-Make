const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/snapdom-Blg7HCYw.js","assets/dev-template-bootstrap.js","assets/Skeleton-CsCfp-BI.js","assets/AntdIcon-mbfU87La.js","assets/useVariants-CMTY2-G5.js","assets/index-Bfm-YSwS.js","assets/CopyOutlined-8y3GtZNr.js"])))=>i.map(i=>d[i]);
import{_ as it}from"./dev-template-bootstrap.js";import"./Skeleton-CsCfp-BI.js";import"./AntdIcon-mbfU87La.js";import"./useVariants-CMTY2-G5.js";import"./index-Bfm-YSwS.js";import"./CopyOutlined-8y3GtZNr.js";const Tt=t=>{for(const e of Array.from(t.querySelectorAll("use")))try{const r=e.href.baseVal,n=document.querySelector(r);n&&(e.outerHTML=n.innerHTML)}catch(r){console.warn("Error querying <use> tag href",r)}},Ct=["display","visibility","opacity","fill","fillOpacity","fillRule","stroke","strokeWidth","strokeLinecap","strokeLinejoin","strokeOpacity","strokeDasharray","strokeDashoffset","fontFamily","fontSize","fontWeight","fontStyle","textAnchor","dominantBaseline","transform","filter","mixBlendMode","color"];function Mt(t){const e=t.style,r=[];for(const i of Ct){const s=e[i];if(s&&s.trim()!==""){const o=i.replace(/([A-Z])/g,"-$1").toLowerCase();i==="fill"&&(s==="rgb(0, 0, 0)"||s==="black")||i==="stroke"&&s==="none"||i==="strokeWidth"&&s==="1px"||i==="opacity"&&s==="1"||i==="display"&&s==="block"||i==="visibility"&&s==="visible"||r.push(`${o}:${s}`)}}return r.join(";")}function At(t){const e=t.outerHTML.length;function r(i){const s=Mt(i);i.removeAttribute("style"),s&&i.setAttribute("style",s);for(const o of i.children)r(o)}return r(t),(t.outerHTML.length/e*100).toFixed(1),t.outerHTML}async function vt(t){try{const e=t.cloneNode(!0);return At(e)}catch(e){return console.warn("⚠️ [SVG压缩] 样式清理失败，使用原始SVG:",e),t.outerHTML}}function Ft(t){if(!(t instanceof SVGSVGElement))throw new Error("需要传入一个 <svg> 元素");const e=t.getBoundingClientRect();return{x:e.left+window.scrollX,y:e.top+window.scrollY,width:e.width,height:e.height}}const Ot=async t=>{const e=Ft(t);return{type:"SVG",svg:await vt(t),x:Math.round(e.x),y:Math.round(e.y),width:Math.round(e.width),height:Math.round(e.height)}};function Nt(t){const e=t.getBoundingClientRect();return{...e,documentX:e.left+window.scrollX,documentY:e.top+window.scrollY,left:e.left,top:e.top,right:e.right,bottom:e.bottom,width:e.width,height:e.height,x:e.x,y:e.y}}const _=t=>{if(!t)return null;const e=t.match(/([\d\.]+(?:e[+-]?\d+)?)px/i),r=e==null?void 0:e[1];return r?{unit:"PIXELS",value:parseFloat(r)}:null},D=(t,e=0,r=0)=>{if(!t)return null;const n=t.match(/([\d\.]+(?:e[+-]?\d+)?)px/i);if(n){const o=parseFloat(n[1]);return{unit:"PIXELS",value:Math.min(o,1e4)}}const i=t.match(/([\d\.]+(?:e[+-]?\d+)?)%/i);if(i){const o=parseFloat(i[1]),a=Math.max(e,r),l=o/100*a;return{unit:"PIXELS",value:Math.min(l,1e4)}}const s=t.match(/^([\d\.]+(?:e[+-]?\d+)?)$/i);if(s){const o=parseFloat(s[1]);return{unit:"PIXELS",value:Math.min(o,1e4)}}return null};function St(t,e,r){let n=(t+16)/116,i=e/500+n,s=n-r/200;const o=f=>f>.206897?Math.pow(f,3):(f-16/116)/7.787;i=o(i)*95.047,n=o(n)*100,s=o(s)*108.883,i=i/100,n=n/100,s=s/100;let a=i*3.2406+n*-1.5372+s*-.4986,l=i*-.9689+n*1.8758+s*.0415,u=i*.0557+n*-.204+s*1.057;const c=f=>f>.0031308?1.055*Math.pow(f,1/2.4)-.055:12.92*f;return a=c(a),l=c(l),u=c(u),a=Math.max(0,Math.min(1,a)),l=Math.max(0,Math.min(1,l)),u=Math.max(0,Math.min(1,u)),{r:a,g:l,b:u}}function N(t){if(!t)return null;if(t.toLowerCase()==="transparent")return{r:0,g:0,b:0,a:0};const e=t.match(/lab\(\s*([0-9.]+%?)\s+([+-]?[0-9.]+)\s+([+-]?[0-9.]+)(?:\s*\/\s*([0-9.]+%?))?\s*\)/i);if(e){const i=parseFloat(e[1]),s=parseFloat(e[2]),o=parseFloat(e[3]);let a=1;if(e[4]){const u=parseFloat(e[4]);a=e[4].includes("%")?u/100:u}const l=St(i,s,o);return{r:l.r,g:l.g,b:l.b,a}}const r=t.match(/rgba?\(([\d\.]+),\s*([\d\.]+),\s*([\d\.]+)(?:,\s*([\d\.]+))?\)/);if(r){const[i,s,o,a,l]=r,u=l&&parseFloat(l)===0;if(s&&o&&a&&!u)return{r:parseInt(s)/255,g:parseInt(o)/255,b:parseInt(a)/255,a:l?parseFloat(l):1}}const n=t.match(/^#([0-9a-f]{3}|[0-9a-f]{6})$/i);if(n){let i=n[1];return i.length===3&&(i=i.split("").map(s=>s+s).join("")),{r:parseInt(i.slice(0,2),16)/255,g:parseInt(i.slice(2,4),16)/255,b:parseInt(i.slice(4,6),16)/255,a:1}}return null}const _t=/^[0-9]+[a-zA-Z%]+?$/,ot=t=>{if(!/px$/.test(t)&&t!=="0")return 0;const e=parseFloat(t);return isNaN(e)?0:e},st=t=>t==="0"||_t.test(t),$=t=>{if(t.startsWith("rgb")){const f=t.match(/(rgba?\(.+?\))(.+)/);f&&(t=(f[2]+" "+f[1]).trim())}const e=/\s(?![^(]*\))/,r=t.split(e),n=r.includes("inset"),i=r.slice(-1)[0],s=st(i)?"rgba(0, 0, 0, 1)":i,o=r.filter(f=>f!=="inset").filter(f=>f!==s).map(ot),[a=0,l=0,u=0,c=0]=o;return{inset:n,offsetX:a,offsetY:l,blurRadius:u,spreadRadius:c,color:s}},Ht=t=>{if(!t||t==="none")return[];const e=[];let r="",n=0;for(let i=0;i<t.length;i++){const s=t[i];if(s==="(")n++;else if(s===")")n--;else if(s===","&&n===0&&r.trim()){e.push($(r.trim())),r="";continue}r+=s}return r.trim()&&e.push($(r.trim())),e},X=t=>{if(t.startsWith("rgb")){const u=t.match(/(rgba?\(.+?\))(.+)/);u&&(t=(u[2]+" "+u[1]).trim())}const e=/\s(?![^(]*\))/,r=t.split(e),n=r.slice(-1)[0],i=st(n)?"rgba(0, 0, 0, 1)":n,s=r.filter(u=>u!==i).map(ot),[o=0,a=0,l=0]=s;return{offsetX:o,offsetY:a,blurRadius:l,color:i}},at=t=>{if(!t||t==="none")return[];const e=[];let r="",n=0;for(let i=0;i<t.length;i++){const s=t[i];if(s==="(")n++;else if(s===")")n--;else if(s===","&&n===0&&r.trim()){e.push(X(r.trim())),r="";continue}r+=s}return r.trim()&&e.push(X(r.trim())),e},Dt=t=>{if(!t||t==="none")return[];const e=[],r=/(\w+)\(([^)]+)\)/g;let n;for(;(n=r.exec(t))!==null;){const[,i,s]=n;switch(i){case"blur":const o=parseFloat(s);isNaN(o)||e.push({type:"LAYER_BLUR",radius:o,visible:!0});break;case"brightness":case"contrast":case"saturate":case"hue-rotate":case"invert":case"sepia":case"opacity":e.push({type:"CUSTOM_FILTER",filterType:i,value:parseFloat(s)||1,visible:!0});break}}return e},kt=t=>{if(!t||t==="none")return[];const e=[],r=/(\w+)\(([^)]+)\)/g;let n;for(;(n=r.exec(t))!==null;){const[,i,s]=n;if(i==="blur"){const o=parseFloat(s);isNaN(o)||e.push({type:"BACKGROUND_BLUR",radius:o,visible:!0})}}return e},ct=({computedStyle:t,element:e=null})=>{let r=0,n=0;if(e){const u=e.getBoundingClientRect();r=u.width,n=u.height}const i=D(t.borderTopLeftRadius,r,n),s=D(t.borderTopRightRadius,r,n),o=D(t.borderBottomRightRadius,r,n),a=D(t.borderBottomLeftRadius,r,n);return Object.assign(Object.assign(Object.assign(Object.assign({},i?{topLeftRadius:i.value}:{}),s?{topRightRadius:s.value}:{}),o?{bottomRightRadius:o.value}:{}),a?{bottomLeftRadius:a.value}:{})},Pt=({borderWidth:t,borderType:e,borderColor:r})=>t&&t!=="0"&&e!=="none"&&r;function Bt(t){const e={top:t.borderTop,right:t.borderRight,bottom:t.borderBottom,left:t.borderLeft};if(!Object.values(e).some(o=>o&&o!=="none"))return{consistent:!1,borderInfo:null};const n={};for(const[o,a]of Object.entries(e))if(a&&a!=="none"){const l=a.match(/^([\d\.]+)px\s*(\w+)\s*(.*)$/);if(l){const[u,c,f,d]=l;n[o]={borderWidth:c,borderType:f,borderColor:d}}}else n[o]={borderWidth:"0",borderType:"none",borderColor:"transparent"};const i=Object.values(n).find(o=>o.borderWidth!=="0");return i?{consistent:Object.values(n).every(o=>o.borderWidth===i.borderWidth&&o.borderType===i.borderType&&o.borderColor===i.borderColor),borderInfo:i}:{consistent:!1,borderInfo:null}}const Gt=({computedStyle:t})=>{if(t.border&&t.border!=="none"){const n=t.border.match(/^([\d\.]+)px\s*(\w+)\s*(.*)$/);if(n){const[i,s,o,a]=n;if(Pt({borderWidth:s,borderType:o,borderColor:a})){const l=N(a);if(l)return{strokes:[{type:"SOLID",color:{r:l.r,b:l.b,g:l.g},opacity:l.a||1}],strokeWeight:Math.round(parseFloat(s))}}}}const{consistent:e,borderInfo:r}=Bt(t);if(e&&r){const n=N(r.borderColor);if(n)return{strokes:[{type:"SOLID",color:{r:n.r,b:n.b,g:n.g},opacity:n.a||1}],strokeWeight:Math.round(parseFloat(r.borderWidth))}}return null},j=t=>t?{r:t.r,g:t.g,b:t.b,a:t.a!==void 0?t.a:1}:null,Y=t=>{const e=t.mixBlendMode;return{normal:"NORMAL",multiply:"MULTIPLY",screen:"SCREEN",overlay:"OVERLAY",darken:"DARKEN",lighten:"LIGHTEN","color-dodge":"COLOR_DODGE","color-burn":"COLOR_BURN","hard-light":"HARD_LIGHT","soft-light":"SOFT_LIGHT",difference:"DIFFERENCE",exclusion:"EXCLUSION",hue:"HUE",saturation:"SATURATION",color:"COLOR",luminosity:"LUMINOSITY"}[e]||"NORMAL"},Wt=({computedStyle:t})=>{const e=[];return t.boxShadow&&t.boxShadow!=="none"&&Ht(t.boxShadow).forEach(n=>{const i=N(n.color);if(i){const s=j(i),o=Y(t);n.inset?e.push({type:"INNER_SHADOW",color:s,offset:{x:n.offsetX,y:n.offsetY},radius:n.blurRadius,spread:n.spreadRadius||0,visible:!0,blendMode:o}):e.push({type:"DROP_SHADOW",color:s,offset:{x:n.offsetX,y:n.offsetY},radius:n.blurRadius,spread:n.spreadRadius||0,visible:!0,blendMode:o})}}),t.textShadow&&t.textShadow!=="none"&&at(t.textShadow).forEach(n=>{const i=N(n.color);if(i){const s=j(i),o=Y(t);e.push({type:"DROP_SHADOW",color:s,offset:{x:n.offsetX,y:n.offsetY},radius:n.blurRadius,spread:0,visible:!0,blendMode:o})}}),t.filter&&t.filter!=="none"&&Dt(t.filter).forEach(n=>{n.type==="LAYER_BLUR"&&e.push({type:"LAYER_BLUR",radius:n.radius,visible:!0})}),t.backdropFilter&&t.backdropFilter!=="none"&&kt(t.backdropFilter).forEach(n=>{n.type==="BACKGROUND_BLUR"&&e.push({type:"BACKGROUND_BLUR",radius:n.radius,visible:!0})}),e.length>0?e:void 0},Ut={fill:"FILL",contain:"FIT",cover:"CROP","scale-down":"FIT",none:"TILE"};function Vt(t){if(!t||t==="none")return"TILE";if(t==="contain")return"FIT";if(t==="cover")return"CROP";if(t==="auto")return"TILE";const e=t.split(/\s+/);if(e.length>=1){const[r,n]=e;if(r==="100%"&&n==="100%")return"FILL";if(e.length===1)return r==="100%"?"FILL":r==="auto"?"TILE":"CROP";if(e.length>=2){if(n==="auto"&&(r.includes("%")||r.includes("px"))||r==="auto"&&(n.includes("%")||n.includes("px"))||(r.includes("%")||r.includes("px"))&&(n.includes("%")||n.includes("px")))return"CROP";if(r==="auto"&&n==="auto")return"TILE"}}return"FILL"}function zt(t){let e=t.parentElement;for(;e;){const n=getComputedStyle(e).overflow;if(n!=="visible")return n;e=e.parentElement}return"visible"}function $t(t,e){return(e==="hidden"||e==="scroll"||e==="auto")&&(t==="FIT"||t==="TILE")?"CROP":t}function k(t,e,r){let n;if(e==="background")n=Vt(t.backgroundSize);else{const s=t.objectFit||"fill";n=Ut[s]||"FILL"}const i=zt(r);return $t(n,i)}const Xt=({computedStyle:t,el:e})=>{if(e instanceof SVGSVGElement){const r=`data:image/svg+xml,${encodeURIComponent(e.outerHTML.replace(/\s+/g," "))}`,n=k(t,"image",e);return{url:r,type:"IMAGE",scaleMode:n,imageHash:null}}else if(e instanceof HTMLImageElement){const r=e.src;if(r){const n=k(t,"image",e);e.getAttribute("data-from-canvas"),r.startsWith("data:");const i=K(r),s={type:"IMAGE",scaleMode:n,imageHash:null,intArr:Array.from(i)};return Object.assign({url:r},s)}else console.warn("⚠️ [getImagePaintWithUrl] IMG 元素没有 src:",e)}else if(e instanceof HTMLVideoElement){const r=e.poster;if(r){const n=k(t,"image",e),i=K(r),s={type:"IMAGE",scaleMode:n,imageHash:null,intArr:Array.from(i)};return Object.assign({url:r},s)}}if(t.backgroundImage&&t.backgroundImage!=="none"){const r=t.backgroundImage.match(/url\(['"]?(.*?)['"]?\)/),n=r==null?void 0:r[1];if(n){if(n.includes(".svg")||n.includes("data:image/svg+xml"))return;const i=k(t,"background",e);return{url:n,type:"IMAGE",scaleMode:i,imageHash:null}}}},q=";base64,";function K(t){const e=t.indexOf(q)+q.length,r=t.substring(e),n=window.atob(r),i=n.length,s=new Uint8Array(new ArrayBuffer(i));for(let o=0;o<i;o++)s[o]=n.charCodeAt(o);return s}function jt(t){const e=t.zIndex;return e==="auto"||e===""||isNaN(parseInt(e))?0:parseInt(e)}function Yt(t){return t.parentElement?Array.from(t.parentElement.children).indexOf(t):0}function B(t,e,r,n){if(!e||!r||!n)return;const i=jt(r),s=Yt(e),o=e.parentElement;t._sortingCache={zIndex:i,elementIndex:s,parentElement:o,originalElement:e}}function qt(t,e){const r=t._sortingCache,n=e._sortingCache;return!r||!n?(console.warn("⚠️ [compareLayers] 图层缺少排序缓存，跳过排序"),0):r.parentElement===n.parentElement&&r.zIndex!==n.zIndex?r.zIndex-n.zIndex:0}function Kt(t){if(!t||t.length<=1)return t;const e=t.map((r,n)=>({layer:r,originalIndex:n}));return e.sort((r,n)=>{const i=r.layer._sortingCache,s=n.layer._sortingCache;if(!i||!s)return r.originalIndex-n.originalIndex;const o=qt(r.layer,n.layer);return o!==0?o:r.originalIndex-n.originalIndex}),e.map(r=>r.layer)}function Zt(t){if(!t||!Array.isArray(t))return console.warn("⚠️ [cleanLayersSortingCache] layers 不是数组"),t;const e=r=>(!r||typeof r!="object"||(r._sortingCache&&delete r._sortingCache,r.children&&Array.isArray(r.children)&&r.children.forEach(n=>e(n))),r);return t.forEach(r=>e(r)),t}function Jt(t){if(!t||!Array.isArray(t))return console.warn("⚠️ [cleanLayersDebugProperties] layers 不是数组"),t;const e=r=>(!r||typeof r!="object"||(r._sortingCache&&delete r._sortingCache,r._debug&&delete r._debug,r._tempRef&&delete r._tempRef,r.children&&Array.isArray(r.children)&&r.children.forEach(n=>e(n))),r);return t.forEach(r=>e(r)),t}function lt(t){return!t||!Array.isArray(t)?t:Kt(t).map(n=>n&&typeof n=="object"&&n.children&&Array.isArray(n.children)?{...n,children:lt(n.children)}:n)}function V(t){const e=lt(t);return Zt(e)}const Qt=t=>typeof t=="symbol"?null:JSON.parse(JSON.stringify(t));async function te(t){try{const r=await(await fetch(t,{method:"GET",mode:"cors"})).blob(),n=r.type;return n!=="image/png"&&n!=="image/jpeg"?await H(await Z(r),n):`data:${n};base64,${await Z(r)}`}catch(e){return console.error("Failed to load image as base64:",e),null}}function Z(t){return new Promise((e,r)=>{const n=new FileReader;n.onload=()=>{const s=n.result.split(",")[1];e(s)},n.onerror=r,n.readAsDataURL(t)})}function H(t,e){return new Promise((r,n)=>{const i=new Image;i.onload=()=>{const o=document.createElement("canvas"),a=o.getContext("2d");if(!a){const l=new Error("Failed to get canvas context");console.error("❌ [imgToPng]",l),n(l);return}o.width=i.width,o.height=i.height;try{a.drawImage(i,0,0);const l=o.toDataURL("image/png");r(l)}catch(l){console.error("❌ [imgToPng] Canvas 绘制失败:",l),n(l)}},i.onerror=o=>{console.error("❌ [imgToPng] 图片加载失败"),console.error("❌ [imgToPng] 错误事件:",o),console.error("❌ [imgToPng] 尝试加载的 data URL 前 200 字符:",`data:${e};base64,${t}`.substring(0,200)),n(new Error(`Failed to load image: ${o.type||"unknown error"}`))};const s=`data:${e};base64,${t}`;i.src=s})}function ee(){return new Promise(t=>{const e=document.querySelectorAll("img");if(e.length===0){t();return}let r=0;const n=e.length,i=()=>{r++,r===n&&t()};e.forEach(s=>{s.complete?i():(s.addEventListener("load",i),s.addEventListener("error",i))})})}const M=!1;async function ne(t){const e=t.querySelectorAll("canvas");let r=0,n=0;e.forEach((i,s)=>{try{if(i.width===0||i.height===0){console.warn(`⚠️ [convertCanvasToImage] Canvas ${s+1} 尺寸为 0，跳过转换`),n++;return}let o;try{o=i.toDataURL("image/png")}catch(u){console.error(`❌ [convertCanvasToImage] Canvas ${s+1} 被污染，无法导出:`,u),console.error("❌ [convertCanvasToImage] 这通常是因为 Canvas 包含跨域图片"),n++;return}const a=document.createElement("img");a.src=o;const l=window.getComputedStyle(i);a.style.width=i.style.width||i.width+"px",a.style.height=i.style.height||i.height+"px",a.style.display=l.display,a.style.position=l.position,a.style.top=l.top,a.style.left=l.left,a.style.right=l.right,a.style.bottom=l.bottom,a.style.margin=l.margin,a.style.padding=l.padding,i.className&&(a.className=i.className),i.id&&(a.id=i.id),a.setAttribute("data-from-canvas","true"),i.parentNode?(i.parentNode.replaceChild(a,i),r++):(console.warn(`⚠️ [convertCanvasToImage] Canvas ${s+1} 没有父节点，无法替换`),n++)}catch(o){console.error(`❌ [convertCanvasToImage] Canvas ${s+1} 转换失败:`,o),console.error("❌ [convertCanvasToImage] 错误堆栈:",o.stack),n++}})}async function re(t){try{await ne(t);const e=t.querySelectorAll("img"),r=Array.from(e).map((g,b)=>({index:b+1,src:g.src,currentSrc:g.currentSrc,isBase64:g.src.startsWith("data:")}));await ee();const n=[];let i=0,s=0;const o=t.querySelectorAll("img");for(let g=0;g<o.length;g++){const b=o[g],w=b.currentSrc||b.src;if(w){if(w.startsWith("data:image/webp")){const L=new Promise(async I=>{try{const h=w.split(";base64,")[1];if(h){const y=await H(h,"image/webp");b.setAttribute("src",y),i++}}catch(h){console.error("❌ [convertImagesInPage] webp data 转换失败:",h),s++}I(!0)});n.push(L);continue}if(w&&!w.startsWith("data")){const L=new Promise(async I=>{var h;try{const y=new URL(w,document.baseURI).href,p=await chrome.runtime.sendMessage({type:"getResourceContent",src:y});if((h=p==null?void 0:p.data)!=null&&h.base64Encoded)if(p.data.mimeType!=="image/png"&&p.data.mimeType!=="image/jpeg"){const E=await H(p.data.content,p.data.mimeType);b.setAttribute("src",E),i++}else{const E=`data:${p.data.mimeType};base64,${p.data.content}`;b.setAttribute("src",E),i++}else s++;if(b.complete)I(!0);else{let E=!1;const R=setTimeout(()=>{E||(E=!0,I(!1))},1e4);b.addEventListener("load",()=>{E||(E=!0,clearTimeout(R),I(!0))}),b.addEventListener("error",()=>{E||(E=!0,clearTimeout(R),I(!1))})}}catch(y){console.error("❌ [convertImagesInPage] 图片转换失败:",y),s++,I(!1)}});n.push(L)}}}let a=[];try{const g=new Promise(w=>{setTimeout(()=>{w(new Array(n.length).fill(!1))},3e4)}),b=await Promise.race([Promise.allSettled(n),g]);Array.isArray(b)&&b.length===n.length?a=b.map(w=>w.status==="fulfilled"?w.value:!1):a=b}catch(g){console.error("❌ [convertImagesInPage] 图片转换异常:",g),a=new Array(n.length).fill(!1)}const l=a.filter(g=>g).length,u=t.querySelectorAll("img"),c=Array.from(u).filter(g=>{const b=g.src;return b&&!b.startsWith("data:")}),f=Array.from(u).map((g,b)=>({index:b+1,src:g.src,currentSrc:g.currentSrc,isBase64:g.src.startsWith("data:"),success:g.src.startsWith("data:"),fromCanvas:g.getAttribute("data-from-canvas")==="true"})),d=f.filter(g=>g.success);f.filter(g=>g.fromCanvas).length>0,c.length>0&&(console.warn("⚠️ [convertImagesInPage] 仍有图片未转换为 base64:",c.length),c.forEach((g,b)=>{console.warn(`  ${b+1}. 未转换图片:`,g.src.substring(0,100))}))}catch(e){console.error("❌ [convertImagesInPage] 图片转换失败:",e)}}const J=!1;function ie(t){if(!t||t==="none")return[];const e=[];let r="",n=0,i=!1,s="";for(let o=0;o<t.length;o++){const a=t[o],l=o>0?t[o-1]:"";if((a==='"'||a==="'")&&l!=="\\"&&(i?a===s&&(i=!1,s=""):(i=!0,s=a)),i||(a==="("?n++:a===")"&&n--),a===","&&!i&&n===0){const u=r.trim();u&&e.push(u),r=""}else r+=a}return r.trim()&&e.push(r.trim()),e}function oe(t){return t?t.split(",").map(e=>e.trim()).filter(Boolean):[]}function se(t){switch((t||"").toLowerCase()){case"normal":case"src-over":return"NORMAL";case"multiply":return"MULTIPLY";case"screen":return"SCREEN";case"overlay":return"OVERLAY";case"darken":return"DARKEN";case"lighten":return"LIGHTEN";case"color-dodge":return"COLOR_DODGE";case"color-burn":return"COLOR_BURN";case"hard-light":return"HARD_LIGHT";case"soft-light":return"SOFT_LIGHT";case"difference":return"DIFFERENCE";case"exclusion":return"EXCLUSION";case"hue":return"HUE";case"saturation":return"SATURATION";case"color":return"COLOR";case"luminosity":return"LUMINOSITY";default:return"NORMAL"}}function Q(t){if(!t||t==="none"||t==="auto")return"TILE";if(t==="contain")return"FIT";if(t==="cover")return"CROP";const e=t.split(/\s+/);if(e.length>=1){const[r,n]=e;if(r==="100%"&&n==="100%")return"FILL";if(e.length===1)return r==="100%"?"FILL":r==="auto"?"TILE":"CROP";if(e.length>=2){if(n==="auto"&&(r.includes("%")||r.includes("px"))||r==="auto"&&(n.includes("%")||n.includes("px"))||(r.includes("%")||r.includes("px"))&&(n.includes("%")||n.includes("px")))return"CROP";if(r==="auto"&&n==="auto")return"TILE"}}return"FILL"}function ae(t,e=1){let r=1;if(t.opacity&&t.opacity!==""){const n=parseFloat(t.opacity);isNaN(n)||(r=n)}return e!==void 0&&e!==1&&(r=r*e),r}function ce(t){if(!t||t==="none")return[];const e=[];let r="",n=0,i=!1,s="";for(let o=0;o<t.length;o++){const a=t[o],l=o>0?t[o-1]:"";if((a==='"'||a==="'")&&l!=="\\"&&(i?a===s&&(i=!1,s=""):(i=!0,s=a)),i||(a==="("?n++:a===")"&&n--),a===","&&!i&&n===0){const u=r.trim();u&&e.push(tt(u)),r=""}else r+=a}return r.trim()&&e.push(tt(r.trim())),e}function tt(t){if(t.includes("linear-gradient")||t.includes("radial-gradient")||t.includes("conic-gradient")||t.includes("repeating-linear-gradient")||t.includes("repeating-radial-gradient"))return{type:"gradient",value:t};if(t.includes("url(")){const e=t.match(/url\(['"]?(.*?)['"]?\)/);if(e&&e[1]){const r=e[1];return r.includes(".svg")||r.includes("data:image/svg+xml")?{type:"svg",value:r}:{type:"image",value:r}}}return t.includes("data:image/")&&!t.includes("data:image/svg+xml")?{type:"image",value:t.trim()}:{type:"unknown",value:t}}async function z(t,e=null,r={}){const{includeImageFills:n=!0,includeBackgroundColor:i=!0,includeComplexBackgrounds:s=!0}=r,o=[];if(s&&ut(t)){if(i&&P(o,t),e)try{const a=await ge(e,t,{ignoreBackgroundColor:!0});if(a)return o.push(a),o}catch(a){console.error("❌ [generateFillsFromStyles] 复杂背景转换出错:",a)}return o.length===0&&P(o,t),o}if(n&&e){const a=Xt({computedStyle:t,el:e});if(a)return o.push(a),o;console.warn("⚠️ [generateFillsFromStyles] 未能生成图片填充")}if(n||s){const a=t.backgroundImage,l=oe(t.backgroundBlendMode||"");if(a&&a!=="none"){let u=1,c=1;if(e){const d=e.getBoundingClientRect(),m=d.width||1,g=d.height||1;m>=g?(u=1,c=g/m):(u=m/g,c=1)}const f=ce(a);if(f.length>0){const d=ie(t.backgroundSize||"auto");i&&P(o,t);const m=[];for(let g=f.length-1;g>=0;g--){const b=f[g];let w=null;const L=l.length>0?se(l[Math.min(g,l.length-1)]):"NORMAL";if(b.type==="gradient"){const I=pe(b.value,u,c);I&&(w={...I,blendMode:L})}else if(b.type==="image"){const I=d[g]||d[d.length-1]||"auto",h=Q(I);w=await et(b.value,h,null),w&&(w={...w,blendMode:L})}else if(b.type==="svg"){const I=d[g]||d[d.length-1]||"auto",h=Q(I);w=await et(b.value,h,null),w&&(w={...w,blendMode:L})}w&&m.push(w)}return o.push(...m),o}}}return i&&!de(t)&&!he(t)&&P(o,t),o}function P(t,e){const r=N(e.backgroundColor);if(r&&r.a>0){const n=ae(e,r.a),i={type:"SOLID",color:{r:r.r,g:r.g,b:r.b},opacity:n};t.push(i)}}function ut(t){const e=t.backgroundImage,r=t.background;if(e&&e!=="none"&&e.includes("conic-gradient")||r&&r!=="none"&&r.includes("conic-gradient")||fe(t))return!0;const n=t.maskImage||t.webkitMaskImage;return!!(n&&n!=="none"||le(t)||ue(t))}function le(t){const e={top:t.borderTop,right:t.borderRight,bottom:t.borderBottom,left:t.borderLeft};if(!Object.values(e).some(o=>o&&o!=="none"))return!1;const n={};for(const[o,a]of Object.entries(e))if(a&&a!=="none"){const l=a.match(/^([\d\.]+)px\s*(\w+)\s*(.*)$/);if(l){const[u,c,f,d]=l;n[o]={borderWidth:c,borderType:f,borderColor:d}}}else n[o]={borderWidth:"0",borderType:"none",borderColor:"transparent"};const i=Object.values(n).find(o=>o.borderWidth!=="0");return i?!Object.values(n).every(o=>o.borderWidth===i.borderWidth&&o.borderType===i.borderType&&o.borderColor===i.borderColor):!1}function ue(t){const e=t.clipPath,r=t.webkitClipPath;return e&&e!=="none"||r&&r!=="none"}function de(t){const e=t.backgroundImage,r=t.background;return!!(e&&e!=="none"&&(e.includes("linear-gradient")||e.includes("radial-gradient")||e.includes("conic-gradient")||e.includes("repeating-linear-gradient")||e.includes("repeating-radial-gradient"))||r&&r!=="none"&&(r.includes("linear-gradient")||r.includes("radial-gradient")||r.includes("conic-gradient")||r.includes("repeating-linear-gradient")||r.includes("repeating-radial-gradient")))}function fe(t){const e=t.backgroundImage,r=t.background;return!!(e&&e!=="none"&&(e.includes("repeating-linear-gradient")||e.includes("repeating-radial-gradient"))||r&&r!=="none"&&(r.includes("repeating-linear-gradient")||r.includes("repeating-radial-gradient")))}function he(t){const e=t.backgroundImage,r=t.background;if(e&&e!=="none"&&(e.includes("url(")||e.includes("data:"))){const n=e.match(/url\(['"]?(.*?)['"]?\)/);if(n&&n[1]){const i=n[1];return!(i.includes(".svg")||i.includes("data:image/svg+xml"))}}if(r&&r!=="none"&&(r.includes("url(")||r.includes("data:"))){const n=r.match(/url\(['"]?(.*?)['"]?\)/);if(n&&n[1]){const i=n[1];return!(i.includes(".svg")||i.includes("data:image/svg+xml"))}}return!1}async function ge(t,e,r={}){try{const n=t.getBoundingClientRect(),i=4096;if(n.width>i||n.height>i)return console.warn(`⚠️ [convertElementToBase64Image] 元素尺寸超过 Figma 限制 (${i}x${i}):`,{width:n.width,height:n.height,maxSize:i}),null;const{snapdom:s}=await it(async()=>{const{snapdom:l}=await import("./snapdom-Blg7HCYw.js").then(u=>u.s);return{snapdom:l}},__vite__mapDeps([0,1,2,3,4,5,6])),o=t.cloneNode(!0);o.removeAttribute("id");for(let l=0;l<e.length;l++){const u=e[l],c=e.getPropertyValue(u);c&&o.style.setProperty(u,c)}r.ignoreBackgroundColor&&(o.style.backgroundColor="transparent"),o.style.width=`${n.width}px`,o.style.height=`${n.height}px`,o.style.boxSizing="border-box",o.style.margin="0",o.style.position="fixed",o.style.top="0",o.style.left="0",o.style.zIndex="99999",o.style.pointerEvents="none",o.style.visibility="visible",o.style.opacity="1",o.style.color="transparent",o.style.webkitTextFillColor="transparent",o.style.textShadow="none",Array.from(o.children).forEach(l=>{l.style.visibility="hidden"}),document.body.appendChild(o);const a=await s.toPng(o,{compress:!0,fast:!0,embedFonts:!0,scale:1,dpr:1,width:n.width,height:n.height});return document.body.removeChild(o),!a||!a.src?(console.error("❌ [convertElementToBase64Image] snapdom 返回无效的图片元素"),null):{type:"IMAGE",url:a.src,scaleMode:"FILL",imageHash:null}}catch(n){return console.error("❌ [convertElementToBase64Image] 转换失败:",n),null}}function pe(t,e=1,r=1){if(!t)return null;const n=t.replace(/\s+/g," ").trim(),i=n.match(/linear-gradient\s*\((.+)\)/i);if(i)return me(i[1],e,r);const s=n.match(/radial-gradient\s*\((.+)\)/i);return s?be(s[1]):(n.match(/conic-gradient\s*\((.+)\)/i),null)}function me(t,e=1,r=1){const n=dt(t);let i="to bottom",s=[];we(n[0])?(i=n[0],s=n.slice(1)):s=n;const o=ft(s);return o.length?{type:"GRADIENT_LINEAR",gradientTransform:Le(i,e,r),gradientStops:o,opacity:1,visible:!0,blendMode:"NORMAL"}:null}function be(t){const e=dt(t);let r=[];Ie(e[0])||ye(e[0])?(e[0],r=e.slice(1)):r=e;const n=ft(r);return n.length?{type:"GRADIENT_RADIAL",gradientTransform:xe(),gradientStops:n,opacity:1,visible:!0,blendMode:"NORMAL"}:null}function dt(t){const e=[];let r=0,n=0;for(let i=0;i<t.length;i++){const s=t[i];s==="("?r++:s===")"?r--:s===","&&r===0&&(e.push(t.slice(n,i).trim()),n=i+1)}return e.push(t.slice(n).trim()),e}function we(t){return!!(/to (top|bottom|left|right)/i.test(t)||/\d+deg/i.test(t))}function Ie(t){return/(circle|ellipse)/i.test(t)}function ye(t){return/(center|top|bottom|left|right)/i.test(t)}function ft(t){const e=t.map((i,s)=>{const o=i.trim(),a=o.match(/\s+(\d*\.?\d+%?)\s*$/);let l=o,u;if(a){const f=a[1],d=parseFloat(f);isNaN(d)||(u=f.includes("%")?d/100:d),l=o.substring(0,a.index).trim()}const c=Ee(l);return{position:u,color:c}}),r=e.filter(i=>i.position!==void 0),n=e.filter(i=>i.position===void 0);if(n.length>0&&(r.length===0?e.forEach((i,s)=>{i.position=e.length>1?s/(e.length-1):0}):n.forEach((i,s)=>{const o=e.length;i.position=(r.length+s)/(o-1)})),e.sort((i,s)=>(i.position||0)-(s.position||0)),e.forEach(i=>{i.position=Math.max(0,Math.min(1,i.position||0))}),e.length===1){const i=e[0];e.push({position:1,color:{...i.color}}),e[0].position=0}return e.map(i=>({position:i.position,color:i.color}))}function Ee(t){const e=N(t);return e||{r:0,g:0,b:0,a:1}}function Le(t,e=1,r=1){const n={"to top":0,"to top right":45,"to right top":45,"to right":90,"to bottom right":135,"to right bottom":135,"to bottom":180,"to bottom left":225,"to left bottom":225,"to left":270,"to top left":315,"to left top":315};let i;const s=t.trim().toLowerCase();s.endsWith("deg")?i=parseFloat(s):n[s]!==void 0?i=n[s]:i=180;const o=i*Math.PI/180,a=Math.cos(o),l=Math.sin(o);return[[a,-l,.5],[l,a,.5]]}function xe(t,e){return[[.5,0,.5],[0,.5,.5]]}function Re(t){return t?!!(t.includes(".svg")&&!t.includes(".svg?")&&t.split("?")[0].endsWith(".svg")||t.startsWith("data:image/svg+xml")):!1}async function Te(t){var e,r;try{let n="",i="image/svg+xml";if(t.startsWith("data:image/svg+xml"))if(t.includes(";base64,")){const a=t.match(/data:image\/svg\+xml;base64,(.+)/);a&&a[1]&&(n=atob(a[1]))}else{const a=t.match(/data:image\/svg\+xml,(.+)/);a&&a[1]&&(n=decodeURIComponent(a[1]))}else try{const a=new URL(t,document.baseURI).href,u=typeof chrome<"u"&&((e=chrome==null?void 0:chrome.runtime)==null?void 0:e.sendMessage)?await chrome.runtime.sendMessage({type:"getResourceContent",src:a}):null;if((r=u==null?void 0:u.data)!=null&&r.content)n=u.data.content,u.data.base64Encoded&&(n=atob(n)),i=u.data.mimeType||"image/svg+xml";else{const c=await fetch(a,{method:"GET",mode:"cors"});if(!c.ok)throw new Error(`Failed to load SVG: ${c.statusText}`);n=await c.text()}}catch{const l=new URL(t,document.baseURI).href,u=await fetch(l,{method:"GET",mode:"cors"});if(!u.ok)throw new Error(`Failed to load SVG: ${u.statusText}`);n=await u.text()}if(!n)throw new Error("无法获取 SVG 内容");n=n.replace(/\\"/g,'"').replace(/\\\\/g,"");const s=btoa(unescape(encodeURIComponent(n)));return await H(s,i)}catch(n){return console.error("❌ [convertSvgToPng] SVG 转 PNG 失败:",n),t}}async function et(t,e="FILL",r=null){let n=t;const i=(t||"").toLowerCase();if(t!=null&&t.startsWith("data:image/webp")){const s=t.split(";base64,")[1];if(s)try{n=await H(s,"image/webp")}catch(o){console.warn("⚠️ [generateImageFill] WebP data 转 PNG 失败，保留原图:",o)}}else if(/\.(webp)(\?|#|$)/i.test(i))try{const s=await te(t);s&&(n=s)}catch(s){console.warn("⚠️ [generateImageFill] WebP URL 转 PNG 失败，保留原图:",s)}return Re(n)?{type:"IMAGE",url:await Te(n),scaleMode:e,imageHash:r}:{type:"IMAGE",url:n,scaleMode:e,imageHash:r}}const Ce=async({node:t})=>{var e;const r=((e=t.textContent)===null||e===void 0?void 0:e.trim())||"";if(!ve(r))return;if(t.parentElement){const i=t.nodeType===Node.TEXT_NODE?t.parentElement:t;if(!i||i.nodeType!==Node.ELEMENT_NODE||Oe(i))return;const s=document.createRange();s.selectNode(t);const o=Qt(s.getBoundingClientRect());if(s.detach(),!Fe(o))return;const a={x:Math.round(o.left),y:Math.round(o.top),type:"TEXT",characters:r.replace(/\s+/g," "),width:Math.round(o.width),height:Math.round(o.height)},l=window.getComputedStyle(i);let u;if(l.length>0)u=await Me(a,l,i);else{const c=getComputedStyle(i);u=await Ae(a,c,i)}if(u){const c=getComputedStyle(i);B(u,t,c,o)}return u}};async function Me(t,e,r){const n={...t};if(ht(e)){const a=await z(e,r,{includeImageFills:!1,includeBackgroundColor:!0,includeComplexBackgrounds:!0});a.length>0&&(n.fills=a)}else if(e.color){const a=N(e.color);a&&(n.fills=[{type:"SOLID",color:{r:a.r,g:a.g,b:a.b},opacity:a.a||1}])}if((!n.fills||n.fills.length===0)&&(n.fills=[{type:"SOLID",color:{r:0,g:0,b:0},opacity:1}]),e.opacity&&(n.opacity=parseFloat(e.opacity)),e.fontFamily){const a=e.fontFamily.split(",")[0].trim().replace(/['"]/g,"");n.fontFamily=a}if(e.fontSize){const a=parseFloat(e.fontSize);isNaN(a)||(n.fontSize=Math.round(a))}if(e.fontWeight&&(n.fontWeight=Math.round(e.fontWeight)),e.textAlign){const a=e.textAlign;["left","center","right","justified"].includes(a)&&(n.textAlignHorizontal=a.toUpperCase())}if(["left","center","right","justified"].includes(e.textAlign)&&(n.textAlignHorizontal=e.textAlign.toUpperCase()),e.textDecoration){const a=e.textDecoration;a.includes("underline")?n.textDecoration="UNDERLINE":a.includes("line-through")&&(n.textDecoration="STRIKETHROUGH")}if(pt(r,e)&&e.lineHeight&&e.lineHeight!=="normal"){const a=parseFloat(e.fontSize),l=e.lineHeight==="normal"?a*1.2:parseFloat(e.lineHeight);if(!mt({fontSize:a,lineHeightPx:l,measuredHeight:t.height,text:n.characters||r.textContent||"",tagName:r.tagName,whiteSpace:e.whiteSpace||"normal"})){const c=_(e.lineHeight);c&&(n.lineHeight=c)}}if(e.letterSpacing&&e.letterSpacing!=="normal"){const a=_(e.letterSpacing);a&&(n.letterSpacing=a)}const o=gt(e);return o.length>0&&(n.effects=o),n}function ht(t){const e=t.background&&(t.background.includes("linear-gradient")||t.background.includes("radial-gradient")||t.background.includes("conic-gradient")),r=t.backgroundClip==="text"||t.webkitBackgroundClip==="text",n=t.backgroundImage&&(t.backgroundImage.includes("linear-gradient")||t.backgroundImage.includes("radial-gradient")||t.backgroundImage.includes("conic-gradient"));return e&&r||n&&r}function gt(t){const e=[];return t.textShadow&&t.textShadow!=="none"&&at(t.textShadow).forEach(n=>{const i=N(n.color);if(i){const s={r:i.r,g:i.g,b:i.b,a:i.a||1};e.push({type:"DROP_SHADOW",color:s,offset:{x:n.offsetX,y:n.offsetY},radius:n.blurRadius,spread:0,visible:!0,blendMode:"NORMAL"})}}),e}async function Ae(t,e,r){if(ht(e)){const g=await z(e,r,{includeImageFills:!1,includeBackgroundColor:!0,includeComplexBackgrounds:!0});g.length>0&&(t.fills=g)}else if(e.color){const g=N(e.color);g&&(t.fills=[{type:"SOLID",color:{r:g.r,g:g.g,b:g.b},opacity:g.a||1}])}(!t.fills||t.fills.length===0)&&(t.fills=[{type:"SOLID",color:{r:0,g:0,b:0,a:1},opacity:1}]);const i=_(e.letterSpacing);i&&(t.letterSpacing=i);const s=pt(r,e),o=parseFloat(e.fontSize),a=e.lineHeight==="normal"?o*1.2:parseFloat(e.lineHeight),l=mt({fontSize:o,lineHeightPx:a,measuredHeight:t.height,text:t.characters||r.textContent||"",tagName:r.tagName,whiteSpace:e.whiteSpace||"normal"}),u=s&&!l?_(e.lineHeight):null;u&&(t.lineHeight=u);const{textTransform:c}=e;switch(c){case"uppercase":{t.textCase="UPPER";break}case"lowercase":{t.textCase="LOWER";break}case"capitalize":{t.textCase="TITLE";break}}const f=_(e.fontSize);if(f&&(t.fontSize=Math.round(f.value)),e.fontFamily){const b=e.fontFamily.split(",")[0].trim().replace(/['"]/g,"");t.fontFamily=b}["underline","strikethrough"].includes(e.textDecoration)&&(t.textDecoration=e.textDecoration.toUpperCase()),["left","center","right","justified"].includes(e.textAlign)&&(t.textAlignHorizontal=e.textAlign.toUpperCase());const d=gt(e);d.length>0&&(t.effects=d);const m=ct({computedStyle:e,element:r});return Object.assign(t,m),t}function ve(t){return!(!t||t.length===0||/^\s+$/.test(t))}function Fe(t){return!(t.width<=0||t.height<=0||t.width<3||t.height<3||t.width>1e4||t.height>1e4)}function Oe(t){if(["SCRIPT","STYLE","NOSCRIPT","META","LINK","TITLE","HEAD","HTML","BODY","FRAMESET","FRAME","IFRAME"].includes(t.tagName))return!0;const r=window.getComputedStyle(t);return r.display==="none"||r.visibility==="hidden"||t.children.length===0&&(!t.textContent||t.textContent.trim().length===0)}function pt(t,e){const r=t.tagName.toUpperCase(),n=e||getComputedStyle(t);if(r==="BUTTON"||r==="INPUT"||r==="SELECT"||r==="TEXTAREA")return!1;const i=t.textContent;if(!i||i.trim().length===0||!i.includes(`
`)&&n.whiteSpace!=="normal"&&n.whiteSpace!=="pre-wrap"||n.display==="inline-flex"||n.display==="flex")return!1;const o=parseFloat(n.fontSize);if(Number.isNaN(o))return!1;const a=n.lineHeight==="normal"?o*1.2:parseFloat(n.lineHeight);return!(Number.isNaN(a)||Math.abs(a-o)<1)}function mt(t){const{fontSize:e,lineHeightPx:r,measuredHeight:n,text:i,tagName:s,whiteSpace:o}=t,a=(s||"").toUpperCase();if(a==="BUTTON"||a==="INPUT"||a==="SELECT"||a==="TEXTAREA")return!0;if(!e||!r||!n)return!1;const l=!i.includes(`
`)&&o!=="pre-wrap",u=r/e,c=n/r;return!!(l&&(u>2.5&&c<.7||u>2&&c<.9))}function G(t,e,r,n=!1){if(!t||t.length===0)return null;if(t.length===1)return t[0];const i=V(t);let s=1/0,o=1/0,a=-1/0,l=-1/0;if(i.forEach(m=>{m.x!==void 0&&m.y!==void 0&&(s=Math.min(s,m.x),o=Math.min(o,m.y),a=Math.max(a,m.x+(m.width||0)),l=Math.max(l,m.y+(m.height||0)))}),s===1/0||o===1/0)return i[0];const u=n?"FRAME":"GROUP",c={type:u,name:e||u,x:s,y:o,width:a-s,height:l-o,children:[],clipsContent:!1};let f=-1;const d=i[0];if(d&&d.type==="RECTANGLE"&&n){const m=d.width||0,g=d.height||0,b=c.width,w=c.height;Math.abs(d.x-s)<1&&Math.abs(d.y-o)<1&&Math.abs(m-b)<1&&Math.abs(g-w)<1&&(f=0,d.fills&&(c.fills=d.fills),d.strokes&&(c.strokes=d.strokes),d.strokeWeight&&(c.strokeWeight=d.strokeWeight),d.strokeAlign&&(c.strokeAlign=d.strokeAlign),d.effects&&(c.effects=d.effects),d.opacity!==void 0&&(c.opacity=d.opacity),d.blendMode&&(c.blendMode=d.blendMode),d.cornerRadius!==void 0&&(c.cornerRadius=d.cornerRadius),d.topLeftRadius!==void 0&&(c.topLeftRadius=d.topLeftRadius),d.topRightRadius!==void 0&&(c.topRightRadius=d.topRightRadius),d.bottomLeftRadius!==void 0&&(c.bottomLeftRadius=d.bottomLeftRadius),d.bottomRightRadius!==void 0&&(c.bottomRightRadius=d.bottomRightRadius))}if(c.children=i.filter((m,g)=>g!==f).map(m=>m.x!==void 0&&m.y!==void 0?{...m,x:m.x-s,y:m.y-o}:m),r){const m=r.getBoundingClientRect();B(c,r,r.style,m)}return c}async function W(t){var r;const e=[];for(let n=0;n<t.childNodes.length;n++){const i=t.childNodes[n];if(i.nodeType===Node.TEXT_NODE){const s=((r=i.textContent)==null?void 0:r.trim())||"";if(!s||s.length===0||/^\s+$/.test(s))continue;const o=await Ce({node:i});o&&e.push(o)}}return e}function Ne(t,e){const r=i=>i.display==="none"||i.visibility==="hidden"||i.opacity==="0";if(r(t))return!0;let n=e==null?void 0:e.parentElement;for(;n;){const i=getComputedStyle(n);if(r(i)||n.hasAttribute("hidden")||n.classList&&(n.classList.contains("is-hidden")||n.classList.contains("hidden"))||i.overflow!=="visible"&&n.getBoundingClientRect().height<1)return!0;n=n.parentElement}return!1}function bt(t,e){if(e.backgroundClip==="text"||e.webkitBackgroundClip==="text")return!1;const r=e.backgroundColor!=="rgba(0, 0, 0, 0)"&&e.backgroundColor!=="transparent"||e.borderWidth!=="0px"&&e.borderWidth!==""||e.boxShadow!=="none"&&e.boxShadow!==""||e.borderRadius!=="0px"&&e.borderRadius!==""||e.opacity!=="1"&&e.opacity!==""||e.transform!=="none"&&e.transform!==""&&e.transform!=="matrix(1, 0, 0, 1, 0, 0)"||e.filter!=="none"&&e.filter!==""||e.backdropFilter!=="none"&&e.backdropFilter!=="",n=e.padding!=="0px"&&e.padding!==""||e.margin!=="0px"&&e.margin!==""||e.width!=="auto"&&e.width!==""||e.height!=="auto"&&e.height!=="",i=e.backgroundImage!=="none"&&e.backgroundImage!=="";return r||n||i}function Se(t){function e(r){if(r.nodeType!==Node.ELEMENT_NODE&&r.nodeType!==Node.TEXT_NODE)return null;const n=r.shadowRoot?Array.from(r.shadowRoot.childNodes):[],s=[...Array.from(r.childNodes),...n];return{type:r.nodeType===Node.ELEMENT_NODE?"element":"text",el:r,children:s.map(o=>e(o)).filter(Boolean)}}return e(t)}function S(t,e=!1){const r=t.tagName.toLowerCase();if(e&&t.hasAttribute("data-label")){const i=t.getAttribute("data-label");if(i&&i.trim())return`${r}.${i.trim()}`}if(t.id&&t.id.trim())return`${r}.${t.id.trim()}`;const n=t.className&&t.className.trim()?t.className.trim().split(/\s+/)[0]:null;return n?`${r}.${n}`:r}async function _e(t,e=!1,r=!1){const n=[];if(t instanceof SVGSVGElement){if(t.id!=="snapdom-injected-svg"){const u=await Ot(t);n.push(u)}return n}else if(t instanceof SVGElement)return n;if(t.parentElement instanceof HTMLPictureElement&&t instanceof HTMLSourceElement||t instanceof HTMLPictureElement)return n;const i=window.getComputedStyle(t),s=["absolute","fixed"].includes(i.position);if(Ne(i,t)){const u=await W(t);return n.push(...u),n.length>1?[G(n,S(t,e),t,r)]:n}let o=!1;if(bt(t,i)?o=!0:o=(t instanceof HTMLImageElement||t instanceof HTMLVideoElement)&&i.display!=="none",o){const u=Nt(t);if(u.width>=1&&u.height>=1){const c=await z(i,t),f=i.borderWidth!=="0px"&&i.borderWidth!=="",d=i.boxShadow!=="none"&&i.boxShadow!=="",m=i.borderRadius!=="0px"&&i.borderRadius!=="",g=i.opacity!=="1"&&i.opacity!=="",b=i.transform!=="none"&&i.transform!=="",w=(parseFloat(i.paddingTop)||0)>0||(parseFloat(i.paddingRight)||0)>0||(parseFloat(i.paddingBottom)||0)>0||(parseFloat(i.paddingLeft)||0)>0||(parseFloat(i.paddingInlineStart)||0)>0||(parseFloat(i.paddingInlineEnd)||0)>0||(parseFloat(i.paddingBlockStart)||0)>0||(parseFloat(i.paddingBlockEnd)||0)>0;if(c.length===0&&!f&&!d&&!m&&!g&&!b&&!w){const p=await W(t);return n.push(...p),n.length>1?[G(n,S(t,e),t,r)]:n}const L={type:"RECTANGLE",name:S(t,e),x:Math.round(u.left),y:Math.round(u.top),width:Math.round(u.width),height:Math.round(u.height),fills:c};if(s&&(L.layoutPositioning="ABSOLUTE"),B(L,t,i,u),!ut(i)){const p=Gt({computedStyle:i});p&&Object.assign(L,p)}(t instanceof HTMLImageElement||t instanceof HTMLVideoElement||t instanceof SVGSVGElement)&&(L.name=S(t,e));const h=Wt({computedStyle:i});h&&(L.effects=h);const y=ct({computedStyle:i,element:t});Object.assign(L,y),n.push(L)}}const l=await W(t);if(n.push(...l),n.length>1){const u=G(n,S(t,e),t,r);if(s&&u&&(u.layoutPositioning="ABSOLUTE"),(parseFloat(i.flexGrow)||0)>0){u.layoutGrow=1;const f=t.parentElement?window.getComputedStyle(t.parentElement).display:"",d=t.parentElement?window.getComputedStyle(t.parentElement).flexDirection:"";(f==="flex"||f==="inline-flex")&&(d==="row"||d==="row-reverse"?(u.layoutSizingHorizontal="FILL",u.layoutSizingVertical="HUG"):(u.layoutSizingHorizontal="HUG",u.layoutSizingVertical="FILL"))}return[u]}if(n.length===1&&(s&&(n[0].layoutPositioning="ABSOLUTE"),(parseFloat(i.flexGrow)||0)>0)){n[0].layoutGrow=1;const c=t.parentElement?window.getComputedStyle(t.parentElement).display:"",f=t.parentElement?window.getComputedStyle(t.parentElement).flexDirection:"";(c==="flex"||c==="inline-flex")&&(f==="row"||f==="row-reverse"?(n[0].layoutSizingHorizontal="FILL",n[0].layoutSizingVertical="HUG"):(n[0].layoutSizingHorizontal="HUG",n[0].layoutSizingVertical="FILL"))}return n}const C=!1;function He(t){try{if(t&&t!==document.body&&t!==document.documentElement){const L=t.getBoundingClientRect(),I=t.scrollWidth,h=t.scrollHeight,y=t.clientWidth,p=t.clientHeight,E=Math.max(L.width,I,y),R=Math.max(L.height,h,p);if(E>0&&R>0)return{width:E,height:R}}const e=document.documentElement.scrollWidth,r=document.documentElement.scrollHeight,n=document.body.scrollWidth,i=document.body.scrollHeight,s=t?t.querySelectorAll("*"):document.querySelectorAll("body *");let o=0,a=0,l=1/0,u=1/0;s.forEach(L=>{if(L.offsetParent===null)return;const I=L.getBoundingClientRect();if(I.width===0&&I.height===0)return;const h=I.left+window.scrollX,y=I.top+window.scrollY,p=I.right+window.scrollX,E=I.bottom+window.scrollY;p>0&&E>0&&(o=Math.max(o,p),a=Math.max(a,E),l=Math.min(l,h),u=Math.min(u,y))});const c=document.body.getBoundingClientRect(),f=c.width,d=c.height,m=o-(l===1/0?0:l),g=a-(u===1/0?0:u),b=Math.max(e,n,m,f),w=Math.max(r,i,g,d);if(b<=0||w<=0)throw new Error("主要方法计算出无效尺寸");return{width:b,height:w}}catch{const r=window.innerWidth,n=window.innerHeight,i=document.documentElement.clientWidth,s=document.documentElement.clientHeight,o=document.body.clientWidth,a=document.body.clientHeight,l=Math.max(r,i,o),u=Math.max(n,s,a);return{width:l,height:u}}}async function De(t={}){const{targetElement:e,filter:r}=t;try{const n=e||document.body,i=He(n),s=i.width,o=i.height,{snapdom:a}=await it(async()=>{const{snapdom:y}=await import("./snapdom-Blg7HCYw.js").then(p=>p.s);return{snapdom:y}},__vite__mapDeps([0,1,2,3,4,5,6])),l=n.querySelectorAll("img"),u=Array.from(l).filter(y=>y.src.startsWith("data:")),c=Date.now(),f=await a.toBlob(n,{fast:!0,embedFonts:!0,scale:1,dpr:1,format:"svg",filter:typeof r=="function"?r:void 0}),d=Date.now()-c,m=await f.text(),b=new DOMParser().parseFromString(m,"image/svg+xml"),w=b.documentElement;if(w.tagName.toLowerCase()!=="svg")throw console.error("❌ [generatePageSvg] 解析的不是有效的 SVG:",w.tagName),new Error("解析的SVG无效");const L=w.getAttribute("width"),I=w.getAttribute("height"),h=w.getAttribute("viewBox");return{svgBlob:f,svgText:m,svgDoc:b,svgRoot:w,pageWidth:s,pageHeight:o}}catch(n){throw console.error("❌ [generatePageSvg] SVG生成失败:",n),console.error("❌ [generatePageSvg] 错误堆栈:",n.stack),n}}function ke(t){try{const e=t.svgRoot.cloneNode(!0);e.style.cssText=`
      position: absolute;
      left: 0;
      top: 0;
      z-index: 999999;
      pointer-events: none;
    `,e.id="snapdom-injected-svg";let r=document.getElementById("snapdom-shadow-host");return r||(r=document.createElement("div"),r.id="snapdom-shadow-host",r.style.cssText=`
        position: fixed;
        left: 0;
        top: 0;
        width: 0;
        height: 0;
        z-index: 999999;
        pointer-events: none;
      `,r.attachShadow({mode:"open"}),document.body.appendChild(r)),(r.shadowRoot||r.attachShadow({mode:"open"})).appendChild(e),e}catch(e){throw console.error("❌ [SnapDOM] SVG注入失败:",e),e}}function nt(){try{const t=document.getElementById("snapdom-shadow-host");if(t){t.remove();return}}catch(t){console.warn("⚠️ [SnapDOM] SVG清理失败:",t)}}const v={LESS_THAN_TWO_VISIBLE_CHILDREN:"LESS_THAN_TWO_VISIBLE_CHILDREN",OUT_OF_FLOW_CHILD:"OUT_OF_FLOW_CHILD",CHILDREN_OVERLAP:"CHILDREN_OVERLAP",GRID_TEMPLATE_AREAS:"GRID_TEMPLATE_AREAS",EXPLICIT_GRID_PLACEMENT:"EXPLICIT_GRID_PLACEMENT",IMPLICIT_GRID_FIXED_DIMS:"IMPLICIT_GRID_FIXED_DIMS",FLEX_WRAP_WITH_CHILD_MARGINS:"FLEX_WRAP_WITH_CHILD_MARGINS",VISUAL_ORDER_MISMATCH:"VISUAL_ORDER_MISMATCH",NEGATIVE_MARGIN_USED:"NEGATIVE_MARGIN_USED",MARGIN_VARIANCE_HIGH:"MARGIN_VARIANCE_HIGH",TRANSFORM_LAYOUT_HACK:"TRANSFORM_LAYOUT_HACK"};function wt(t,e,r){const n=[],i=[],s=[];for(const h of r){const y=h.getBoundingClientRect(),p=window.getComputedStyle(h);p.display!=="none"&&p.visibility!=="hidden"&&y.width>0&&y.height>0&&s.push({element:h,rect:y,style:p})}const o=e.display;if(s.length<2)return s.map(h=>h.element),n.push(v.LESS_THAN_TWO_VISIBLE_CHILDREN),{deny:!0,reasons:n,warnings:i};let a=!1,l=!1,u=!1,c=!1;const f=e.flexWrap||"nowrap",d=(o==="flex"||o==="inline-flex")&&(f==="wrap"||f==="wrap-reverse"),m=e.gap||"0px",g=parseFloat(e.rowGap)||0,b=parseFloat(e.columnGap)||0,w=m!=="0px"&&m!=="normal"||g>0||b>0,L=d&&!w;for(const{style:h}of s){if(!a&&(h.position==="absolute"||h.position==="fixed")&&(a=!0),!l&&We(h)&&(l=!0),!u){const y=h.transform;y&&y!=="none"&&y.includes("translate")&&(u=!0)}if(L&&!c){const y=parseFloat(h.marginBottom)||0,p=parseFloat(h.marginTop)||0,E=parseFloat(h.marginLeft)||0,R=parseFloat(h.marginRight)||0,F=parseFloat(h.marginInlineStart)||0,x=parseFloat(h.marginInlineEnd)||0,O=parseFloat(h.marginBlockStart)||0,T=parseFloat(h.marginBlockEnd)||0;(y>1||p>1||E>1||R>1||F>1||x>1||O>1||T>1)&&(c=!0)}if(a&&l&&u&&(!L||c))break}if(a)return s.map(h=>h.element),n.push(v.OUT_OF_FLOW_CHILD),{deny:!0,reasons:n,warnings:i};if(Pe(s))return s.map(h=>h.element),n.push(v.CHILDREN_OVERLAP),{deny:!0,reasons:n,warnings:i};if(c)return s.map(h=>h.element),n.push(v.FLEX_WRAP_WITH_CHILD_MARGINS),{deny:!0,reasons:n,warnings:i};if(o==="grid"||o==="inline-grid"){const h=e.gridTemplateAreas;if(h&&h!=="none")return s.map(x=>x.element),n.push(v.GRID_TEMPLATE_AREAS),{deny:!0,reasons:n,warnings:i};if(s.some(({style:x})=>{const O=x.gridRowStart,T=x.gridColumnStart;return O&&O!=="auto"||T&&T!=="auto"}))return s.map(x=>x.element),n.push(v.EXPLICIT_GRID_PLACEMENT),{deny:!0,reasons:n,warnings:i};const p=e.gridTemplateColumns,E=e.gridTemplateRows,R=p&&p!=="none"?p.split(" ").filter(x=>x.trim()).length:0,F=E&&E!=="none"?E.split(" ").filter(x=>x.trim()).length:0;(R>1||F>1)&&s.length>=6&&i.push(`${v.IMPLICIT_GRID_FIXED_DIMS}: container appears to be an implicit grid with cols=${R}, rows=${F}`)}if(!Ge(s))return s.map(h=>h.element),n.push(v.VISUAL_ORDER_MISMATCH),{deny:!0,reasons:n,warnings:i};if(l)return s.map(h=>h.element),n.push(v.NEGATIVE_MARGIN_USED),{deny:!0,reasons:n,warnings:i};const I=Ue(s);return I.relativeStdDev>1.2&&I.mean>0&&i.push(`${v.MARGIN_VARIANCE_HIGH}: mean=${I.mean.toFixed(2)}, relStdDev=${I.relativeStdDev.toFixed(2)}`),u?(s.map(h=>h.element),n.push(v.TRANSFORM_LAYOUT_HACK),{deny:!0,reasons:n,warnings:i}):{deny:!1,reasons:n,warnings:i}}function Pe(t,e=1){const r=t.map(n=>n.rect);for(let n=0;n<r.length;n++)for(let i=n+1;i<r.length;i++)if(Be(r[n],r[i],e))return!0;return!1}function Be(t,e,r=1){return!(t.x+t.width<=e.x+r||e.x+e.width<=t.x+r||t.y+t.height<=e.y+r||e.y+e.height<=t.y+r)}function Ge(t){if(t.length<2)return!0;const e=t.map(a=>a.rect),r=Math.max(...e.map(a=>a.x+a.width))-Math.min(...e.map(a=>a.x)),n=Math.max(...e.map(a=>a.y+a.height))-Math.min(...e.map(a=>a.y)),i=r>=n,o=t.map((a,l)=>({idx:l,rect:a.rect})).slice().sort((a,l)=>i?Math.abs(a.rect.y-l.rect.y)>4?a.rect.y-l.rect.y:a.rect.x-l.rect.x:Math.abs(a.rect.x-l.rect.x)>4?a.rect.x-l.rect.x:a.rect.y-l.rect.y);for(let a=0;a<o.length;a++)if(o[a].idx!==a)return!1;return!0}function We(t){const e=parseFloat(t.marginTop)<0||parseFloat(t.marginRight)<0||parseFloat(t.marginBottom)<0||parseFloat(t.marginLeft)<0,r=parseFloat(t.marginInlineStart)<0||parseFloat(t.marginInlineEnd)<0||parseFloat(t.marginBlockStart)<0||parseFloat(t.marginBlockEnd)<0;return e||r}function Ue(t){if(t.length<2)return{mean:0,stdDev:0,relativeStdDev:0};const e=t.map(f=>f.rect),r=Math.max(...e.map(f=>f.x+f.width))-Math.min(...e.map(f=>f.x)),n=Math.max(...e.map(f=>f.y+f.height))-Math.min(...e.map(f=>f.y)),i=r>=n,o=t.map((f,d)=>({idx:d,rect:f.rect})).sort((f,d)=>i?Math.abs(f.rect.y-d.rect.y)>4?f.rect.y-d.rect.y:f.rect.x-d.rect.x:Math.abs(f.rect.x-d.rect.x)>4?f.rect.x-d.rect.x:f.rect.y-d.rect.y),a=[];for(let f=0;f<o.length-1;f++){const d=o[f].rect,m=o[f+1].rect,g=i?m.x-(d.x+d.width):m.y-(d.y+d.height);a.push(g)}if(a.length===0)return{mean:0,stdDev:0,relativeStdDev:0};const l=a.reduce((f,d)=>f+d,0)/a.length,u=Math.sqrt(a.reduce((f,d)=>f+Math.pow(d-l,2),0)/a.length),c=l===0?u>0?1/0:0:u/Math.abs(l);return{mean:l,stdDev:u,relativeStdDev:c}}function Ve(t,e){if(!t||!e)return!1;const r=e.display;return r==="flex"||r==="inline-flex"||r==="grid"||r==="inline-grid"}function ze(t){switch(t.flexDirection||"row"){case"column":case"column-reverse":return"VERTICAL";case"row":case"row-reverse":default:return"HORIZONTAL"}}function $e(t){const e=t.gridTemplateRows||"none",r=t.gridTemplateColumns||"none";e==="none"||e.split(" ").length;const n=r==="none"?0:r.split(" ").length;return n>1?{layoutMode:"GRID",gridColumns:n}:{layoutMode:"VERTICAL"}}function Xe(t){switch(t){case"flex-start":case"start":return"MIN";case"center":return"CENTER";case"flex-end":case"end":return"MAX";case"space-between":return"SPACE_BETWEEN";default:return"MIN"}}function je(t){switch(t){case"flex-start":case"start":return"MIN";case"center":return"CENTER";case"flex-end":case"end":return"MAX";case"baseline":return"BASELINE";case"stretch":return"MIN";default:return"MIN"}}function Ye(t){switch(t){case"start":case"flex-start":case"self-start":return"MIN";case"center":return"CENTER";case"end":case"flex-end":case"self-end":return"MAX";case"left":return"MIN";case"right":return"MAX";case"stretch":return"MIN";default:return"MIN"}}function qe(t,e){const r=t.gap;if(r&&r!=="normal"&&r!=="0px"){const n=r.split(" ");return n.length===2?parseFloat(e==="HORIZONTAL"?n[1]:n[0])||0:parseFloat(r)||0}if(e==="HORIZONTAL"){const n=t.columnGap||t.gridColumnGap;return parseFloat(n)||0}else{const n=t.rowGap||t.gridRowGap;return parseFloat(n)||0}}function Ke(t){const e=parseFloat(t.paddingTop)||parseFloat(t.paddingBlockStart)||0,r=parseFloat(t.paddingRight)||parseFloat(t.paddingInlineEnd)||0,n=parseFloat(t.paddingBottom)||parseFloat(t.paddingBlockEnd)||0,i=parseFloat(t.paddingLeft)||parseFloat(t.paddingInlineStart)||0;return{paddingTop:e,paddingRight:r,paddingBottom:n,paddingLeft:i}}function Ze(t){const e=t.flexWrap||"nowrap";return e==="wrap"||e==="wrap-reverse"?"WRAP":"NO_WRAP"}function Je(t,e){if(!Ve(t,e))return null;const r=Array.from(t.children).filter(h=>h instanceof HTMLElement);if(wt(t,e,r).deny)return null;const i=e.display,s=i==="grid"||i==="inline-grid";let o,a;if(s){const h=$e(e);o=h.layoutMode,a=h.gridColumns}else o=ze(e);const l=qe(e,o),u=Ke(e),c=e.justifyContent||"flex-start",f=e.alignItems||"stretch",d=e.justifyItems||"",m=Xe(c);let g=je(f);d&&d!=="legacy"&&d!=="normal"&&(g=Ye(d));const b=o==="GRID"?void 0:s?"WRAP":Ze(e);let w="AUTO",L="AUTO";if(o==="HORIZONTAL"){const h=e.width;h&&h!=="auto"&&(h.includes("%")&&parseFloat(h)===100||h.includes("px"))&&(w="FIXED");const y=e.height;y&&y!=="auto"&&y.includes("px")&&(L="FIXED")}else if(o==="VERTICAL"){const h=e.height;h&&h!=="auto"&&(h.includes("%")&&parseFloat(h)===100||h.includes("px"))&&(w="FIXED");const y=e.width;y&&y!=="auto"&&y.includes("px")&&(L="FIXED")}const I={layoutMode:o,primaryAxisSizingMode:w,counterAxisSizingMode:L,primaryAxisAlignItems:m,counterAxisAlignItems:g,itemSpacing:l,...u,layoutPositioning:"AUTO"};return b!==void 0&&(I.layoutWrap=b,b==="WRAP"&&(I.counterAxisSpacing=l||0)),o==="GRID"&&a&&(I.gridColumnCount=a,I.gridColumnGap=l||0,I.gridRowGap=l||0),I}const rt="export-overlay-root",A=!1;function Qe(t){return t instanceof Element?!!(t.id===rt||typeof t.closest=="function"&&t.closest(`#${rt}`)):!1}function It(t){if(!(t instanceof Element))return!1;try{const e=t.style,r=e.overflowX,n=e.overflowY;return r==="hidden"||n==="hidden"}catch(e){return console.warn("⚠️ [hasOverflowHidden] 无法获取计算样式:",e),!1}}function tn(t,e,r,n=null,i=!1){var y;if(!t||t.length===0)return null;const s=()=>{};if(s("start createFrameFromLayers",{layerCount:t.length,firstLayer:t[0]?{type:t[0].type,name:t[0].name,width:t[0].width,height:t[0].height}:null}),t.length===1&&!n)return t[0];const o=V(t),a=o.filter(p=>p.layoutPositioning!=="ABSOLUTE"&&p.layoutPositioning!=="FIXED"),l=a.length>0?a:o,u=p=>{let E=Number.POSITIVE_INFINITY,R=Number.POSITIVE_INFINITY,F=Number.NEGATIVE_INFINITY,x=Number.NEGATIVE_INFINITY,O=0;for(const T of p)typeof T.x=="number"&&typeof T.y=="number"&&typeof T.width=="number"&&typeof T.height=="number"&&(E=Math.min(E,T.x),R=Math.min(R,T.y),F=Math.max(F,T.x+T.width),x=Math.max(x,T.y+T.height),O+=1);return O===0?null:{x:E,y:R,width:F-E,height:x-R}};let c=null;const f=[];for(const p of l)if(p.type==="RECTANGLE"&&!c){c=p;break}let d,m,g,b;if(c){const p=u(l),E=(y=r==null?void 0:r.getBoundingClientRect)==null?void 0:y.call(r),R=typeof c.name=="string"&&typeof e=="string"&&c.name===e;if(p){const F=c.width>=p.width*.9,x=c.height>=p.height*.9,O=c.x<=p.x+1,T=c.y<=p.y+1,yt=c.x+c.width>=p.x+p.width-1,Et=c.y+c.height>=p.y+p.height-1,Lt=c.width*c.height>=p.width*p.height*.8,xt=!!E&&Math.abs(c.width-E.width)<=2&&Math.abs(c.height-E.height)<=2&&Math.abs(c.x-E.x)<=2&&Math.abs(c.y-E.y)<=2,Rt=F&&x&&O&&T&&yt&&Et&&Lt;s("background coverage check",{bgName:c.name,bgSize:{w:c.width,h:c.height}}),!Rt&&!xt&&!R&&(s("background rejected, fallback to element bounding rect",{bgName:c.name}),c=null)}}if(c){d=c.x,m=c.y,g=c.width,b=c.height,s("use backgroundLayer as frame basis",{bgName:c.name,bgType:c.type});for(const p of o)p!==c&&f.push(p)}else{const p=r.getBoundingClientRect();d=p.x,m=p.y,g=p.width,b=p.height,f.push(...o)}let w=f.map(p=>p.x!==void 0&&p.y!==void 0?{...p,x:p.x-d,y:p.y-m}:p);const L=It(r),I=i?"FRAME":"GROUP",h={type:I,name:e||I,x:d,y:m,width:g,height:b,clipsContent:L,children:[]};if(s("frameLayer created",{name:h.name,x:h.x,y:h.y,width:h.width,height:h.height,childCount:w.length}),c){const p=c.fills&&c.fills.some(E=>E.type==="IMAGE");!i&&p?(s("GROUP mode with image fill, keeping background as separate layer",{bgName:c.name}),w.unshift({...c,x:0,y:0})):(c.fills&&c.fills.length>0&&(h.fills=c.fills),c.strokes&&(h.strokes=c.strokes),c.strokeWeight!==void 0&&(h.strokeWeight=c.strokeWeight),c.strokeAlign!==void 0&&(h.strokeAlign=c.strokeAlign),c.cornerRadius!==void 0&&(h.cornerRadius=c.cornerRadius),c.topLeftRadius!==void 0&&(h.topLeftRadius=c.topLeftRadius,h.topRightRadius=c.topRightRadius,h.bottomLeftRadius=c.bottomLeftRadius,h.bottomRightRadius=c.bottomRightRadius),c.effects&&c.effects.length>0&&(h.effects=c.effects),c.opacity!==void 0&&c.opacity!==1&&(h.opacity=c.opacity))}else i&&(h.fills=[{type:"SOLID",color:{r:1,g:1,b:1},opacity:0}]);if(h.children=w,n&&Object.assign(h,n),r){const p=r.getBoundingClientRect();B(h,r,r.style,p)}return h}const en=async(t,e)=>{const{useFrames:r,rootName:n,time:i,isAxure:s,widgetId:o,enableAutoLayout:a=!0}=e,l=t.className,u="figma-target-element";try{await re(t),t.classList.add(u);const c=await De({targetElement:t,filter:g=>!Qe(g)}),f=ke(c);let d=f.querySelector(`.${u}`);d||(console.warn("⚠️ [processWithSnapDOM] 未找到标识元素，尝试查找 body"),d=f.querySelector("body")),d||(console.warn("⚠️ [processWithSnapDOM] 未找到 body，使用整个 SVG"),d=f);const m=await nn(d,{useFrames:r,rootName:n,time:i,isAxure:s,widgetId:o,size:{width:c.pageWidth,height:c.pageHeight},isSnapdomProcessing:!0,enableAutoLayout:a});return nt(),t.className=l,m}catch(c){console.error("❌ [processWithSnapDOM] SnapDOM 方案失败:",c),t.className=l;try{nt()}catch(f){console.warn("⚠️ [processWithSnapDOM] 清理失败:",f)}return null}};async function U(t,e=!1,r=!1,n=!0){const i=[];if(!t)return i;if(t.type==="element"){const s=await _e(t.el,r,n);if(t.el instanceof SVGSVGElement&&t.el.id!=="snapdom-injected-svg")return s;const o=It(t.el);let a=!1,l=null,u=null,c=!1;try{if(u=window.getComputedStyle(t.el),n){const g=Je(t.el,u);if(g!==null){const b=t.children.filter(L=>L.type==="element").map(L=>L.el),w=wt(t.el,u,b);w.deny?(l=null,a=!1):(l=g,a=!0,w.warnings.length>0)}}const m=u.display;t.children&&t.children.length>2&&m&&!["inline","inline-block","inline-flex","inline-grid"].includes(m)&&(c=!0)}catch(m){console.warn("⚠️ [Auto Layout] 无法检测布局属性:",m),console.warn("⚠️ [Auto Layout] 样式获取失败元素:",{name:S(t.el,r),tag:t.el.tagName})}let f=!1;if(t.children&&t.children.length>0){const m=u||(()=>{try{return window.getComputedStyle(t.el)}catch{return t.el.style}})();try{f=bt(t.el,m)}catch{}}if(!u&&t.children&&t.children.length>0&&(c=!0,console.warn("[structure][fallback] 无法获取样式，保守创建 FRAME",{name:S(t.el,r),tag:t.el.tagName,childCount:t.children.length})),(e||o||a||f||c)&&n){const m=[];for(const b of t.children){const w=await U(b,e||a,r,n);m.push(...w)}const g=[...s,...m];if(g.length>0){const b=tn(g,S(t.el,r),t.el,l,n);b&&i.push(b)}return i}else i.push(...s)}if(!e)for(const s of t.children){const o=await U(s,e,r,n);i.push(...o)}return i}const nn=async(t,e)=>{const{useFrames:r,rootName:n,time:i,size:s,isAxure:o=!1,widgetId:a,enableAutoLayout:l=!0}=e;Tt(t);const u=Se(t),c=await U(u,r,o,l),f=V(c),d={type:"FRAME",name:n||"FRAME",widgetId:a||null,width:s.width||Math.round(t.scrollWidth),height:s.height||Math.round(t.scrollHeight),x:0,y:0,children:f},m=Jt([d]);return i&&(console.info(`
`),console.timeEnd("Parse dom")),m};async function un(t="body",e){const{useFrames:r=!1,time:n=!1,rootName:i,isAxure:s=!1,widgetId:o,enableAutoLayout:a=!0}=e;n&&console.time("Parse dom");const l=t instanceof HTMLElement?t:document.querySelector(t||"body");return l?en(l,{useFrames:r,rootName:i,isAxure:s,time:n,widgetId:o,enableAutoLayout:a}):[]}export{un as htmlToFigma,nn as processWithOriginalLogic};
