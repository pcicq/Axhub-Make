const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/snapdom-BlfgwPLR.js","assets/dev-template-bootstrap.js","assets/Skeleton-BDj0btt5.js","assets/CopyOutlined-BnS0GXXx.js","assets/index-C72wkpjH.js","assets/useVariants-BC8slJ1t.js"])))=>i.map(i=>d[i]);
import{_ as nt}from"./dev-template-bootstrap.js";import"./Skeleton-BDj0btt5.js";import"./CopyOutlined-BnS0GXXx.js";import"./index-C72wkpjH.js";import"./useVariants-BC8slJ1t.js";const xt=t=>{for(const e of Array.from(t.querySelectorAll("use")))try{const r=e.href.baseVal,n=document.querySelector(r);n&&(e.outerHTML=n.innerHTML)}catch(r){console.warn("Error querying <use> tag href",r)}},Rt=["display","visibility","opacity","fill","fillOpacity","fillRule","stroke","strokeWidth","strokeLinecap","strokeLinejoin","strokeOpacity","strokeDasharray","strokeDashoffset","fontFamily","fontSize","fontWeight","fontStyle","textAnchor","dominantBaseline","transform","filter","mixBlendMode","color"];function Tt(t){const e=t.style,r=[];for(const i of Rt){const a=e[i];if(a&&a.trim()!==""){const o=i.replace(/([A-Z])/g,"-$1").toLowerCase();i==="fill"&&(a==="rgb(0, 0, 0)"||a==="black")||i==="stroke"&&a==="none"||i==="strokeWidth"&&a==="1px"||i==="opacity"&&a==="1"||i==="display"&&a==="block"||i==="visibility"&&a==="visible"||r.push(`${o}:${a}`)}}return r.join(";")}function Ct(t){const e=t.outerHTML.length;function r(i){const a=Tt(i);i.removeAttribute("style"),a&&i.setAttribute("style",a);for(const o of i.children)r(o)}return r(t),(t.outerHTML.length/e*100).toFixed(1),t.outerHTML}async function Mt(t){try{const e=t.cloneNode(!0);return Ct(e)}catch(e){return console.warn("⚠️ [SVG压缩] 样式清理失败，使用原始SVG:",e),t.outerHTML}}function At(t){if(!(t instanceof SVGSVGElement))throw new Error("需要传入一个 <svg> 元素");const e=t.getBoundingClientRect();return{x:e.left+window.scrollX,y:e.top+window.scrollY,width:e.width,height:e.height}}const vt=async t=>{const e=At(t);return{type:"SVG",svg:await Mt(t),x:Math.round(e.x),y:Math.round(e.y),width:Math.round(e.width),height:Math.round(e.height)}};function Ft(t){const e=t.getBoundingClientRect();return{...e,documentX:e.left+window.scrollX,documentY:e.top+window.scrollY,left:e.left,top:e.top,right:e.right,bottom:e.bottom,width:e.width,height:e.height,x:e.x,y:e.y}}const _=t=>{if(!t)return null;const e=t.match(/([\d\.]+)px/),r=e==null?void 0:e[1];return r?{unit:"PIXELS",value:parseFloat(r)}:null},k=(t,e=0,r=0)=>{if(!t)return null;const n=t.match(/([\d\.]+)px/);if(n)return{unit:"PIXELS",value:parseFloat(n[1])};const i=t.match(/([\d\.]+)%/);if(i){const o=parseFloat(i[1]),s=Math.max(e,r);return{unit:"PIXELS",value:o/100*s}}const a=t.match(/^([\d\.]+)$/);return a?{unit:"PIXELS",value:parseFloat(a[1])}:null};function N(t){if(!t)return null;const[e,r,n,i,a,o]=t.match(/rgba?\(([\d\.]+), ([\d\.]+), ([\d\.]+)(, ([\d\.]+))?\)/)||[],s=o&&parseFloat(o)===0;return r&&n&&i&&!s?{r:parseInt(r)/255,g:parseInt(n)/255,b:parseInt(i)/255,a:o?parseFloat(o):1}:null}const Ot=/^[0-9]+[a-zA-Z%]+?$/,rt=t=>{if(!/px$/.test(t)&&t!=="0")return 0;const e=parseFloat(t);return isNaN(e)?0:e},it=t=>t==="0"||Ot.test(t),$=t=>{if(t.startsWith("rgb")){const g=t.match(/(rgba?\(.+?\))(.+)/);g&&(t=(g[2]+" "+g[1]).trim())}const e=/\s(?![^(]*\))/,r=t.split(e),n=r.includes("inset"),i=r.slice(-1)[0],a=it(i)?"rgba(0, 0, 0, 1)":i,o=r.filter(g=>g!=="inset").filter(g=>g!==a).map(rt),[s=0,l=0,d=0,c=0]=o;return{inset:n,offsetX:s,offsetY:l,blurRadius:d,spreadRadius:c,color:a}},Nt=t=>{if(!t||t==="none")return[];const e=[];let r="",n=0;for(let i=0;i<t.length;i++){const a=t[i];if(a==="(")n++;else if(a===")")n--;else if(a===","&&n===0&&r.trim()){e.push($(r.trim())),r="";continue}r+=a}return r.trim()&&e.push($(r.trim())),e},X=t=>{if(t.startsWith("rgb")){const d=t.match(/(rgba?\(.+?\))(.+)/);d&&(t=(d[2]+" "+d[1]).trim())}const e=/\s(?![^(]*\))/,r=t.split(e),n=r.slice(-1)[0],i=it(n)?"rgba(0, 0, 0, 1)":n,a=r.filter(d=>d!==i).map(rt),[o=0,s=0,l=0]=a;return{offsetX:o,offsetY:s,blurRadius:l,color:i}},ot=t=>{if(!t||t==="none")return[];const e=[];let r="",n=0;for(let i=0;i<t.length;i++){const a=t[i];if(a==="(")n++;else if(a===")")n--;else if(a===","&&n===0&&r.trim()){e.push(X(r.trim())),r="";continue}r+=a}return r.trim()&&e.push(X(r.trim())),e},St=t=>{if(!t||t==="none")return[];const e=[],r=/(\w+)\(([^)]+)\)/g;let n;for(;(n=r.exec(t))!==null;){const[,i,a]=n;switch(i){case"blur":const o=parseFloat(a);isNaN(o)||e.push({type:"LAYER_BLUR",radius:o,visible:!0});break;case"brightness":case"contrast":case"saturate":case"hue-rotate":case"invert":case"sepia":case"opacity":e.push({type:"CUSTOM_FILTER",filterType:i,value:parseFloat(a)||1,visible:!0});break}}return e},_t=t=>{if(!t||t==="none")return[];const e=[],r=/(\w+)\(([^)]+)\)/g;let n;for(;(n=r.exec(t))!==null;){const[,i,a]=n;if(i==="blur"){const o=parseFloat(a);isNaN(o)||e.push({type:"BACKGROUND_BLUR",radius:o,visible:!0})}}return e},st=({computedStyle:t,element:e=null})=>{let r=0,n=0;if(e){const d=e.getBoundingClientRect();r=d.width,n=d.height}const i=k(t.borderTopLeftRadius,r,n),a=k(t.borderTopRightRadius,r,n),o=k(t.borderBottomRightRadius,r,n),s=k(t.borderBottomLeftRadius,r,n);return Object.assign(Object.assign(Object.assign(Object.assign({},i?{topLeftRadius:i.value}:{}),a?{topRightRadius:a.value}:{}),o?{bottomRightRadius:o.value}:{}),s?{bottomLeftRadius:s.value}:{})},Ht=({borderWidth:t,borderType:e,borderColor:r})=>t&&t!=="0"&&e!=="none"&&r;function kt(t){const e={top:t.borderTop,right:t.borderRight,bottom:t.borderBottom,left:t.borderLeft};if(!Object.values(e).some(o=>o&&o!=="none"))return{consistent:!1,borderInfo:null};const n={};for(const[o,s]of Object.entries(e))if(s&&s!=="none"){const l=s.match(/^([\d\.]+)px\s*(\w+)\s*(.*)$/);if(l){const[d,c,g,u]=l;n[o]={borderWidth:c,borderType:g,borderColor:u}}}else n[o]={borderWidth:"0",borderType:"none",borderColor:"transparent"};const i=Object.values(n).find(o=>o.borderWidth!=="0");return i?{consistent:Object.values(n).every(o=>o.borderWidth===i.borderWidth&&o.borderType===i.borderType&&o.borderColor===i.borderColor),borderInfo:i}:{consistent:!1,borderInfo:null}}const Dt=({computedStyle:t})=>{if(t.border&&t.border!=="none"){const n=t.border.match(/^([\d\.]+)px\s*(\w+)\s*(.*)$/);if(n){const[i,a,o,s]=n;if(Ht({borderWidth:a,borderType:o,borderColor:s})){const l=N(s);if(l)return{strokes:[{type:"SOLID",color:{r:l.r,b:l.b,g:l.g},opacity:l.a||1}],strokeWeight:Math.round(parseFloat(a))}}}}const{consistent:e,borderInfo:r}=kt(t);if(e&&r){const n=N(r.borderColor);if(n)return{strokes:[{type:"SOLID",color:{r:n.r,b:n.b,g:n.g},opacity:n.a||1}],strokeWeight:Math.round(parseFloat(r.borderWidth))}}return null},j=t=>t?{r:t.r,g:t.g,b:t.b,a:t.a!==void 0?t.a:1}:null,Y=t=>{const e=t.mixBlendMode;return{normal:"NORMAL",multiply:"MULTIPLY",screen:"SCREEN",overlay:"OVERLAY",darken:"DARKEN",lighten:"LIGHTEN","color-dodge":"COLOR_DODGE","color-burn":"COLOR_BURN","hard-light":"HARD_LIGHT","soft-light":"SOFT_LIGHT",difference:"DIFFERENCE",exclusion:"EXCLUSION",hue:"HUE",saturation:"SATURATION",color:"COLOR",luminosity:"LUMINOSITY"}[e]||"NORMAL"},Pt=({computedStyle:t})=>{const e=[];return t.boxShadow&&t.boxShadow!=="none"&&Nt(t.boxShadow).forEach(n=>{const i=N(n.color);if(i){const a=j(i),o=Y(t);n.inset?e.push({type:"INNER_SHADOW",color:a,offset:{x:n.offsetX,y:n.offsetY},radius:n.blurRadius,spread:n.spreadRadius||0,visible:!0,blendMode:o}):e.push({type:"DROP_SHADOW",color:a,offset:{x:n.offsetX,y:n.offsetY},radius:n.blurRadius,spread:n.spreadRadius||0,visible:!0,blendMode:o})}}),t.textShadow&&t.textShadow!=="none"&&ot(t.textShadow).forEach(n=>{const i=N(n.color);if(i){const a=j(i),o=Y(t);e.push({type:"DROP_SHADOW",color:a,offset:{x:n.offsetX,y:n.offsetY},radius:n.blurRadius,spread:0,visible:!0,blendMode:o})}}),t.filter&&t.filter!=="none"&&St(t.filter).forEach(n=>{n.type==="LAYER_BLUR"&&e.push({type:"LAYER_BLUR",radius:n.radius,visible:!0})}),t.backdropFilter&&t.backdropFilter!=="none"&&_t(t.backdropFilter).forEach(n=>{n.type==="BACKGROUND_BLUR"&&e.push({type:"BACKGROUND_BLUR",radius:n.radius,visible:!0})}),e.length>0?e:void 0},Gt={fill:"FILL",contain:"FIT",cover:"CROP","scale-down":"FIT",none:"TILE"};function Bt(t){if(!t||t==="none")return"TILE";if(t==="contain")return"FIT";if(t==="cover")return"CROP";if(t==="auto")return"TILE";const e=t.split(/\s+/);if(e.length>=1){const[r,n]=e;if(r==="100%"&&n==="100%")return"FILL";if(e.length===1)return r==="100%"?"FILL":r==="auto"?"TILE":"CROP";if(e.length>=2){if(n==="auto"&&(r.includes("%")||r.includes("px"))||r==="auto"&&(n.includes("%")||n.includes("px"))||(r.includes("%")||r.includes("px"))&&(n.includes("%")||n.includes("px")))return"CROP";if(r==="auto"&&n==="auto")return"TILE"}}return"FILL"}function Wt(t){let e=t.parentElement;for(;e;){const n=getComputedStyle(e).overflow;if(n!=="visible")return n;e=e.parentElement}return"visible"}function Ut(t,e){return(e==="hidden"||e==="scroll"||e==="auto")&&(t==="FIT"||t==="TILE")?"CROP":t}function D(t,e,r){let n;if(e==="background")n=Bt(t.backgroundSize);else{const a=t.objectFit||"fill";n=Gt[a]||"FILL"}const i=Wt(r);return Ut(n,i)}const Vt=({computedStyle:t,el:e})=>{if(e instanceof SVGSVGElement){const r=`data:image/svg+xml,${encodeURIComponent(e.outerHTML.replace(/\s+/g," "))}`,n=D(t,"image",e);return{url:r,type:"IMAGE",scaleMode:n,imageHash:null}}else if(e instanceof HTMLImageElement){const r=e.src;if(r){const n=D(t,"image",e);return e.getAttribute("data-from-canvas"),r.startsWith("data:"),Object.assign({url:r},{type:"IMAGE",scaleMode:n,imageHash:null})}else console.warn("⚠️ [getImagePaintWithUrl] IMG 元素没有 src:",e)}else if(e instanceof HTMLVideoElement){const r=e.poster;if(r){const i={type:"IMAGE",scaleMode:D(t,"image",e),imageHash:null};return Object.assign({url:r},i)}}if(t.backgroundImage&&t.backgroundImage!=="none"){const r=t.backgroundImage.match(/url\(['"]?(.*?)['"]?\)/),n=r==null?void 0:r[1];if(n){if(n.includes(".svg")||n.includes("data:image/svg+xml"))return;const i=D(t,"background",e);return{url:n,type:"IMAGE",scaleMode:i,imageHash:null}}}};function zt(t){const e=t.zIndex;return e==="auto"||e===""||isNaN(parseInt(e))?0:parseInt(e)}function $t(t){return t.parentElement?Array.from(t.parentElement.children).indexOf(t):0}function G(t,e,r,n){if(!e||!r||!n)return;const i=zt(r),a=$t(e),o=e.parentElement;t._sortingCache={zIndex:i,elementIndex:a,parentElement:o,originalElement:e}}function Xt(t,e){const r=t._sortingCache,n=e._sortingCache;return!r||!n?(console.warn("⚠️ [compareLayers] 图层缺少排序缓存，跳过排序"),0):r.parentElement===n.parentElement&&r.zIndex!==n.zIndex?r.zIndex-n.zIndex:0}function jt(t){if(!t||t.length<=1)return t;const e=t.map((r,n)=>({layer:r,originalIndex:n}));return e.sort((r,n)=>{const i=r.layer._sortingCache,a=n.layer._sortingCache;if(!i||!a)return r.originalIndex-n.originalIndex;const o=Xt(r.layer,n.layer);return o!==0?o:r.originalIndex-n.originalIndex}),e.map(r=>r.layer)}function Yt(t){if(!t||!Array.isArray(t))return console.warn("⚠️ [cleanLayersSortingCache] layers 不是数组"),t;const e=r=>(!r||typeof r!="object"||(r._sortingCache&&delete r._sortingCache,r.children&&Array.isArray(r.children)&&r.children.forEach(n=>e(n))),r);return t.forEach(r=>e(r)),t}function qt(t){if(!t||!Array.isArray(t))return console.warn("⚠️ [cleanLayersDebugProperties] layers 不是数组"),t;const e=r=>(!r||typeof r!="object"||(r._sortingCache&&delete r._sortingCache,r._debug&&delete r._debug,r._tempRef&&delete r._tempRef,r.children&&Array.isArray(r.children)&&r.children.forEach(n=>e(n))),r);return t.forEach(r=>e(r)),t}function at(t){return!t||!Array.isArray(t)?t:jt(t).map(n=>n&&typeof n=="object"&&n.children&&Array.isArray(n.children)?{...n,children:at(n.children)}:n)}function V(t){const e=at(t);return Yt(e)}const Kt=t=>typeof t=="symbol"?null:JSON.parse(JSON.stringify(t));async function Zt(t){try{const r=await(await fetch(t,{method:"GET",mode:"cors"})).blob(),n=r.type;return n!=="image/png"&&n!=="image/jpeg"?await H(await q(r),n):`data:${n};base64,${await q(r)}`}catch(e){return console.error("Failed to load image as base64:",e),null}}function q(t){return new Promise((e,r)=>{const n=new FileReader;n.onload=()=>{const a=n.result.split(",")[1];e(a)},n.onerror=r,n.readAsDataURL(t)})}function H(t,e){return new Promise((r,n)=>{const i=new Image;i.onload=()=>{const o=document.createElement("canvas"),s=o.getContext("2d");if(!s){const l=new Error("Failed to get canvas context");console.error("❌ [imgToPng]",l),n(l);return}o.width=i.width,o.height=i.height;try{s.drawImage(i,0,0);const l=o.toDataURL("image/png");r(l)}catch(l){console.error("❌ [imgToPng] Canvas 绘制失败:",l),n(l)}},i.onerror=o=>{console.error("❌ [imgToPng] 图片加载失败"),console.error("❌ [imgToPng] 错误事件:",o),console.error("❌ [imgToPng] 尝试加载的 data URL 前 200 字符:",`data:${e};base64,${t}`.substring(0,200)),n(new Error(`Failed to load image: ${o.type||"unknown error"}`))};const a=`data:${e};base64,${t}`;i.src=a})}function Jt(){return new Promise(t=>{const e=document.querySelectorAll("img");if(e.length===0){t();return}let r=0;const n=e.length,i=()=>{r++,r===n&&t()};e.forEach(a=>{a.complete?i():(a.addEventListener("load",i),a.addEventListener("error",i))})})}const M=!1;async function Qt(t){const e=t.querySelectorAll("canvas");let r=0,n=0;e.forEach((i,a)=>{try{if(i.width===0||i.height===0){console.warn(`⚠️ [convertCanvasToImage] Canvas ${a+1} 尺寸为 0，跳过转换`),n++;return}let o;try{o=i.toDataURL("image/png")}catch(d){console.error(`❌ [convertCanvasToImage] Canvas ${a+1} 被污染，无法导出:`,d),console.error("❌ [convertCanvasToImage] 这通常是因为 Canvas 包含跨域图片"),n++;return}const s=document.createElement("img");s.src=o;const l=window.getComputedStyle(i);s.style.width=i.style.width||i.width+"px",s.style.height=i.style.height||i.height+"px",s.style.display=l.display,s.style.position=l.position,s.style.top=l.top,s.style.left=l.left,s.style.right=l.right,s.style.bottom=l.bottom,s.style.margin=l.margin,s.style.padding=l.padding,i.className&&(s.className=i.className),i.id&&(s.id=i.id),s.setAttribute("data-from-canvas","true"),i.parentNode?(i.parentNode.replaceChild(s,i),r++):(console.warn(`⚠️ [convertCanvasToImage] Canvas ${a+1} 没有父节点，无法替换`),n++)}catch(o){console.error(`❌ [convertCanvasToImage] Canvas ${a+1} 转换失败:`,o),console.error("❌ [convertCanvasToImage] 错误堆栈:",o.stack),n++}})}async function te(t){try{await Qt(t);const e=t.querySelectorAll("img"),r=Array.from(e).map((h,b)=>({index:b+1,src:h.src,currentSrc:h.currentSrc,isBase64:h.src.startsWith("data:")}));await Jt();const n=[];let i=0,a=0;const o=t.querySelectorAll("img");for(let h=0;h<o.length;h++){const b=o[h],w=b.currentSrc||b.src;if(w){if(w.startsWith("data:image/webp")){const L=new Promise(async I=>{try{const f=w.split(";base64,")[1];if(f){const y=await H(f,"image/webp");b.setAttribute("src",y),i++}}catch(f){console.error("❌ [convertImagesInPage] webp data 转换失败:",f),a++}I(!0)});n.push(L);continue}if(w&&!w.startsWith("data")){const L=new Promise(async I=>{var f;try{const y=new URL(w,document.baseURI).href,p=await chrome.runtime.sendMessage({type:"getResourceContent",src:y});if((f=p==null?void 0:p.data)!=null&&f.base64Encoded)if(p.data.mimeType!=="image/png"&&p.data.mimeType!=="image/jpeg"){const E=await H(p.data.content,p.data.mimeType);b.setAttribute("src",E),i++}else{const E=`data:${p.data.mimeType};base64,${p.data.content}`;b.setAttribute("src",E),i++}else a++;if(b.complete)I(!0);else{let E=!1;const R=setTimeout(()=>{E||(E=!0,I(!1))},1e4);b.addEventListener("load",()=>{E||(E=!0,clearTimeout(R),I(!0))}),b.addEventListener("error",()=>{E||(E=!0,clearTimeout(R),I(!1))})}}catch(y){console.error("❌ [convertImagesInPage] 图片转换失败:",y),a++,I(!1)}});n.push(L)}}}let s=[];try{const h=new Promise(w=>{setTimeout(()=>{w(new Array(n.length).fill(!1))},3e4)}),b=await Promise.race([Promise.allSettled(n),h]);Array.isArray(b)&&b.length===n.length?s=b.map(w=>w.status==="fulfilled"?w.value:!1):s=b}catch(h){console.error("❌ [convertImagesInPage] 图片转换异常:",h),s=new Array(n.length).fill(!1)}const l=s.filter(h=>h).length,d=t.querySelectorAll("img"),c=Array.from(d).filter(h=>{const b=h.src;return b&&!b.startsWith("data:")}),g=Array.from(d).map((h,b)=>({index:b+1,src:h.src,currentSrc:h.currentSrc,isBase64:h.src.startsWith("data:"),success:h.src.startsWith("data:"),fromCanvas:h.getAttribute("data-from-canvas")==="true"})),u=g.filter(h=>h.success);g.filter(h=>h.fromCanvas).length>0,c.length>0&&(console.warn("⚠️ [convertImagesInPage] 仍有图片未转换为 base64:",c.length),c.forEach((h,b)=>{console.warn(`  ${b+1}. 未转换图片:`,h.src.substring(0,100))}))}catch(e){console.error("❌ [convertImagesInPage] 图片转换失败:",e)}}const K=!1;function ee(t){if(!t||t==="none")return[];const e=[];let r="",n=0,i=!1,a="";for(let o=0;o<t.length;o++){const s=t[o],l=o>0?t[o-1]:"";if((s==='"'||s==="'")&&l!=="\\"&&(i?s===a&&(i=!1,a=""):(i=!0,a=s)),i||(s==="("?n++:s===")"&&n--),s===","&&!i&&n===0){const d=r.trim();d&&e.push(d),r=""}else r+=s}return r.trim()&&e.push(r.trim()),e}function ne(t){return t?t.split(",").map(e=>e.trim()).filter(Boolean):[]}function re(t){switch((t||"").toLowerCase()){case"normal":case"src-over":return"NORMAL";case"multiply":return"MULTIPLY";case"screen":return"SCREEN";case"overlay":return"OVERLAY";case"darken":return"DARKEN";case"lighten":return"LIGHTEN";case"color-dodge":return"COLOR_DODGE";case"color-burn":return"COLOR_BURN";case"hard-light":return"HARD_LIGHT";case"soft-light":return"SOFT_LIGHT";case"difference":return"DIFFERENCE";case"exclusion":return"EXCLUSION";case"hue":return"HUE";case"saturation":return"SATURATION";case"color":return"COLOR";case"luminosity":return"LUMINOSITY";default:return"NORMAL"}}function Z(t){if(!t||t==="none"||t==="auto")return"TILE";if(t==="contain")return"FIT";if(t==="cover")return"CROP";const e=t.split(/\s+/);if(e.length>=1){const[r,n]=e;if(r==="100%"&&n==="100%")return"FILL";if(e.length===1)return r==="100%"?"FILL":r==="auto"?"TILE":"CROP";if(e.length>=2){if(n==="auto"&&(r.includes("%")||r.includes("px"))||r==="auto"&&(n.includes("%")||n.includes("px"))||(r.includes("%")||r.includes("px"))&&(n.includes("%")||n.includes("px")))return"CROP";if(r==="auto"&&n==="auto")return"TILE"}}return"FILL"}function ie(t,e=1){let r=1;if(t.opacity&&t.opacity!==""){const n=parseFloat(t.opacity);isNaN(n)||(r=n)}return e!==void 0&&e!==1&&(r=r*e),r}function oe(t){if(!t||t==="none")return[];const e=[];let r="",n=0,i=!1,a="";for(let o=0;o<t.length;o++){const s=t[o],l=o>0?t[o-1]:"";if((s==='"'||s==="'")&&l!=="\\"&&(i?s===a&&(i=!1,a=""):(i=!0,a=s)),i||(s==="("?n++:s===")"&&n--),s===","&&!i&&n===0){const d=r.trim();d&&e.push(J(d)),r=""}else r+=s}return r.trim()&&e.push(J(r.trim())),e}function J(t){if(t.includes("linear-gradient")||t.includes("radial-gradient")||t.includes("conic-gradient")||t.includes("repeating-linear-gradient")||t.includes("repeating-radial-gradient"))return{type:"gradient",value:t};if(t.includes("url(")){const e=t.match(/url\(['"]?(.*?)['"]?\)/);if(e&&e[1]){const r=e[1];return r.includes(".svg")||r.includes("data:image/svg+xml")?{type:"svg",value:r}:{type:"image",value:r}}}return t.includes("data:image/")&&!t.includes("data:image/svg+xml")?{type:"image",value:t.trim()}:{type:"unknown",value:t}}async function z(t,e=null,r={}){const{includeImageFills:n=!0,includeBackgroundColor:i=!0,includeComplexBackgrounds:a=!0}=r,o=[];if(a&&ct(t)){if(i&&P(o,t),e)try{const s=await ue(e,t,{ignoreBackgroundColor:!0});if(s)return o.push(s),o}catch(s){console.error("❌ [generateFillsFromStyles] 复杂背景转换出错:",s)}return o.length===0&&P(o,t),o}if(n&&e){const s=Vt({computedStyle:t,el:e});if(s)return o.push(s),o;console.warn("⚠️ [generateFillsFromStyles] 未能生成图片填充")}if(n||a){const s=t.backgroundImage,l=ne(t.backgroundBlendMode||"");if(s&&s!=="none"){let d=1,c=1;if(e){const u=e.getBoundingClientRect(),m=u.width||1,h=u.height||1;m>=h?(d=1,c=h/m):(d=m/h,c=1)}const g=oe(s);if(g.length>0){const u=ee(t.backgroundSize||"auto");i&&P(o,t);const m=[];for(let h=g.length-1;h>=0;h--){const b=g[h];let w=null;const L=l.length>0?re(l[Math.min(h,l.length-1)]):"NORMAL";if(b.type==="gradient"){const I=fe(b.value,d,c);I&&(w={...I,blendMode:L})}else if(b.type==="image"){const I=u[h]||u[u.length-1]||"auto",f=Z(I);w=await Q(b.value,f,null),w&&(w={...w,blendMode:L})}else if(b.type==="svg"){const I=u[h]||u[u.length-1]||"auto",f=Z(I);w=await Q(b.value,f,null),w&&(w={...w,blendMode:L})}w&&m.push(w)}return o.push(...m),o}}}return i&&!ce(t)&&!de(t)&&P(o,t),o}function P(t,e){const r=N(e.backgroundColor);if(r&&r.a>0){const n=ie(e,r.a),i={type:"SOLID",color:{r:r.r,g:r.g,b:r.b},opacity:n};t.push(i)}}function ct(t){const e=t.backgroundImage,r=t.background;if(e&&e!=="none"&&e.includes("conic-gradient")||r&&r!=="none"&&r.includes("conic-gradient")||le(t))return!0;const n=t.maskImage||t.webkitMaskImage;return!!(n&&n!=="none"||se(t)||ae(t))}function se(t){const e={top:t.borderTop,right:t.borderRight,bottom:t.borderBottom,left:t.borderLeft};if(!Object.values(e).some(o=>o&&o!=="none"))return!1;const n={};for(const[o,s]of Object.entries(e))if(s&&s!=="none"){const l=s.match(/^([\d\.]+)px\s*(\w+)\s*(.*)$/);if(l){const[d,c,g,u]=l;n[o]={borderWidth:c,borderType:g,borderColor:u}}}else n[o]={borderWidth:"0",borderType:"none",borderColor:"transparent"};const i=Object.values(n).find(o=>o.borderWidth!=="0");return i?!Object.values(n).every(o=>o.borderWidth===i.borderWidth&&o.borderType===i.borderType&&o.borderColor===i.borderColor):!1}function ae(t){const e=t.clipPath,r=t.webkitClipPath;return e&&e!=="none"||r&&r!=="none"}function ce(t){const e=t.backgroundImage,r=t.background;return!!(e&&e!=="none"&&(e.includes("linear-gradient")||e.includes("radial-gradient")||e.includes("conic-gradient")||e.includes("repeating-linear-gradient")||e.includes("repeating-radial-gradient"))||r&&r!=="none"&&(r.includes("linear-gradient")||r.includes("radial-gradient")||r.includes("conic-gradient")||r.includes("repeating-linear-gradient")||r.includes("repeating-radial-gradient")))}function le(t){const e=t.backgroundImage,r=t.background;return!!(e&&e!=="none"&&(e.includes("repeating-linear-gradient")||e.includes("repeating-radial-gradient"))||r&&r!=="none"&&(r.includes("repeating-linear-gradient")||r.includes("repeating-radial-gradient")))}function de(t){const e=t.backgroundImage,r=t.background;if(e&&e!=="none"&&(e.includes("url(")||e.includes("data:"))){const n=e.match(/url\(['"]?(.*?)['"]?\)/);if(n&&n[1]){const i=n[1];return!(i.includes(".svg")||i.includes("data:image/svg+xml"))}}if(r&&r!=="none"&&(r.includes("url(")||r.includes("data:"))){const n=r.match(/url\(['"]?(.*?)['"]?\)/);if(n&&n[1]){const i=n[1];return!(i.includes(".svg")||i.includes("data:image/svg+xml"))}}return!1}async function ue(t,e,r={}){try{const n=t.getBoundingClientRect(),i=4096;if(n.width>i||n.height>i)return console.warn(`⚠️ [convertElementToBase64Image] 元素尺寸超过 Figma 限制 (${i}x${i}):`,{width:n.width,height:n.height,maxSize:i}),null;const{snapdom:a}=await nt(async()=>{const{snapdom:l}=await import("./snapdom-BlfgwPLR.js").then(d=>d.s);return{snapdom:l}},__vite__mapDeps([0,1,2,3,4,5])),o=t.cloneNode(!0);o.removeAttribute("id");for(let l=0;l<e.length;l++){const d=e[l],c=e.getPropertyValue(d);c&&o.style.setProperty(d,c)}r.ignoreBackgroundColor&&(o.style.backgroundColor="transparent"),o.style.width=`${n.width}px`,o.style.height=`${n.height}px`,o.style.boxSizing="border-box",o.style.margin="0",o.style.position="fixed",o.style.top="0",o.style.left="0",o.style.zIndex="99999",o.style.pointerEvents="none",o.style.visibility="visible",o.style.opacity="1",o.style.color="transparent",o.style.webkitTextFillColor="transparent",o.style.textShadow="none",Array.from(o.children).forEach(l=>{l.style.visibility="hidden"}),document.body.appendChild(o);const s=await a.toPng(o,{compress:!0,fast:!0,embedFonts:!0,scale:1,dpr:1,width:n.width,height:n.height});return document.body.removeChild(o),!s||!s.src?(console.error("❌ [convertElementToBase64Image] snapdom 返回无效的图片元素"),null):{type:"IMAGE",url:s.src,scaleMode:"FILL",imageHash:null}}catch(n){return console.error("❌ [convertElementToBase64Image] 转换失败:",n),null}}function fe(t,e=1,r=1){if(!t)return null;const n=t.replace(/\s+/g," ").trim(),i=n.match(/linear-gradient\s*\((.+)\)/i);if(i)return ge(i[1],e,r);const a=n.match(/radial-gradient\s*\((.+)\)/i);return a?he(a[1]):(n.match(/conic-gradient\s*\((.+)\)/i),null)}function ge(t,e=1,r=1){const n=lt(t);let i="to bottom",a=[];pe(n[0])?(i=n[0],a=n.slice(1)):a=n;const o=dt(a);return o.length?{type:"GRADIENT_LINEAR",gradientTransform:Ie(i,e,r),gradientStops:o,opacity:1,visible:!0,blendMode:"NORMAL"}:null}function he(t){const e=lt(t);let r=[];me(e[0])||be(e[0])?(e[0],r=e.slice(1)):r=e;const n=dt(r);return n.length?{type:"GRADIENT_RADIAL",gradientTransform:ye(),gradientStops:n,opacity:1,visible:!0,blendMode:"NORMAL"}:null}function lt(t){const e=[];let r=0,n=0;for(let i=0;i<t.length;i++){const a=t[i];a==="("?r++:a===")"?r--:a===","&&r===0&&(e.push(t.slice(n,i).trim()),n=i+1)}return e.push(t.slice(n).trim()),e}function pe(t){return!!(/to (top|bottom|left|right)/i.test(t)||/\d+deg/i.test(t))}function me(t){return/(circle|ellipse)/i.test(t)}function be(t){return/(center|top|bottom|left|right)/i.test(t)}function dt(t){const e=t.map((i,a)=>{const o=i.trim(),s=o.match(/\s+(\d*\.?\d+%?)\s*$/);let l=o,d;if(s){const g=s[1],u=parseFloat(g);isNaN(u)||(d=g.includes("%")?u/100:u),l=o.substring(0,s.index).trim()}const c=we(l);return{position:d,color:c}}),r=e.filter(i=>i.position!==void 0),n=e.filter(i=>i.position===void 0);if(n.length>0&&(r.length===0?e.forEach((i,a)=>{i.position=e.length>1?a/(e.length-1):0}):n.forEach((i,a)=>{const o=e.length;i.position=(r.length+a)/(o-1)})),e.sort((i,a)=>(i.position||0)-(a.position||0)),e.forEach(i=>{i.position=Math.max(0,Math.min(1,i.position||0))}),e.length===1){const i=e[0];e.push({position:1,color:{...i.color}}),e[0].position=0}return e.map(i=>({position:i.position,color:i.color}))}function we(t){if(!t)return{r:0,g:0,b:0,a:1};if(t.toLowerCase()==="transparent")return{r:0,g:0,b:0,a:0};const e=t.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*([0-9.]+))?\)/);if(e)return{r:parseInt(e[1],10)/255,g:parseInt(e[2],10)/255,b:parseInt(e[3],10)/255,a:e[4]?parseFloat(e[4]):1};const r=t.match(/^#([0-9a-f]{3}|[0-9a-f]{6})$/i);if(r){let i=r[1];return i.length===3&&(i=i.split("").map(a=>a+a).join("")),{r:parseInt(i.slice(0,2),16)/255,g:parseInt(i.slice(2,4),16)/255,b:parseInt(i.slice(4,6),16)/255,a:1}}const n=N(t);return n||{r:0,g:0,b:0,a:1}}function Ie(t,e=1,r=1){const n={"to top":0,"to top right":45,"to right top":45,"to right":90,"to bottom right":135,"to right bottom":135,"to bottom":180,"to bottom left":225,"to left bottom":225,"to left":270,"to top left":315,"to left top":315};let i;const a=t.trim().toLowerCase();a.endsWith("deg")?i=parseFloat(a):n[a]!==void 0?i=n[a]:i=180;const o=i*Math.PI/180,s=Math.cos(o),l=Math.sin(o);return[[s,-l,.5],[l,s,.5]]}function ye(t,e){return[[.5,0,.5],[0,.5,.5]]}function Ee(t){return t?!!(t.includes(".svg")&&!t.includes(".svg?")&&t.split("?")[0].endsWith(".svg")||t.startsWith("data:image/svg+xml")):!1}async function Le(t){var e,r;try{let n="",i="image/svg+xml";if(t.startsWith("data:image/svg+xml"))if(t.includes(";base64,")){const s=t.match(/data:image\/svg\+xml;base64,(.+)/);s&&s[1]&&(n=atob(s[1]))}else{const s=t.match(/data:image\/svg\+xml,(.+)/);s&&s[1]&&(n=decodeURIComponent(s[1]))}else try{const s=new URL(t,document.baseURI).href,d=typeof chrome<"u"&&((e=chrome==null?void 0:chrome.runtime)==null?void 0:e.sendMessage)?await chrome.runtime.sendMessage({type:"getResourceContent",src:s}):null;if((r=d==null?void 0:d.data)!=null&&r.content)n=d.data.content,d.data.base64Encoded&&(n=atob(n)),i=d.data.mimeType||"image/svg+xml";else{const c=await fetch(s,{method:"GET",mode:"cors"});if(!c.ok)throw new Error(`Failed to load SVG: ${c.statusText}`);n=await c.text()}}catch{const l=new URL(t,document.baseURI).href,d=await fetch(l,{method:"GET",mode:"cors"});if(!d.ok)throw new Error(`Failed to load SVG: ${d.statusText}`);n=await d.text()}if(!n)throw new Error("无法获取 SVG 内容");n=n.replace(/\\"/g,'"').replace(/\\\\/g,"");const a=btoa(unescape(encodeURIComponent(n)));return await H(a,i)}catch(n){return console.error("❌ [convertSvgToPng] SVG 转 PNG 失败:",n),t}}async function Q(t,e="FILL",r=null){let n=t;const i=(t||"").toLowerCase();if(t!=null&&t.startsWith("data:image/webp")){const a=t.split(";base64,")[1];if(a)try{n=await H(a,"image/webp")}catch(o){console.warn("⚠️ [generateImageFill] WebP data 转 PNG 失败，保留原图:",o)}}else if(/\.(webp)(\?|#|$)/i.test(i))try{const a=await Zt(t);a&&(n=a)}catch(a){console.warn("⚠️ [generateImageFill] WebP URL 转 PNG 失败，保留原图:",a)}return Ee(n)?{type:"IMAGE",url:await Le(n),scaleMode:e,imageHash:r}:{type:"IMAGE",url:n,scaleMode:e,imageHash:r}}const xe=async({node:t})=>{var e;const r=((e=t.textContent)===null||e===void 0?void 0:e.trim())||"";if(!Ce(r))return;if(t.parentElement){const i=t.nodeType===Node.TEXT_NODE?t.parentElement:t;if(!i||i.nodeType!==Node.ELEMENT_NODE||Ae(i))return;const a=document.createRange();a.selectNode(t);const o=Kt(a.getBoundingClientRect());if(a.detach(),!Me(o))return;const s={x:Math.round(o.left),y:Math.round(o.top),type:"TEXT",characters:r.replace(/\s+/g," "),width:Math.round(o.width),height:Math.round(o.height)},l=window.getComputedStyle(i);let d;if(l.length>0)d=await Re(s,l,i);else{const c=getComputedStyle(i);d=await Te(s,c,i)}if(d){const c=getComputedStyle(i);G(d,t,c,o)}return d}};async function Re(t,e,r){const n={...t};if(ut(e)){const s=await z(e,r,{includeImageFills:!1,includeBackgroundColor:!0,includeComplexBackgrounds:!0});s.length>0&&(n.fills=s)}else if(e.color){const s=N(e.color);s&&(n.fills=[{type:"SOLID",color:{r:s.r,g:s.g,b:s.b},opacity:s.a||1}])}if((!n.fills||n.fills.length===0)&&(n.fills=[{type:"SOLID",color:{r:0,g:0,b:0},opacity:1}]),e.opacity&&(n.opacity=parseFloat(e.opacity)),e.fontFamily){const s=e.fontFamily.split(",")[0].trim().replace(/['"]/g,"");n.fontFamily=s}if(e.fontSize){const s=parseFloat(e.fontSize);isNaN(s)||(n.fontSize=Math.round(s))}if(e.fontWeight&&(n.fontWeight=Math.round(e.fontWeight)),e.textAlign){const s=e.textAlign;["left","center","right","justified"].includes(s)&&(n.textAlignHorizontal=s.toUpperCase())}if(["left","center","right","justified"].includes(e.textAlign)&&(n.textAlignHorizontal=e.textAlign.toUpperCase()),e.textDecoration){const s=e.textDecoration;s.includes("underline")?n.textDecoration="UNDERLINE":s.includes("line-through")&&(n.textDecoration="STRIKETHROUGH")}if(gt(r,e)&&e.lineHeight&&e.lineHeight!=="normal"){const s=parseFloat(e.fontSize),l=e.lineHeight==="normal"?s*1.2:parseFloat(e.lineHeight);if(!ht({fontSize:s,lineHeightPx:l,measuredHeight:t.height,text:n.characters||r.textContent||"",tagName:r.tagName,whiteSpace:e.whiteSpace||"normal"})){const c=_(e.lineHeight);c&&(n.lineHeight=c)}}if(e.letterSpacing&&e.letterSpacing!=="normal"){const s=_(e.letterSpacing);s&&(n.letterSpacing=s)}const o=ft(e);return o.length>0&&(n.effects=o),n}function ut(t){const e=t.background&&(t.background.includes("linear-gradient")||t.background.includes("radial-gradient")||t.background.includes("conic-gradient")),r=t.backgroundClip==="text"||t.webkitBackgroundClip==="text",n=t.backgroundImage&&(t.backgroundImage.includes("linear-gradient")||t.backgroundImage.includes("radial-gradient")||t.backgroundImage.includes("conic-gradient"));return e&&r||n&&r}function ft(t){const e=[];return t.textShadow&&t.textShadow!=="none"&&ot(t.textShadow).forEach(n=>{const i=N(n.color);if(i){const a={r:i.r,g:i.g,b:i.b,a:i.a||1};e.push({type:"DROP_SHADOW",color:a,offset:{x:n.offsetX,y:n.offsetY},radius:n.blurRadius,spread:0,visible:!0,blendMode:"NORMAL"})}}),e}async function Te(t,e,r){if(ut(e)){const h=await z(e,r,{includeImageFills:!1,includeBackgroundColor:!0,includeComplexBackgrounds:!0});h.length>0&&(t.fills=h)}else if(e.color){const h=N(e.color);h&&(t.fills=[{type:"SOLID",color:{r:h.r,g:h.g,b:h.b},opacity:h.a||1}])}(!t.fills||t.fills.length===0)&&(t.fills=[{type:"SOLID",color:{r:0,g:0,b:0,a:1},opacity:1}]);const i=_(e.letterSpacing);i&&(t.letterSpacing=i);const a=gt(r,e),o=parseFloat(e.fontSize),s=e.lineHeight==="normal"?o*1.2:parseFloat(e.lineHeight),l=ht({fontSize:o,lineHeightPx:s,measuredHeight:t.height,text:t.characters||r.textContent||"",tagName:r.tagName,whiteSpace:e.whiteSpace||"normal"}),d=a&&!l?_(e.lineHeight):null;d&&(t.lineHeight=d);const{textTransform:c}=e;switch(c){case"uppercase":{t.textCase="UPPER";break}case"lowercase":{t.textCase="LOWER";break}case"capitalize":{t.textCase="TITLE";break}}const g=_(e.fontSize);if(g&&(t.fontSize=Math.round(g.value)),e.fontFamily){const b=e.fontFamily.split(",")[0].trim().replace(/['"]/g,"");t.fontFamily=b}["underline","strikethrough"].includes(e.textDecoration)&&(t.textDecoration=e.textDecoration.toUpperCase()),["left","center","right","justified"].includes(e.textAlign)&&(t.textAlignHorizontal=e.textAlign.toUpperCase());const u=ft(e);u.length>0&&(t.effects=u);const m=st({computedStyle:e,element:r});return Object.assign(t,m),t}function Ce(t){return!(!t||t.length===0||/^\s+$/.test(t))}function Me(t){return!(t.width<=0||t.height<=0||t.width<3||t.height<3||t.width>1e4||t.height>1e4)}function Ae(t){if(["SCRIPT","STYLE","NOSCRIPT","META","LINK","TITLE","HEAD","HTML","BODY","FRAMESET","FRAME","IFRAME"].includes(t.tagName))return!0;const r=window.getComputedStyle(t);return r.display==="none"||r.visibility==="hidden"||t.children.length===0&&(!t.textContent||t.textContent.trim().length===0)}function gt(t,e){const r=t.tagName.toUpperCase(),n=e||getComputedStyle(t);if(r==="BUTTON"||r==="INPUT"||r==="SELECT"||r==="TEXTAREA")return!1;const i=t.textContent;if(!i||i.trim().length===0||!i.includes(`
`)&&n.whiteSpace!=="normal"&&n.whiteSpace!=="pre-wrap"||n.display==="inline-flex"||n.display==="flex")return!1;const o=parseFloat(n.fontSize);if(Number.isNaN(o))return!1;const s=n.lineHeight==="normal"?o*1.2:parseFloat(n.lineHeight);return!(Number.isNaN(s)||Math.abs(s-o)<1)}function ht(t){const{fontSize:e,lineHeightPx:r,measuredHeight:n,text:i,tagName:a,whiteSpace:o}=t,s=(a||"").toUpperCase();if(s==="BUTTON"||s==="INPUT"||s==="SELECT"||s==="TEXTAREA")return!0;if(!e||!r||!n)return!1;const l=!i.includes(`
`)&&o!=="pre-wrap",d=r/e,c=n/r;return!!(l&&(d>2.5&&c<.7||d>2&&c<.9))}function B(t,e,r,n=!1){if(!t||t.length===0)return null;if(t.length===1)return t[0];const i=V(t);let a=1/0,o=1/0,s=-1/0,l=-1/0;if(i.forEach(m=>{m.x!==void 0&&m.y!==void 0&&(a=Math.min(a,m.x),o=Math.min(o,m.y),s=Math.max(s,m.x+(m.width||0)),l=Math.max(l,m.y+(m.height||0)))}),a===1/0||o===1/0)return i[0];const d=n?"FRAME":"GROUP",c={type:d,name:e||d,x:a,y:o,width:s-a,height:l-o,children:[],clipsContent:!1};let g=-1;const u=i[0];if(u&&u.type==="RECTANGLE"&&n){const m=u.width||0,h=u.height||0,b=c.width,w=c.height;Math.abs(u.x-a)<1&&Math.abs(u.y-o)<1&&Math.abs(m-b)<1&&Math.abs(h-w)<1&&(g=0,u.fills&&(c.fills=u.fills),u.strokes&&(c.strokes=u.strokes),u.strokeWeight&&(c.strokeWeight=u.strokeWeight),u.strokeAlign&&(c.strokeAlign=u.strokeAlign),u.effects&&(c.effects=u.effects),u.opacity!==void 0&&(c.opacity=u.opacity),u.blendMode&&(c.blendMode=u.blendMode),u.cornerRadius!==void 0&&(c.cornerRadius=u.cornerRadius),u.topLeftRadius!==void 0&&(c.topLeftRadius=u.topLeftRadius),u.topRightRadius!==void 0&&(c.topRightRadius=u.topRightRadius),u.bottomLeftRadius!==void 0&&(c.bottomLeftRadius=u.bottomLeftRadius),u.bottomRightRadius!==void 0&&(c.bottomRightRadius=u.bottomRightRadius))}if(c.children=i.filter((m,h)=>h!==g).map(m=>m.x!==void 0&&m.y!==void 0?{...m,x:m.x-a,y:m.y-o}:m),r){const m=r.getBoundingClientRect();G(c,r,r.style,m)}return c}async function W(t){var r;const e=[];for(let n=0;n<t.childNodes.length;n++){const i=t.childNodes[n];if(i.nodeType===Node.TEXT_NODE){const a=((r=i.textContent)==null?void 0:r.trim())||"";if(!a||a.length===0||/^\s+$/.test(a))continue;const o=await xe({node:i});o&&e.push(o)}}return e}function ve(t,e){const r=i=>i.display==="none"||i.visibility==="hidden"||i.opacity==="0";if(r(t))return!0;let n=e==null?void 0:e.parentElement;for(;n;){const i=getComputedStyle(n);if(r(i)||n.hasAttribute("hidden")||n.classList&&(n.classList.contains("is-hidden")||n.classList.contains("hidden"))||i.overflow!=="visible"&&n.getBoundingClientRect().height<1)return!0;n=n.parentElement}return!1}function pt(t,e){if(e.backgroundClip==="text"||e.webkitBackgroundClip==="text")return!1;const r=e.backgroundColor!=="rgba(0, 0, 0, 0)"&&e.backgroundColor!=="transparent"||e.borderWidth!=="0px"&&e.borderWidth!==""||e.boxShadow!=="none"&&e.boxShadow!==""||e.borderRadius!=="0px"&&e.borderRadius!==""||e.opacity!=="1"&&e.opacity!==""||e.transform!=="none"&&e.transform!==""&&e.transform!=="matrix(1, 0, 0, 1, 0, 0)"||e.filter!=="none"&&e.filter!==""||e.backdropFilter!=="none"&&e.backdropFilter!=="",n=e.padding!=="0px"&&e.padding!==""||e.margin!=="0px"&&e.margin!==""||e.width!=="auto"&&e.width!==""||e.height!=="auto"&&e.height!=="",i=e.backgroundImage!=="none"&&e.backgroundImage!=="";return r||n||i}function Fe(t){function e(r){if(r.nodeType!==Node.ELEMENT_NODE&&r.nodeType!==Node.TEXT_NODE)return null;const n=r.shadowRoot?Array.from(r.shadowRoot.childNodes):[],a=[...Array.from(r.childNodes),...n];return{type:r.nodeType===Node.ELEMENT_NODE?"element":"text",el:r,children:a.map(o=>e(o)).filter(Boolean)}}return e(t)}function S(t,e=!1){const r=t.tagName.toLowerCase();if(e&&t.hasAttribute("data-label")){const i=t.getAttribute("data-label");if(i&&i.trim())return`${r}.${i.trim()}`}if(t.id&&t.id.trim())return`${r}.${t.id.trim()}`;const n=t.className&&t.className.trim()?t.className.trim().split(/\s+/)[0]:null;return n?`${r}.${n}`:r}async function Oe(t,e=!1,r=!1){const n=[];if(t instanceof SVGSVGElement){if(t.id!=="snapdom-injected-svg"){const d=await vt(t);n.push(d)}return n}else if(t instanceof SVGElement)return n;if(t.parentElement instanceof HTMLPictureElement&&t instanceof HTMLSourceElement||t instanceof HTMLPictureElement)return n;const i=window.getComputedStyle(t),a=["absolute","fixed"].includes(i.position);if(ve(i,t)){const d=await W(t);return n.push(...d),n.length>1?[B(n,S(t,e),t,r)]:n}let o=!1;if(pt(t,i)?o=!0:o=(t instanceof HTMLImageElement||t instanceof HTMLVideoElement)&&i.display!=="none",o){const d=Ft(t);if(d.width>=1&&d.height>=1){const c=await z(i,t),g=i.borderWidth!=="0px"&&i.borderWidth!=="",u=i.boxShadow!=="none"&&i.boxShadow!=="",m=i.borderRadius!=="0px"&&i.borderRadius!=="",h=i.opacity!=="1"&&i.opacity!=="",b=i.transform!=="none"&&i.transform!=="",w=(parseFloat(i.paddingTop)||0)>0||(parseFloat(i.paddingRight)||0)>0||(parseFloat(i.paddingBottom)||0)>0||(parseFloat(i.paddingLeft)||0)>0||(parseFloat(i.paddingInlineStart)||0)>0||(parseFloat(i.paddingInlineEnd)||0)>0||(parseFloat(i.paddingBlockStart)||0)>0||(parseFloat(i.paddingBlockEnd)||0)>0;if(c.length===0&&!g&&!u&&!m&&!h&&!b&&!w){const p=await W(t);return n.push(...p),n.length>1?[B(n,S(t,e),t,r)]:n}const L={type:"RECTANGLE",name:S(t,e),x:Math.round(d.left),y:Math.round(d.top),width:Math.round(d.width),height:Math.round(d.height),fills:c};if(a&&(L.layoutPositioning="ABSOLUTE"),G(L,t,i,d),!ct(i)){const p=Dt({computedStyle:i});p&&Object.assign(L,p)}(t instanceof HTMLImageElement||t instanceof HTMLVideoElement||t instanceof SVGSVGElement)&&(L.name=S(t,e));const f=Pt({computedStyle:i});f&&(L.effects=f);const y=st({computedStyle:i,element:t});Object.assign(L,y),n.push(L)}}const l=await W(t);if(n.push(...l),n.length>1){const d=B(n,S(t,e),t,r);if(a&&d&&(d.layoutPositioning="ABSOLUTE"),(parseFloat(i.flexGrow)||0)>0){d.layoutGrow=1;const g=t.parentElement?window.getComputedStyle(t.parentElement).display:"",u=t.parentElement?window.getComputedStyle(t.parentElement).flexDirection:"";(g==="flex"||g==="inline-flex")&&(u==="row"||u==="row-reverse"?(d.layoutSizingHorizontal="FILL",d.layoutSizingVertical="HUG"):(d.layoutSizingHorizontal="HUG",d.layoutSizingVertical="FILL"))}return[d]}if(n.length===1&&(a&&(n[0].layoutPositioning="ABSOLUTE"),(parseFloat(i.flexGrow)||0)>0)){n[0].layoutGrow=1;const c=t.parentElement?window.getComputedStyle(t.parentElement).display:"",g=t.parentElement?window.getComputedStyle(t.parentElement).flexDirection:"";(c==="flex"||c==="inline-flex")&&(g==="row"||g==="row-reverse"?(n[0].layoutSizingHorizontal="FILL",n[0].layoutSizingVertical="HUG"):(n[0].layoutSizingHorizontal="HUG",n[0].layoutSizingVertical="FILL"))}return n}const C=!1;function Ne(t){try{if(t&&t!==document.body&&t!==document.documentElement){const L=t.getBoundingClientRect(),I=t.scrollWidth,f=t.scrollHeight,y=t.clientWidth,p=t.clientHeight,E=Math.max(L.width,I,y),R=Math.max(L.height,f,p);if(E>0&&R>0)return{width:E,height:R}}const e=document.documentElement.scrollWidth,r=document.documentElement.scrollHeight,n=document.body.scrollWidth,i=document.body.scrollHeight,a=t?t.querySelectorAll("*"):document.querySelectorAll("body *");let o=0,s=0,l=1/0,d=1/0;a.forEach(L=>{if(L.offsetParent===null)return;const I=L.getBoundingClientRect();if(I.width===0&&I.height===0)return;const f=I.left+window.scrollX,y=I.top+window.scrollY,p=I.right+window.scrollX,E=I.bottom+window.scrollY;p>0&&E>0&&(o=Math.max(o,p),s=Math.max(s,E),l=Math.min(l,f),d=Math.min(d,y))});const c=document.body.getBoundingClientRect(),g=c.width,u=c.height,m=o-(l===1/0?0:l),h=s-(d===1/0?0:d),b=Math.max(e,n,m,g),w=Math.max(r,i,h,u);if(b<=0||w<=0)throw new Error("主要方法计算出无效尺寸");return{width:b,height:w}}catch{const r=window.innerWidth,n=window.innerHeight,i=document.documentElement.clientWidth,a=document.documentElement.clientHeight,o=document.body.clientWidth,s=document.body.clientHeight,l=Math.max(r,i,o),d=Math.max(n,a,s);return{width:l,height:d}}}async function Se(t={}){const{targetElement:e,filter:r}=t;try{const n=e||document.body,i=Ne(n),a=i.width,o=i.height,{snapdom:s}=await nt(async()=>{const{snapdom:y}=await import("./snapdom-BlfgwPLR.js").then(p=>p.s);return{snapdom:y}},__vite__mapDeps([0,1,2,3,4,5])),l=n.querySelectorAll("img"),d=Array.from(l).filter(y=>y.src.startsWith("data:")),c=Date.now(),g=await s.toBlob(n,{fast:!0,embedFonts:!0,scale:1,dpr:1,format:"svg",filter:typeof r=="function"?r:void 0}),u=Date.now()-c,m=await g.text(),b=new DOMParser().parseFromString(m,"image/svg+xml"),w=b.documentElement;if(w.tagName.toLowerCase()!=="svg")throw console.error("❌ [generatePageSvg] 解析的不是有效的 SVG:",w.tagName),new Error("解析的SVG无效");const L=w.getAttribute("width"),I=w.getAttribute("height"),f=w.getAttribute("viewBox");return{svgBlob:g,svgText:m,svgDoc:b,svgRoot:w,pageWidth:a,pageHeight:o}}catch(n){throw console.error("❌ [generatePageSvg] SVG生成失败:",n),console.error("❌ [generatePageSvg] 错误堆栈:",n.stack),n}}function _e(t){try{const e=t.svgRoot.cloneNode(!0);e.style.cssText=`
      position: absolute;
      left: 0;
      top: 0;
      z-index: 999999;
      pointer-events: none;
    `,e.id="snapdom-injected-svg";let r=document.getElementById("snapdom-shadow-host");return r||(r=document.createElement("div"),r.id="snapdom-shadow-host",r.style.cssText=`
        position: fixed;
        left: 0;
        top: 0;
        width: 0;
        height: 0;
        z-index: 999999;
        pointer-events: none;
      `,r.attachShadow({mode:"open"}),document.body.appendChild(r)),(r.shadowRoot||r.attachShadow({mode:"open"})).appendChild(e),e}catch(e){throw console.error("❌ [SnapDOM] SVG注入失败:",e),e}}function tt(){try{const t=document.getElementById("snapdom-shadow-host");if(t){t.remove();return}}catch(t){console.warn("⚠️ [SnapDOM] SVG清理失败:",t)}}const v={LESS_THAN_TWO_VISIBLE_CHILDREN:"LESS_THAN_TWO_VISIBLE_CHILDREN",OUT_OF_FLOW_CHILD:"OUT_OF_FLOW_CHILD",CHILDREN_OVERLAP:"CHILDREN_OVERLAP",GRID_TEMPLATE_AREAS:"GRID_TEMPLATE_AREAS",EXPLICIT_GRID_PLACEMENT:"EXPLICIT_GRID_PLACEMENT",IMPLICIT_GRID_FIXED_DIMS:"IMPLICIT_GRID_FIXED_DIMS",FLEX_WRAP_WITH_CHILD_MARGINS:"FLEX_WRAP_WITH_CHILD_MARGINS",VISUAL_ORDER_MISMATCH:"VISUAL_ORDER_MISMATCH",NEGATIVE_MARGIN_USED:"NEGATIVE_MARGIN_USED",MARGIN_VARIANCE_HIGH:"MARGIN_VARIANCE_HIGH",TRANSFORM_LAYOUT_HACK:"TRANSFORM_LAYOUT_HACK"};function mt(t,e,r){const n=[],i=[],a=[];for(const f of r){const y=f.getBoundingClientRect(),p=window.getComputedStyle(f);p.display!=="none"&&p.visibility!=="hidden"&&y.width>0&&y.height>0&&a.push({element:f,rect:y,style:p})}const o=e.display;if(a.length<2)return a.map(f=>f.element),n.push(v.LESS_THAN_TWO_VISIBLE_CHILDREN),{deny:!0,reasons:n,warnings:i};let s=!1,l=!1,d=!1,c=!1;const g=e.flexWrap||"nowrap",u=(o==="flex"||o==="inline-flex")&&(g==="wrap"||g==="wrap-reverse"),m=e.gap||"0px",h=parseFloat(e.rowGap)||0,b=parseFloat(e.columnGap)||0,w=m!=="0px"&&m!=="normal"||h>0||b>0,L=u&&!w;for(const{style:f}of a){if(!s&&(f.position==="absolute"||f.position==="fixed")&&(s=!0),!l&&Pe(f)&&(l=!0),!d){const y=f.transform;y&&y!=="none"&&y.includes("translate")&&(d=!0)}if(L&&!c){const y=parseFloat(f.marginBottom)||0,p=parseFloat(f.marginTop)||0,E=parseFloat(f.marginLeft)||0,R=parseFloat(f.marginRight)||0,F=parseFloat(f.marginInlineStart)||0,x=parseFloat(f.marginInlineEnd)||0,O=parseFloat(f.marginBlockStart)||0,T=parseFloat(f.marginBlockEnd)||0;(y>1||p>1||E>1||R>1||F>1||x>1||O>1||T>1)&&(c=!0)}if(s&&l&&d&&(!L||c))break}if(s)return a.map(f=>f.element),n.push(v.OUT_OF_FLOW_CHILD),{deny:!0,reasons:n,warnings:i};if(He(a))return a.map(f=>f.element),n.push(v.CHILDREN_OVERLAP),{deny:!0,reasons:n,warnings:i};if(c)return a.map(f=>f.element),n.push(v.FLEX_WRAP_WITH_CHILD_MARGINS),{deny:!0,reasons:n,warnings:i};if(o==="grid"||o==="inline-grid"){const f=e.gridTemplateAreas;if(f&&f!=="none")return a.map(x=>x.element),n.push(v.GRID_TEMPLATE_AREAS),{deny:!0,reasons:n,warnings:i};if(a.some(({style:x})=>{const O=x.gridRowStart,T=x.gridColumnStart;return O&&O!=="auto"||T&&T!=="auto"}))return a.map(x=>x.element),n.push(v.EXPLICIT_GRID_PLACEMENT),{deny:!0,reasons:n,warnings:i};const p=e.gridTemplateColumns,E=e.gridTemplateRows,R=p&&p!=="none"?p.split(" ").filter(x=>x.trim()).length:0,F=E&&E!=="none"?E.split(" ").filter(x=>x.trim()).length:0;(R>1||F>1)&&a.length>=6&&i.push(`${v.IMPLICIT_GRID_FIXED_DIMS}: container appears to be an implicit grid with cols=${R}, rows=${F}`)}if(!De(a))return a.map(f=>f.element),n.push(v.VISUAL_ORDER_MISMATCH),{deny:!0,reasons:n,warnings:i};if(l)return a.map(f=>f.element),n.push(v.NEGATIVE_MARGIN_USED),{deny:!0,reasons:n,warnings:i};const I=Ge(a);return I.relativeStdDev>1.2&&I.mean>0&&i.push(`${v.MARGIN_VARIANCE_HIGH}: mean=${I.mean.toFixed(2)}, relStdDev=${I.relativeStdDev.toFixed(2)}`),d?(a.map(f=>f.element),n.push(v.TRANSFORM_LAYOUT_HACK),{deny:!0,reasons:n,warnings:i}):{deny:!1,reasons:n,warnings:i}}function He(t,e=1){const r=t.map(n=>n.rect);for(let n=0;n<r.length;n++)for(let i=n+1;i<r.length;i++)if(ke(r[n],r[i],e))return!0;return!1}function ke(t,e,r=1){return!(t.x+t.width<=e.x+r||e.x+e.width<=t.x+r||t.y+t.height<=e.y+r||e.y+e.height<=t.y+r)}function De(t){if(t.length<2)return!0;const e=t.map(s=>s.rect),r=Math.max(...e.map(s=>s.x+s.width))-Math.min(...e.map(s=>s.x)),n=Math.max(...e.map(s=>s.y+s.height))-Math.min(...e.map(s=>s.y)),i=r>=n,o=t.map((s,l)=>({idx:l,rect:s.rect})).slice().sort((s,l)=>i?Math.abs(s.rect.y-l.rect.y)>4?s.rect.y-l.rect.y:s.rect.x-l.rect.x:Math.abs(s.rect.x-l.rect.x)>4?s.rect.x-l.rect.x:s.rect.y-l.rect.y);for(let s=0;s<o.length;s++)if(o[s].idx!==s)return!1;return!0}function Pe(t){const e=parseFloat(t.marginTop)<0||parseFloat(t.marginRight)<0||parseFloat(t.marginBottom)<0||parseFloat(t.marginLeft)<0,r=parseFloat(t.marginInlineStart)<0||parseFloat(t.marginInlineEnd)<0||parseFloat(t.marginBlockStart)<0||parseFloat(t.marginBlockEnd)<0;return e||r}function Ge(t){if(t.length<2)return{mean:0,stdDev:0,relativeStdDev:0};const e=t.map(g=>g.rect),r=Math.max(...e.map(g=>g.x+g.width))-Math.min(...e.map(g=>g.x)),n=Math.max(...e.map(g=>g.y+g.height))-Math.min(...e.map(g=>g.y)),i=r>=n,o=t.map((g,u)=>({idx:u,rect:g.rect})).sort((g,u)=>i?Math.abs(g.rect.y-u.rect.y)>4?g.rect.y-u.rect.y:g.rect.x-u.rect.x:Math.abs(g.rect.x-u.rect.x)>4?g.rect.x-u.rect.x:g.rect.y-u.rect.y),s=[];for(let g=0;g<o.length-1;g++){const u=o[g].rect,m=o[g+1].rect,h=i?m.x-(u.x+u.width):m.y-(u.y+u.height);s.push(h)}if(s.length===0)return{mean:0,stdDev:0,relativeStdDev:0};const l=s.reduce((g,u)=>g+u,0)/s.length,d=Math.sqrt(s.reduce((g,u)=>g+Math.pow(u-l,2),0)/s.length),c=l===0?d>0?1/0:0:d/Math.abs(l);return{mean:l,stdDev:d,relativeStdDev:c}}function Be(t,e){if(!t||!e)return!1;const r=e.display;return r==="flex"||r==="inline-flex"||r==="grid"||r==="inline-grid"}function We(t){switch(t.flexDirection||"row"){case"column":case"column-reverse":return"VERTICAL";case"row":case"row-reverse":default:return"HORIZONTAL"}}function Ue(t){const e=t.gridTemplateRows||"none",r=t.gridTemplateColumns||"none";e==="none"||e.split(" ").length;const n=r==="none"?0:r.split(" ").length;return n>1?{layoutMode:"GRID",gridColumns:n}:{layoutMode:"VERTICAL"}}function Ve(t){switch(t){case"flex-start":case"start":return"MIN";case"center":return"CENTER";case"flex-end":case"end":return"MAX";case"space-between":return"SPACE_BETWEEN";default:return"MIN"}}function ze(t){switch(t){case"flex-start":case"start":return"MIN";case"center":return"CENTER";case"flex-end":case"end":return"MAX";case"baseline":return"BASELINE";case"stretch":return"MIN";default:return"MIN"}}function $e(t){switch(t){case"start":case"flex-start":case"self-start":return"MIN";case"center":return"CENTER";case"end":case"flex-end":case"self-end":return"MAX";case"left":return"MIN";case"right":return"MAX";case"stretch":return"MIN";default:return"MIN"}}function Xe(t,e){const r=t.gap;if(r&&r!=="normal"&&r!=="0px"){const n=r.split(" ");return n.length===2?parseFloat(e==="HORIZONTAL"?n[1]:n[0])||0:parseFloat(r)||0}if(e==="HORIZONTAL"){const n=t.columnGap||t.gridColumnGap;return parseFloat(n)||0}else{const n=t.rowGap||t.gridRowGap;return parseFloat(n)||0}}function je(t){const e=parseFloat(t.paddingTop)||parseFloat(t.paddingBlockStart)||0,r=parseFloat(t.paddingRight)||parseFloat(t.paddingInlineEnd)||0,n=parseFloat(t.paddingBottom)||parseFloat(t.paddingBlockEnd)||0,i=parseFloat(t.paddingLeft)||parseFloat(t.paddingInlineStart)||0;return{paddingTop:e,paddingRight:r,paddingBottom:n,paddingLeft:i}}function Ye(t){const e=t.flexWrap||"nowrap";return e==="wrap"||e==="wrap-reverse"?"WRAP":"NO_WRAP"}function qe(t,e){if(!Be(t,e))return null;const r=Array.from(t.children).filter(f=>f instanceof HTMLElement);if(mt(t,e,r).deny)return null;const i=e.display,a=i==="grid"||i==="inline-grid";let o,s;if(a){const f=Ue(e);o=f.layoutMode,s=f.gridColumns}else o=We(e);const l=Xe(e,o),d=je(e),c=e.justifyContent||"flex-start",g=e.alignItems||"stretch",u=e.justifyItems||"",m=Ve(c);let h=ze(g);u&&u!=="legacy"&&u!=="normal"&&(h=$e(u));const b=o==="GRID"?void 0:a?"WRAP":Ye(e);let w="AUTO",L="AUTO";if(o==="HORIZONTAL"){const f=e.width;f&&f!=="auto"&&(f.includes("%")&&parseFloat(f)===100||f.includes("px"))&&(w="FIXED");const y=e.height;y&&y!=="auto"&&y.includes("px")&&(L="FIXED")}else if(o==="VERTICAL"){const f=e.height;f&&f!=="auto"&&(f.includes("%")&&parseFloat(f)===100||f.includes("px"))&&(w="FIXED");const y=e.width;y&&y!=="auto"&&y.includes("px")&&(L="FIXED")}const I={layoutMode:o,primaryAxisSizingMode:w,counterAxisSizingMode:L,primaryAxisAlignItems:m,counterAxisAlignItems:h,itemSpacing:l,...d,layoutPositioning:"AUTO"};return b!==void 0&&(I.layoutWrap=b,b==="WRAP"&&(I.counterAxisSpacing=l||0)),o==="GRID"&&s&&(I.gridColumnCount=s,I.gridColumnGap=l||0,I.gridRowGap=l||0),I}const et="export-overlay-root",A=!1;function Ke(t){return t instanceof Element?!!(t.id===et||typeof t.closest=="function"&&t.closest(`#${et}`)):!1}function bt(t){if(!(t instanceof Element))return!1;try{const e=t.style,r=e.overflowX,n=e.overflowY;return r==="hidden"||n==="hidden"}catch(e){return console.warn("⚠️ [hasOverflowHidden] 无法获取计算样式:",e),!1}}function Ze(t,e,r,n=null,i=!1){var y;if(!t||t.length===0)return null;const a=()=>{};if(a("start createFrameFromLayers",{layerCount:t.length,firstLayer:t[0]?{type:t[0].type,name:t[0].name,width:t[0].width,height:t[0].height}:null}),t.length===1&&!n)return t[0];const o=V(t),s=o.filter(p=>p.layoutPositioning!=="ABSOLUTE"&&p.layoutPositioning!=="FIXED"),l=s.length>0?s:o,d=p=>{let E=Number.POSITIVE_INFINITY,R=Number.POSITIVE_INFINITY,F=Number.NEGATIVE_INFINITY,x=Number.NEGATIVE_INFINITY,O=0;for(const T of p)typeof T.x=="number"&&typeof T.y=="number"&&typeof T.width=="number"&&typeof T.height=="number"&&(E=Math.min(E,T.x),R=Math.min(R,T.y),F=Math.max(F,T.x+T.width),x=Math.max(x,T.y+T.height),O+=1);return O===0?null:{x:E,y:R,width:F-E,height:x-R}};let c=null;const g=[];for(const p of l)if(p.type==="RECTANGLE"&&!c){c=p;break}let u,m,h,b;if(c){const p=d(l),E=(y=r==null?void 0:r.getBoundingClientRect)==null?void 0:y.call(r),R=typeof c.name=="string"&&typeof e=="string"&&c.name===e;if(p){const F=c.width>=p.width*.9,x=c.height>=p.height*.9,O=c.x<=p.x+1,T=c.y<=p.y+1,wt=c.x+c.width>=p.x+p.width-1,It=c.y+c.height>=p.y+p.height-1,yt=c.width*c.height>=p.width*p.height*.8,Et=!!E&&Math.abs(c.width-E.width)<=2&&Math.abs(c.height-E.height)<=2&&Math.abs(c.x-E.x)<=2&&Math.abs(c.y-E.y)<=2,Lt=F&&x&&O&&T&&wt&&It&&yt;a("background coverage check",{bgName:c.name,bgSize:{w:c.width,h:c.height}}),!Lt&&!Et&&!R&&(a("background rejected, fallback to element bounding rect",{bgName:c.name}),c=null)}}if(c){u=c.x,m=c.y,h=c.width,b=c.height,a("use backgroundLayer as frame basis",{bgName:c.name,bgType:c.type});for(const p of o)p!==c&&g.push(p)}else{const p=r.getBoundingClientRect();u=p.x,m=p.y,h=p.width,b=p.height,g.push(...o)}let w=g.map(p=>p.x!==void 0&&p.y!==void 0?{...p,x:p.x-u,y:p.y-m}:p);const L=bt(r),I=i?"FRAME":"GROUP",f={type:I,name:e||I,x:u,y:m,width:h,height:b,clipsContent:L,children:[]};if(a("frameLayer created",{name:f.name,x:f.x,y:f.y,width:f.width,height:f.height,childCount:w.length}),c){const p=c.fills&&c.fills.some(E=>E.type==="IMAGE");!i&&p?(a("GROUP mode with image fill, keeping background as separate layer",{bgName:c.name}),w.unshift({...c,x:0,y:0})):(c.fills&&c.fills.length>0&&(f.fills=c.fills),c.strokes&&(f.strokes=c.strokes),c.strokeWeight!==void 0&&(f.strokeWeight=c.strokeWeight),c.strokeAlign!==void 0&&(f.strokeAlign=c.strokeAlign),c.cornerRadius!==void 0&&(f.cornerRadius=c.cornerRadius),c.topLeftRadius!==void 0&&(f.topLeftRadius=c.topLeftRadius,f.topRightRadius=c.topRightRadius,f.bottomLeftRadius=c.bottomLeftRadius,f.bottomRightRadius=c.bottomRightRadius),c.effects&&c.effects.length>0&&(f.effects=c.effects),c.opacity!==void 0&&c.opacity!==1&&(f.opacity=c.opacity))}else i&&(f.fills=[{type:"SOLID",color:{r:1,g:1,b:1},opacity:0}]);if(f.children=w,n&&Object.assign(f,n),r){const p=r.getBoundingClientRect();G(f,r,r.style,p)}return f}const Je=async(t,e)=>{const{useFrames:r,rootName:n,time:i,isAxure:a,widgetId:o,enableAutoLayout:s=!0}=e,l=t.className,d="figma-target-element";try{await te(t),t.classList.add(d);const c=await Se({targetElement:t,filter:h=>!Ke(h)}),g=_e(c);let u=g.querySelector(`.${d}`);u||(console.warn("⚠️ [processWithSnapDOM] 未找到标识元素，尝试查找 body"),u=g.querySelector("body")),u||(console.warn("⚠️ [processWithSnapDOM] 未找到 body，使用整个 SVG"),u=g);const m=await Qe(u,{useFrames:r,rootName:n,time:i,isAxure:a,widgetId:o,size:{width:c.pageWidth,height:c.pageHeight},isSnapdomProcessing:!0,enableAutoLayout:s});return tt(),t.className=l,m}catch(c){console.error("❌ [processWithSnapDOM] SnapDOM 方案失败:",c),t.className=l;try{tt()}catch(g){console.warn("⚠️ [processWithSnapDOM] 清理失败:",g)}return null}};async function U(t,e=!1,r=!1,n=!0){const i=[];if(!t)return i;if(t.type==="element"){const a=await Oe(t.el,r,n);if(t.el instanceof SVGSVGElement&&t.el.id!=="snapdom-injected-svg")return a;const o=bt(t.el);let s=!1,l=null,d=null,c=!1;try{if(d=window.getComputedStyle(t.el),n){const h=qe(t.el,d);if(h!==null){const b=t.children.filter(L=>L.type==="element").map(L=>L.el),w=mt(t.el,d,b);w.deny?(l=null,s=!1):(l=h,s=!0,w.warnings.length>0)}}const m=d.display;t.children&&t.children.length>2&&m&&!["inline","inline-block","inline-flex","inline-grid"].includes(m)&&(c=!0)}catch(m){console.warn("⚠️ [Auto Layout] 无法检测布局属性:",m),console.warn("⚠️ [Auto Layout] 样式获取失败元素:",{name:S(t.el,r),tag:t.el.tagName})}let g=!1;if(t.children&&t.children.length>0){const m=d||(()=>{try{return window.getComputedStyle(t.el)}catch{return t.el.style}})();try{g=pt(t.el,m)}catch{}}if(!d&&t.children&&t.children.length>0&&(c=!0,console.warn("[structure][fallback] 无法获取样式，保守创建 FRAME",{name:S(t.el,r),tag:t.el.tagName,childCount:t.children.length})),(e||o||s||g||c)&&n){const m=[];for(const b of t.children){const w=await U(b,e||s,r,n);m.push(...w)}const h=[...a,...m];if(h.length>0){const b=Ze(h,S(t.el,r),t.el,l,n);b&&i.push(b)}return i}else i.push(...a)}if(!e)for(const a of t.children){const o=await U(a,e,r,n);i.push(...o)}return i}const Qe=async(t,e)=>{const{useFrames:r,rootName:n,time:i,size:a,isAxure:o=!1,widgetId:s,enableAutoLayout:l=!0}=e;xt(t);const d=Fe(t),c=await U(d,r,o,l),g=V(c),u={type:"FRAME",name:n||"FRAME",widgetId:s||null,width:a.width||Math.round(t.scrollWidth),height:a.height||Math.round(t.scrollHeight),x:0,y:0,children:g},m=qt([u]);return i&&(console.info(`
`),console.timeEnd("Parse dom")),m};async function sn(t="body",e){const{useFrames:r=!1,time:n=!1,rootName:i,isAxure:a=!1,widgetId:o,enableAutoLayout:s=!0}=e;n&&console.time("Parse dom");const l=t instanceof HTMLElement?t:document.querySelector(t||"body");return l?Je(l,{useFrames:r,rootName:i,isAxure:a,time:n,widgetId:o,enableAutoLayout:s}):[]}export{sn as htmlToFigma,Qe as processWithOriginalLogic};
