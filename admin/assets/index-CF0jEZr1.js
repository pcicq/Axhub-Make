const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/snapdom-q1ENrNRf.js","assets/preload-helper-D7HrI6pR.js"])))=>i.map(i=>d[i]);
import{_ as rt}from"./preload-helper-D7HrI6pR.js";const Rt=t=>{for(const e of Array.from(t.querySelectorAll("use")))try{const r=e.href.baseVal,n=document.querySelector(r);n&&(e.outerHTML=n.innerHTML)}catch(r){console.warn("Error querying <use> tag href",r)}},Tt=["display","visibility","opacity","fill","fillOpacity","fillRule","stroke","strokeWidth","strokeLinecap","strokeLinejoin","strokeOpacity","strokeDasharray","strokeDashoffset","fontFamily","fontSize","fontWeight","fontStyle","textAnchor","dominantBaseline","transform","filter","mixBlendMode","color"];function Ct(t){const e=t.style,r=[];for(const i of Tt){const o=e[i];if(o&&o.trim()!==""){const a=i.replace(/([A-Z])/g,"-$1").toLowerCase();i==="fill"&&(o==="rgb(0, 0, 0)"||o==="black")||i==="stroke"&&o==="none"||i==="strokeWidth"&&o==="1px"||i==="opacity"&&o==="1"||i==="display"&&o==="block"||i==="visibility"&&o==="visible"||r.push(`${a}:${o}`)}}return r.join(";")}function At(t){const e=t.outerHTML.length;function r(i){const o=Ct(i);i.removeAttribute("style"),o&&i.setAttribute("style",o);for(const a of i.children)r(a)}return r(t),(t.outerHTML.length/e*100).toFixed(1),t.outerHTML}async function Mt(t){try{const e=t.cloneNode(!0);return At(e)}catch(e){return console.warn("⚠️ [SVG压缩] 样式清理失败，使用原始SVG:",e),t.outerHTML}}function Ft(t){if(!(t instanceof SVGSVGElement))throw new Error("需要传入一个 <svg> 元素");const e=t.getBoundingClientRect();return{x:e.left+window.scrollX,y:e.top+window.scrollY,width:e.width,height:e.height}}const vt=async t=>{const e=Ft(t);return{type:"SVG",svg:await Mt(t),x:Math.round(e.x),y:Math.round(e.y),width:Math.round(e.width),height:Math.round(e.height)}};function Ot(t){const e=t.getBoundingClientRect();return{...e,documentX:e.left+window.scrollX,documentY:e.top+window.scrollY,left:e.left,top:e.top,right:e.right,bottom:e.bottom,width:e.width,height:e.height,x:e.x,y:e.y}}const N=t=>{if(!t)return null;const e=t.match(/([\d\.]+(?:e[+-]?\d+)?)px/i),r=e==null?void 0:e[1];return r?{unit:"PIXELS",value:parseFloat(r)}:null},P=(t,e=0,r=0)=>{if(!t)return null;const n=t.match(/([\d\.]+(?:e[+-]?\d+)?)px/i);if(n){const a=parseFloat(n[1]);return{unit:"PIXELS",value:Math.min(a,1e4)}}const i=t.match(/([\d\.]+(?:e[+-]?\d+)?)%/i);if(i){const a=parseFloat(i[1]),s=Math.max(e,r),u=a/100*s;return{unit:"PIXELS",value:Math.min(u,1e4)}}const o=t.match(/^([\d\.]+(?:e[+-]?\d+)?)$/i);if(o){const a=parseFloat(o[1]);return{unit:"PIXELS",value:Math.min(a,1e4)}}return null};function Nt(t,e,r){let n=(t+16)/116,i=e/500+n,o=n-r/200;const a=d=>d>.206897?Math.pow(d,3):(d-16/116)/7.787;i=a(i)*95.047,n=a(n)*100,o=a(o)*108.883,i=i/100,n=n/100,o=o/100;let s=i*3.2406+n*-1.5372+o*-.4986,u=i*-.9689+n*1.8758+o*.0415,c=i*.0557+n*-.204+o*1.057;const l=d=>d>.0031308?1.055*Math.pow(d,1/2.4)-.055:12.92*d;return s=l(s),u=l(u),c=l(c),s=Math.max(0,Math.min(1,s)),u=Math.max(0,Math.min(1,u)),c=Math.max(0,Math.min(1,c)),{r:s,g:u,b:c}}function v(t){if(!t)return null;if(t.toLowerCase()==="transparent")return{r:0,g:0,b:0,a:0};const e=t.match(/lab\(\s*([0-9.]+%?)\s+([+-]?[0-9.]+)\s+([+-]?[0-9.]+)(?:\s*\/\s*([0-9.]+%?))?\s*\)/i);if(e){const i=parseFloat(e[1]),o=parseFloat(e[2]),a=parseFloat(e[3]);let s=1;if(e[4]){const c=parseFloat(e[4]);s=e[4].includes("%")?c/100:c}const u=Nt(i,o,a);return{r:u.r,g:u.g,b:u.b,a:s}}const r=t.match(/rgba?\(([\d\.]+),\s*([\d\.]+),\s*([\d\.]+)(?:,\s*([\d\.]+))?\)/);if(r){const[i,o,a,s,u]=r,c=u&&parseFloat(u)===0;if(o&&a&&s&&!c)return{r:parseInt(o)/255,g:parseInt(a)/255,b:parseInt(s)/255,a:u?parseFloat(u):1}}const n=t.match(/^#([0-9a-f]{3}|[0-9a-f]{6})$/i);if(n){let i=n[1];return i.length===3&&(i=i.split("").map(o=>o+o).join("")),{r:parseInt(i.slice(0,2),16)/255,g:parseInt(i.slice(2,4),16)/255,b:parseInt(i.slice(4,6),16)/255,a:1}}return null}const Gt=/^[0-9]+[a-zA-Z%]+?$/,it=t=>{if(!/px$/.test(t)&&t!=="0")return 0;const e=parseFloat(t);return isNaN(e)?0:e},ot=t=>t==="0"||Gt.test(t),z=t=>{if(t.startsWith("rgb")){const d=t.match(/(rgba?\(.+?\))(.+)/);d&&(t=(d[2]+" "+d[1]).trim())}const e=/\s(?![^(]*\))/,r=t.split(e),n=r.includes("inset"),i=r.slice(-1)[0],o=ot(i)?"rgba(0, 0, 0, 1)":i,a=r.filter(d=>d!=="inset").filter(d=>d!==o).map(it),[s=0,u=0,c=0,l=0]=a;return{inset:n,offsetX:s,offsetY:u,blurRadius:c,spreadRadius:l,color:o}},Pt=t=>{if(!t||t==="none")return[];const e=[];let r="",n=0;for(let i=0;i<t.length;i++){const o=t[i];if(o==="(")n++;else if(o===")")n--;else if(o===","&&n===0&&r.trim()){e.push(z(r.trim())),r="";continue}r+=o}return r.trim()&&e.push(z(r.trim())),e},$=t=>{if(t.startsWith("rgb")){const c=t.match(/(rgba?\(.+?\))(.+)/);c&&(t=(c[2]+" "+c[1]).trim())}const e=/\s(?![^(]*\))/,r=t.split(e),n=r.slice(-1)[0],i=ot(n)?"rgba(0, 0, 0, 1)":n,o=r.filter(c=>c!==i).map(it),[a=0,s=0,u=0]=o;return{offsetX:a,offsetY:s,blurRadius:u,color:i}},at=t=>{if(!t||t==="none")return[];const e=[];let r="",n=0;for(let i=0;i<t.length;i++){const o=t[i];if(o==="(")n++;else if(o===")")n--;else if(o===","&&n===0&&r.trim()){e.push($(r.trim())),r="";continue}r+=o}return r.trim()&&e.push($(r.trim())),e},Ht=t=>{if(!t||t==="none")return[];const e=[],r=/(\w+)\(([^)]+)\)/g;let n;for(;(n=r.exec(t))!==null;){const[,i,o]=n;switch(i){case"blur":const a=parseFloat(o);isNaN(a)||e.push({type:"LAYER_BLUR",radius:a,visible:!0});break;case"brightness":case"contrast":case"saturate":case"hue-rotate":case"invert":case"sepia":case"opacity":e.push({type:"CUSTOM_FILTER",filterType:i,value:parseFloat(o)||1,visible:!0});break}}return e},_t=t=>{if(!t||t==="none")return[];const e=[],r=/(\w+)\(([^)]+)\)/g;let n;for(;(n=r.exec(t))!==null;){const[,i,o]=n;if(i==="blur"){const a=parseFloat(o);isNaN(a)||e.push({type:"BACKGROUND_BLUR",radius:a,visible:!0})}}return e},st=({computedStyle:t,element:e=null})=>{let r=0,n=0;if(e){const c=e.getBoundingClientRect();r=c.width,n=c.height}const i=P(t.borderTopLeftRadius,r,n),o=P(t.borderTopRightRadius,r,n),a=P(t.borderBottomRightRadius,r,n),s=P(t.borderBottomLeftRadius,r,n);return Object.assign(Object.assign(Object.assign(Object.assign({},i?{topLeftRadius:i.value}:{}),o?{topRightRadius:o.value}:{}),a?{bottomRightRadius:a.value}:{}),s?{bottomLeftRadius:s.value}:{})},kt=({borderWidth:t,borderType:e,borderColor:r})=>t&&t!=="0"&&e!=="none"&&r;function Dt(t){const e={top:t.borderTop,right:t.borderRight,bottom:t.borderBottom,left:t.borderLeft};if(!Object.values(e).some(a=>a&&a!=="none"))return{consistent:!1,borderInfo:null};const n={};for(const[a,s]of Object.entries(e))if(s&&s!=="none"){const u=s.match(/^([\d\.]+)px\s*(\w+)\s*(.*)$/);if(u){const[c,l,d,f]=u;n[a]={borderWidth:l,borderType:d,borderColor:f}}}else n[a]={borderWidth:"0",borderType:"none",borderColor:"transparent"};const i=Object.values(n).find(a=>a.borderWidth!=="0");return i?{consistent:Object.values(n).every(a=>a.borderWidth===i.borderWidth&&a.borderType===i.borderType&&a.borderColor===i.borderColor),borderInfo:i}:{consistent:!1,borderInfo:null}}const Bt=({computedStyle:t})=>{if(t.border&&t.border!=="none"){const n=t.border.match(/^([\d\.]+)px\s*(\w+)\s*(.*)$/);if(n){const[i,o,a,s]=n;if(kt({borderWidth:o,borderType:a,borderColor:s})){const u=v(s);if(u)return{strokes:[{type:"SOLID",color:{r:u.r,b:u.b,g:u.g},opacity:u.a||1}],strokeWeight:Math.round(parseFloat(o))}}}}const{consistent:e,borderInfo:r}=Dt(t);if(e&&r){const n=v(r.borderColor);if(n)return{strokes:[{type:"SOLID",color:{r:n.r,b:n.b,g:n.g},opacity:n.a||1}],strokeWeight:Math.round(parseFloat(r.borderWidth))}}return null},j=t=>t?{r:t.r,g:t.g,b:t.b,a:t.a!==void 0?t.a:1}:null,X=t=>{const e=t.mixBlendMode;return{normal:"NORMAL",multiply:"MULTIPLY",screen:"SCREEN",overlay:"OVERLAY",darken:"DARKEN",lighten:"LIGHTEN","color-dodge":"COLOR_DODGE","color-burn":"COLOR_BURN","hard-light":"HARD_LIGHT","soft-light":"SOFT_LIGHT",difference:"DIFFERENCE",exclusion:"EXCLUSION",hue:"HUE",saturation:"SATURATION",color:"COLOR",luminosity:"LUMINOSITY"}[e]||"NORMAL"},St=({computedStyle:t})=>{const e=[];return t.boxShadow&&t.boxShadow!=="none"&&Pt(t.boxShadow).forEach(n=>{const i=v(n.color);if(i){const o=j(i),a=X(t);n.inset?e.push({type:"INNER_SHADOW",color:o,offset:{x:n.offsetX,y:n.offsetY},radius:n.blurRadius,spread:n.spreadRadius||0,visible:!0,blendMode:a}):e.push({type:"DROP_SHADOW",color:o,offset:{x:n.offsetX,y:n.offsetY},radius:n.blurRadius,spread:n.spreadRadius||0,visible:!0,blendMode:a})}}),t.textShadow&&t.textShadow!=="none"&&at(t.textShadow).forEach(n=>{const i=v(n.color);if(i){const o=j(i),a=X(t);e.push({type:"DROP_SHADOW",color:o,offset:{x:n.offsetX,y:n.offsetY},radius:n.blurRadius,spread:0,visible:!0,blendMode:a})}}),t.filter&&t.filter!=="none"&&Ht(t.filter).forEach(n=>{n.type==="LAYER_BLUR"&&e.push({type:"LAYER_BLUR",radius:n.radius,visible:!0})}),t.backdropFilter&&t.backdropFilter!=="none"&&_t(t.backdropFilter).forEach(n=>{n.type==="BACKGROUND_BLUR"&&e.push({type:"BACKGROUND_BLUR",radius:n.radius,visible:!0})}),e.length>0?e:void 0},Wt={fill:"FILL",contain:"FIT",cover:"CROP","scale-down":"FIT",none:"TILE"};function Ut(t){if(!t||t==="none")return"TILE";if(t==="contain")return"FIT";if(t==="cover")return"CROP";if(t==="auto")return"TILE";const e=t.split(/\s+/);if(e.length>=1){const[r,n]=e;if(r==="100%"&&n==="100%")return"FILL";if(e.length===1)return r==="100%"?"FILL":r==="auto"?"TILE":"CROP";if(e.length>=2){if(n==="auto"&&(r.includes("%")||r.includes("px"))||r==="auto"&&(n.includes("%")||n.includes("px"))||(r.includes("%")||r.includes("px"))&&(n.includes("%")||n.includes("px")))return"CROP";if(r==="auto"&&n==="auto")return"TILE"}}return"FILL"}function Vt(t){let e=t.parentElement;for(;e;){const n=getComputedStyle(e).overflow;if(n!=="visible")return n;e=e.parentElement}return"visible"}function zt(t,e){return(e==="hidden"||e==="scroll"||e==="auto")&&(t==="FIT"||t==="TILE")?"CROP":t}function H(t,e,r){let n;if(e==="background")n=Ut(t.backgroundSize);else{const o=t.objectFit||"fill";n=Wt[o]||"FILL"}const i=Vt(r);return zt(n,i)}const $t=({computedStyle:t,el:e})=>{if(e instanceof SVGSVGElement){const r=`data:image/svg+xml,${encodeURIComponent(e.outerHTML.replace(/\s+/g," "))}`,n=H(t,"image",e);return{url:r,type:"IMAGE",scaleMode:n,imageHash:null}}else if(e instanceof HTMLImageElement){const r=e.src;if(r){const n=H(t,"image",e);e.getAttribute("data-from-canvas"),r.startsWith("data:");const i=q(r),o={type:"IMAGE",scaleMode:n,imageHash:null,intArr:Array.from(i)};return Object.assign({url:r},o)}else console.warn("⚠️ [getImagePaintWithUrl] IMG 元素没有 src:",e)}else if(e instanceof HTMLVideoElement){const r=e.poster;if(r){const n=H(t,"image",e),i=q(r),o={type:"IMAGE",scaleMode:n,imageHash:null,intArr:Array.from(i)};return Object.assign({url:r},o)}}if(t.backgroundImage&&t.backgroundImage!=="none"){const r=t.backgroundImage.match(/url\(['"]?(.*?)['"]?\)/),n=r==null?void 0:r[1];if(n){if(n.includes(".svg")||n.includes("data:image/svg+xml"))return;const i=H(t,"background",e);return{url:n,type:"IMAGE",scaleMode:i,imageHash:null}}}},Y=";base64,";function q(t){try{const e=t.indexOf(Y)+Y.length,r=t.substring(e);if(!r||r.trim()==="")return console.warn("⚠️ [convertDataURIToBinary] base64 内容为空"),new Uint8Array(0);const n=window.atob(r),i=n.length,o=new Uint8Array(new ArrayBuffer(i));for(let a=0;a<i;a++)o[a]=n.charCodeAt(a);return o}catch(e){return console.warn("⚠️ [convertDataURIToBinary] base64 解码失败:",e),new Uint8Array(0)}}function jt(t){const e=t.zIndex;return e==="auto"||e===""||isNaN(parseInt(e))?0:parseInt(e)}function Xt(t){return t.parentElement?Array.from(t.parentElement.children).indexOf(t):0}function k(t,e,r,n){if(!e||!r||!n)return;const i=jt(r),o=Xt(e),a=e.parentElement;t._sortingCache={zIndex:i,elementIndex:o,parentElement:a,originalElement:e}}function Yt(t,e){const r=t._sortingCache,n=e._sortingCache;return!r||!n?(console.warn("⚠️ [compareLayers] 图层缺少排序缓存，跳过排序"),0):r.parentElement===n.parentElement&&r.zIndex!==n.zIndex?r.zIndex-n.zIndex:0}function qt(t){if(!t||t.length<=1)return t;const e=t.map((r,n)=>({layer:r,originalIndex:n}));return e.sort((r,n)=>{const i=r.layer._sortingCache,o=n.layer._sortingCache;if(!i||!o)return r.originalIndex-n.originalIndex;const a=Yt(r.layer,n.layer);return a!==0?a:r.originalIndex-n.originalIndex}),e.map(r=>r.layer)}function Kt(t){if(!t||!Array.isArray(t))return console.warn("⚠️ [cleanLayersSortingCache] layers 不是数组"),t;const e=r=>(!r||typeof r!="object"||(r._sortingCache&&delete r._sortingCache,r.children&&Array.isArray(r.children)&&r.children.forEach(n=>e(n))),r);return t.forEach(r=>e(r)),t}function Zt(t){if(!t||!Array.isArray(t))return console.warn("⚠️ [cleanLayersDebugProperties] layers 不是数组"),t;const e=r=>(!r||typeof r!="object"||(r._sortingCache&&delete r._sortingCache,r._debug&&delete r._debug,r._tempRef&&delete r._tempRef,r.children&&Array.isArray(r.children)&&r.children.forEach(n=>e(n))),r);return t.forEach(r=>e(r)),t}function ct(t){return!t||!Array.isArray(t)?t:qt(t).map(n=>n&&typeof n=="object"&&n.children&&Array.isArray(n.children)?{...n,children:ct(n.children)}:n)}function U(t){const e=ct(t);return Kt(e)}const Jt=t=>typeof t=="symbol"?null:JSON.parse(JSON.stringify(t));async function Qt(t){try{const r=await(await fetch(t,{method:"GET",mode:"cors"})).blob(),n=r.type;return n!=="image/png"&&n!=="image/jpeg"?await G(await K(r),n):`data:${n};base64,${await K(r)}`}catch(e){return console.error("Failed to load image as base64:",e),null}}function K(t){return new Promise((e,r)=>{const n=new FileReader;n.onload=()=>{const o=n.result.split(",")[1];e(o)},n.onerror=r,n.readAsDataURL(t)})}function G(t,e){return new Promise((r,n)=>{const i=new Image,o=setTimeout(()=>{n(new Error("Image load timeout"))},1e4);i.onload=()=>{clearTimeout(o);const s=document.createElement("canvas"),u=s.getContext("2d");if(!u){const c=new Error("Failed to get canvas context");console.error("❌ [imgToPng]",c),n(c);return}s.width=i.width,s.height=i.height;try{u.drawImage(i,0,0);const c=s.toDataURL("image/png");r(c)}catch(c){console.error("❌ [imgToPng] Canvas 绘制失败:",c),n(c)}},i.onerror=s=>{clearTimeout(o),n(new Error(`Failed to load image: ${s.type||"unknown error"}`))};const a=`data:${e};base64,${t}`;i.src=a})}function te(){const t=arguments.length>0?arguments[0]:document,e=arguments.length>1?arguments[1]:void 0,r=e&&typeof e.timeoutMs=="number"?e.timeoutMs:8e3,n=t&&typeof t.querySelectorAll=="function"?t:document;return new Promise(i=>{const o=n.querySelectorAll("img");if(o.length===0){i();return}let a=0;const s=o.length,u=typeof performance<"u"?performance.now():Date.now(),c=new Set,l=()=>{a++,a===s&&i()};o.forEach(d=>{c.add(d);const f=()=>{c.has(d)&&c.delete(d),l()};if(d.complete)f();else{const p=()=>{b(),f()},h=()=>{b(),f()},b=()=>{d.removeEventListener("load",p),d.removeEventListener("error",h),clearTimeout(w)},w=setTimeout(()=>{b(),f()},r);d.addEventListener("load",p,{once:!0}),d.addEventListener("error",h,{once:!0})}}),setTimeout(()=>{if(a!==s){const d=Math.round((typeof performance<"u"?performance.now():Date.now())-u);console.warn("⚠️ [areAllImagesLoaded] timeout, continue anyway",{elapsedMs:d,totalImages:s,remaining:c.size}),i()}},r+50)})}const S=!1;async function ee(t){t.querySelectorAll("canvas").forEach((r,n)=>{try{if(r.width===0||r.height===0)return;let i;try{i=r.toDataURL("image/png")}catch{const u=document.createElement("img");u.style.width=r.style.width||r.width+"px",u.style.height=r.style.height||r.height+"px",u.style.backgroundColor="#f0f0f0",u.setAttribute("data-canvas-tainted","true"),u.setAttribute("alt","Canvas (跨域限制)");const c=window.getComputedStyle(r);u.style.display=c.display,u.style.position=c.position,r.parentNode&&r.parentNode.replaceChild(u,r);return}const o=document.createElement("img");o.src=i;const a=window.getComputedStyle(r);o.style.width=r.style.width||r.width+"px",o.style.height=r.style.height||r.height+"px",o.style.display=a.display,o.style.position=a.position,o.style.top=a.top,o.style.left=a.left,o.style.right=a.right,o.style.bottom=a.bottom,o.style.margin=a.margin,o.style.padding=a.padding,r.className&&(o.className=r.className),r.id&&(o.id=r.id),o.setAttribute("data-from-canvas","true"),r.parentNode&&r.parentNode.replaceChild(o,r)}catch(i){console.error(`❌ [convertCanvasToImage] Canvas ${n+1} 转换失败:`,i),console.error("❌ [convertCanvasToImage] 错误堆栈:",i.stack)}})}async function ne(t){try{await ee(t),await te(t);const e=[],r=t.querySelectorAll("img");for(let n=0;n<r.length;n++){const i=r[n],o=i.currentSrc||i.src;if(o){if(o.startsWith("data:image/webp")){const a=(async()=>{try{const s=o.split(";base64,")[1];if(s){const u=await G(s,"image/webp");i.setAttribute("src",u)}}catch{}return!0})();e.push(a);continue}if(o&&!o.startsWith("data")){const a=(async()=>{var s,u,c;try{const l=new URL(o,document.baseURI).href,f=typeof globalThis<"u"&&((u=(s=globalThis.chrome)==null?void 0:s.runtime)==null?void 0:u.sendMessage)?await Promise.race([globalThis.chrome.runtime.sendMessage({type:"getResourceContent",src:l}),new Promise(p=>setTimeout(()=>p(null),8e3))]):null;if((c=f==null?void 0:f.data)!=null&&c.base64Encoded){if(f.data.mimeType!=="image/png"&&f.data.mimeType!=="image/jpeg")try{const p=await G(f.data.content,f.data.mimeType);i.setAttribute("src",p)}catch{try{const h=`data:${f.data.mimeType};base64,${f.data.content}`;i.setAttribute("src",h)}catch{}}else{const p=`data:${f.data.mimeType};base64,${f.data.content}`;i.setAttribute("src",p)}return!0}else return!1}catch{return!1}})();e.push(a)}}}if(e.length>0)try{const n=new Promise(i=>{setTimeout(()=>{i(new Array(e.length).fill(!1))},3e4)});await Promise.race([Promise.allSettled(e),n])}catch{}}catch{}}function re(t){if(!t||t==="none")return[];const e=[];let r="",n=0,i=!1,o="";for(let a=0;a<t.length;a++){const s=t[a],u=a>0?t[a-1]:"";if((s==='"'||s==="'")&&u!=="\\"&&(i?s===o&&(i=!1,o=""):(i=!0,o=s)),i||(s==="("?n++:s===")"&&n--),s===","&&!i&&n===0){const c=r.trim();c&&e.push(c),r=""}else r+=s}return r.trim()&&e.push(r.trim()),e}function ie(t){return t?t.split(",").map(e=>e.trim()).filter(Boolean):[]}function oe(t){switch((t||"").toLowerCase()){case"normal":case"src-over":return"NORMAL";case"multiply":return"MULTIPLY";case"screen":return"SCREEN";case"overlay":return"OVERLAY";case"darken":return"DARKEN";case"lighten":return"LIGHTEN";case"color-dodge":return"COLOR_DODGE";case"color-burn":return"COLOR_BURN";case"hard-light":return"HARD_LIGHT";case"soft-light":return"SOFT_LIGHT";case"difference":return"DIFFERENCE";case"exclusion":return"EXCLUSION";case"hue":return"HUE";case"saturation":return"SATURATION";case"color":return"COLOR";case"luminosity":return"LUMINOSITY";default:return"NORMAL"}}function Z(t){if(!t||t==="none"||t==="auto")return"TILE";if(t==="contain")return"FIT";if(t==="cover")return"CROP";const e=t.split(/\s+/);if(e.length>=1){const[r,n]=e;if(r==="100%"&&n==="100%")return"FILL";if(e.length===1)return r==="100%"?"FILL":r==="auto"?"TILE":"CROP";if(e.length>=2){if(n==="auto"&&(r.includes("%")||r.includes("px"))||r==="auto"&&(n.includes("%")||n.includes("px"))||(r.includes("%")||r.includes("px"))&&(n.includes("%")||n.includes("px")))return"CROP";if(r==="auto"&&n==="auto")return"TILE"}}return"FILL"}function ae(t,e=1){let r=1;if(t.opacity&&t.opacity!==""){const n=parseFloat(t.opacity);isNaN(n)||(r=n)}return e!==void 0&&e!==1&&(r=r*e),r}function se(t){if(!t||t==="none")return[];const e=[];let r="",n=0,i=!1,o="";for(let a=0;a<t.length;a++){const s=t[a],u=a>0?t[a-1]:"";if((s==='"'||s==="'")&&u!=="\\"&&(i?s===o&&(i=!1,o=""):(i=!0,o=s)),i||(s==="("?n++:s===")"&&n--),s===","&&!i&&n===0){const c=r.trim();c&&e.push(J(c)),r=""}else r+=s}return r.trim()&&e.push(J(r.trim())),e}function J(t){if(t.includes("linear-gradient")||t.includes("radial-gradient")||t.includes("conic-gradient")||t.includes("repeating-linear-gradient")||t.includes("repeating-radial-gradient"))return{type:"gradient",value:t};if(t.includes("url(")){const e=t.match(/url\(['"]?(.*?)['"]?\)/);if(e&&e[1]){const r=e[1];return r.includes(".svg")||r.includes("data:image/svg+xml")?{type:"svg",value:r}:{type:"image",value:r}}}return t.includes("data:image/")&&!t.includes("data:image/svg+xml")?{type:"image",value:t.trim()}:{type:"unknown",value:t}}async function V(t,e=null,r={}){const{includeImageFills:n=!0,includeBackgroundColor:i=!0,includeComplexBackgrounds:o=!0}=r,a=[];if(o&&lt(t)){if(i&&_(a,t),e)try{const s=await he(e,t,{ignoreBackgroundColor:!0});if(s)return a.push(s),a}catch(s){console.error("❌ [generateFillsFromStyles] 复杂背景转换出错:",s)}return a.length===0&&_(a,t),a}if(n&&e){const s=$t({computedStyle:t,el:e});if(s)return a.push(s),a}if(n||o){const s=t.backgroundImage,u=ie(t.backgroundBlendMode||"");if(s&&s!=="none"){let c=1,l=1;if(e){const f=e.getBoundingClientRect(),p=f.width||1,h=f.height||1;p>=h?(c=1,l=h/p):(c=p/h,l=1)}const d=se(s);if(d.length>0){const f=re(t.backgroundSize||"auto");i&&_(a,t);const p=[];for(let h=d.length-1;h>=0;h--){const b=d[h];let w=null;const y=u.length>0?oe(u[Math.min(h,u.length-1)]):"NORMAL";if(b.type==="gradient"){const E=pe(b.value,c,l);E&&(w={...E,blendMode:y})}else if(b.type==="image"){const E=f[h]||f[f.length-1]||"auto",m=Z(E);w=await Q(b.value,m,null),w&&(w={...w,blendMode:y})}else if(b.type==="svg"){const E=f[h]||f[f.length-1]||"auto",m=Z(E);w=await Q(b.value,m,null),w&&(w={...w,blendMode:y})}w&&p.push(w)}return a.push(...p),a}}}return i&&!de(t)&&!ge(t)&&_(a,t),a}function _(t,e){const r=v(e.backgroundColor);if(r&&r.a>0){const n=ae(e,r.a),i={type:"SOLID",color:{r:r.r,g:r.g,b:r.b},opacity:n};t.push(i)}}function lt(t){const e=t.backgroundImage,r=t.background;if(e&&e!=="none"&&e.includes("conic-gradient")||r&&r!=="none"&&r.includes("conic-gradient")||fe(t))return!0;const n=t.maskImage||t.webkitMaskImage;return!!(n&&n!=="none"||ce(t)||le(t)||ue(t))}function ce(t){const e={top:t.borderTop,right:t.borderRight,bottom:t.borderBottom,left:t.borderLeft};if(!Object.values(e).some(a=>a&&a!=="none"))return!1;const n={};for(const[a,s]of Object.entries(e))if(s&&s!=="none"){const u=s.match(/^([\d\.]+)px\s*(\w+)\s*(.*)$/);if(u){const[c,l,d,f]=u;n[a]={borderWidth:l,borderType:d,borderColor:f}}}else n[a]={borderWidth:"0",borderType:"none",borderColor:"transparent"};const i=Object.values(n).find(a=>a.borderWidth!=="0");return i?!Object.values(n).every(a=>a.borderWidth===i.borderWidth&&a.borderType===i.borderType&&a.borderColor===i.borderColor):!1}function le(t){const e=t.clipPath,r=t.webkitClipPath;return e&&e!=="none"||r&&r!=="none"}function ue(t){const e=t.backgroundImage;if(!e||e==="none")return!1;const r=t.backgroundAttachment;if(r&&r==="fixed")return!0;const n=t.backgroundOrigin;if(n&&n!=="padding-box")return!0;const i=t.backgroundRepeat;if(i&&(i==="repeat-x"||i==="repeat-y"))return!0;const o=t.backgroundPositionX,a=t.backgroundPositionY;if(o&&o!=="0%"&&o!=="left"&&o!=="50%"&&o!=="center"||a&&a!=="0%"&&a!=="top"&&a!=="50%"&&a!=="center")return!0;const c=t.backgroundSize;return!!(c&&c!=="auto"&&c!=="cover"&&c!=="contain"&&c!=="100% 100%"&&c!=="100%"&&(c.includes("px")||c.includes("%")&&!c.startsWith("100%")))}function de(t){const e=t.backgroundImage,r=t.background;return!!(e&&e!=="none"&&(e.includes("linear-gradient")||e.includes("radial-gradient")||e.includes("conic-gradient")||e.includes("repeating-linear-gradient")||e.includes("repeating-radial-gradient"))||r&&r!=="none"&&(r.includes("linear-gradient")||r.includes("radial-gradient")||r.includes("conic-gradient")||r.includes("repeating-linear-gradient")||r.includes("repeating-radial-gradient")))}function fe(t){const e=t.backgroundImage,r=t.background;return!!(e&&e!=="none"&&(e.includes("repeating-linear-gradient")||e.includes("repeating-radial-gradient"))||r&&r!=="none"&&(r.includes("repeating-linear-gradient")||r.includes("repeating-radial-gradient")))}function ge(t){const e=t.backgroundImage,r=t.background;if(e&&e!=="none"&&(e.includes("url(")||e.includes("data:"))){const n=e.match(/url\(['"]?(.*?)['"]?\)/);if(n&&n[1]){const i=n[1];return!(i.includes(".svg")||i.includes("data:image/svg+xml"))}}if(r&&r!=="none"&&(r.includes("url(")||r.includes("data:"))){const n=r.match(/url\(['"]?(.*?)['"]?\)/);if(n&&n[1]){const i=n[1];return!(i.includes(".svg")||i.includes("data:image/svg+xml"))}}return!1}async function he(t,e,r={}){try{const n=t.getBoundingClientRect(),i=4096;if(n.width>i||n.height>i)return null;const{snapdom:o}=await rt(async()=>{const{snapdom:u}=await import("./snapdom-q1ENrNRf.js").then(c=>c.s);return{snapdom:u}},__vite__mapDeps([0,1])),a=t.cloneNode(!0);a.removeAttribute("id");for(let u=0;u<e.length;u++){const c=e[u],l=e.getPropertyValue(c);l&&a.style.setProperty(c,l)}r.ignoreBackgroundColor&&(a.style.backgroundColor="transparent"),a.style.width=`${n.width}px`,a.style.height=`${n.height}px`,a.style.boxSizing="border-box",a.style.margin="0",a.style.position="fixed",a.style.top="0",a.style.left="0",a.style.zIndex="99999",a.style.pointerEvents="none",a.style.visibility="visible",a.style.opacity="1",a.style.color="transparent",a.style.webkitTextFillColor="transparent",a.style.textShadow="none",Array.from(a.children).forEach(u=>{u.style.visibility="hidden"}),document.body.appendChild(a);const s=await o.toPng(a,{compress:!0,fast:!0,embedFonts:!0,scale:1,dpr:1,width:n.width,height:n.height});return document.body.removeChild(a),!s||!s.src?(console.error("❌ [convertElementToBase64Image] snapdom 返回无效的图片元素"),null):{type:"IMAGE",url:s.src,scaleMode:"FILL",imageHash:null}}catch(n){return console.error("❌ [convertElementToBase64Image] 转换失败:",n),null}}function pe(t,e=1,r=1){if(!t)return null;const n=t.replace(/\s+/g," ").trim(),i=n.match(/linear-gradient\s*\((.+)\)/i);if(i)return me(i[1],e,r);const o=n.match(/radial-gradient\s*\((.+)\)/i);return o?be(o[1]):(n.match(/conic-gradient\s*\((.+)\)/i),null)}function me(t,e=1,r=1){const n=ut(t);let i="to bottom",o=[];we(n[0])?(i=n[0],o=n.slice(1)):o=n;const a=dt(o);return a.length?{type:"GRADIENT_LINEAR",gradientTransform:Ee(i,e,r),gradientStops:a,opacity:1,visible:!0,blendMode:"NORMAL"}:null}function be(t){const e=ut(t);let r=[];Ie(e[0])||xe(e[0])?(e[0],r=e.slice(1)):r=e;const n=dt(r);return n.length?{type:"GRADIENT_RADIAL",gradientTransform:Le(),gradientStops:n,opacity:1,visible:!0,blendMode:"NORMAL"}:null}function ut(t){const e=[];let r=0,n=0;for(let i=0;i<t.length;i++){const o=t[i];o==="("?r++:o===")"?r--:o===","&&r===0&&(e.push(t.slice(n,i).trim()),n=i+1)}return e.push(t.slice(n).trim()),e}function we(t){return!!(/to (top|bottom|left|right)/i.test(t)||/\d+deg/i.test(t))}function Ie(t){return/(circle|ellipse)/i.test(t)}function xe(t){return/(center|top|bottom|left|right)/i.test(t)}function dt(t){const e=t.map((i,o)=>{const a=i.trim(),s=a.match(/\s+(\d*\.?\d+%?)\s*$/);let u=a,c;if(s){const d=s[1],f=parseFloat(d);isNaN(f)||(c=d.includes("%")?f/100:f),u=a.substring(0,s.index).trim()}const l=ye(u);return{position:c,color:l}}),r=e.filter(i=>i.position!==void 0),n=e.filter(i=>i.position===void 0);if(n.length>0&&(r.length===0?e.forEach((i,o)=>{i.position=e.length>1?o/(e.length-1):0}):n.forEach((i,o)=>{const a=e.length;i.position=(r.length+o)/(a-1)})),e.sort((i,o)=>(i.position||0)-(o.position||0)),e.forEach(i=>{i.position=Math.max(0,Math.min(1,i.position||0))}),e.length===1){const i=e[0];e.push({position:1,color:{...i.color}}),e[0].position=0}return e.map(i=>({position:i.position,color:i.color}))}function ye(t){const e=v(t);return e||{r:0,g:0,b:0,a:1}}function Ee(t,e=1,r=1){const n={"to top":0,"to top right":45,"to right top":45,"to right":90,"to bottom right":135,"to right bottom":135,"to bottom":180,"to bottom left":225,"to left bottom":225,"to left":270,"to top left":315,"to left top":315};let i;const o=t.trim().toLowerCase();o.endsWith("deg")?i=parseFloat(o):n[o]!==void 0?i=n[o]:i=180;const a=i*Math.PI/180,s=Math.cos(a),u=Math.sin(a);return[[s,-u,.5],[u,s,.5]]}function Le(t,e){return[[.5,0,.5],[0,.5,.5]]}function Re(t){return t?!!(t.includes(".svg")&&!t.includes(".svg?")&&t.split("?")[0].endsWith(".svg")||t.startsWith("data:image/svg+xml")):!1}async function Te(t){var e,r;try{let n="",i="image/svg+xml";if(t.startsWith("data:image/svg+xml"))if(t.includes(";base64,")){const s=t.match(/data:image\/svg\+xml;base64,(.+)/);if(s&&s[1])try{n=atob(s[1])}catch{return null}}else{const s=t.match(/data:image\/svg\+xml,(.+)/);s&&s[1]&&(n=decodeURIComponent(s[1]))}else try{const s=new URL(t,document.baseURI).href,c=typeof chrome<"u"&&((e=chrome==null?void 0:chrome.runtime)==null?void 0:e.sendMessage)?await chrome.runtime.sendMessage({type:"getResourceContent",src:s}):null;if((r=c==null?void 0:c.data)!=null&&r.content){if(n=c.data.content,c.data.base64Encoded)try{n=atob(n)}catch{return null}i=c.data.mimeType||"image/svg+xml"}else{const l=await fetch(s,{method:"GET",mode:"cors"});if(!l.ok)throw new Error(`Failed to load SVG: ${l.statusText}`);n=await l.text()}}catch{const u=new URL(t,document.baseURI).href,c=await fetch(u,{method:"GET",mode:"cors"});if(!c.ok)throw new Error(`Failed to load SVG: ${c.statusText}`);n=await c.text()}if(!n)throw new Error("无法获取 SVG 内容");n=n.replace(/\\"/g,'"').replace(/\\\\/g,"");const o=btoa(unescape(encodeURIComponent(n)));return await G(o,i)}catch(n){return console.error("❌ [convertSvgToPng] SVG 转 PNG 失败:",n),t}}async function Q(t,e="FILL",r=null){let n=t;const i=(t||"").toLowerCase();if(t!=null&&t.startsWith("data:image/webp")){const o=t.split(";base64,")[1];if(o)try{n=await G(o,"image/webp")}catch{}}else if(/\.(webp)(\?|#|$)/i.test(i))try{const o=await Qt(t);o&&(n=o)}catch{}return Re(n)?{type:"IMAGE",url:await Te(n),scaleMode:e,imageHash:r}:{type:"IMAGE",url:n,scaleMode:e,imageHash:r}}function Ce(t,e,r){const n=r.parentElement;if(!n)return;const i=window.getComputedStyle(n),o=i.display;if(!(o==="flex"||o==="inline-flex"||o==="grid"||o==="inline-grid"))return;if((parseFloat(e.flexGrow)||0)>0){t.layoutGrow=1;const l=i.flexDirection||"row";(o==="flex"||o==="inline-flex")&&(l==="row"||l==="row-reverse"?(t.layoutSizingHorizontal="FILL",t.layoutSizingVertical="HUG"):(t.layoutSizingHorizontal="HUG",t.layoutSizingVertical="FILL"))}const u=e.alignSelf||"auto";u==="stretch"?t.layoutAlign="STRETCH":u!=="auto"&&(t.layoutAlign="INHERIT");const c=e.position;(c==="absolute"||c==="fixed")&&(t.layoutPositioning="ABSOLUTE")}const Ae=async({node:t})=>{var e;const r=((e=t.textContent)===null||e===void 0?void 0:e.trim())||"";if(!ve(r))return;if(t.parentElement){const i=t.nodeType===Node.TEXT_NODE?t.parentElement:t;if(!i||i.nodeType!==Node.ELEMENT_NODE||Ne(i))return;const o=document.createRange();o.selectNode(t);const a=Jt(o.getBoundingClientRect());if(o.detach(),!Oe(a))return;const s={x:Math.round(a.left),y:Math.round(a.top),type:"TEXT",characters:r.replace(/\s+/g," "),width:Math.round(a.width),height:Math.round(a.height)},u=window.getComputedStyle(i);let c;if(u.length>0)c=await Me(s,u,i);else{const l=getComputedStyle(i);c=await Fe(s,l,i)}if(c){const l=getComputedStyle(i);k(c,t,l,a),Ce(c,l,i)}return c}};async function Me(t,e,r){const n={...t};if(ft(e)){const s=await V(e,r,{includeImageFills:!1,includeBackgroundColor:!0,includeComplexBackgrounds:!0});s.length>0&&(n.fills=s)}else if(e.color){const s=v(e.color);s&&(n.fills=[{type:"SOLID",color:{r:s.r,g:s.g,b:s.b},opacity:s.a||1}])}if((!n.fills||n.fills.length===0)&&(n.fills=[{type:"SOLID",color:{r:0,g:0,b:0},opacity:1}]),e.opacity&&(n.opacity=parseFloat(e.opacity)),e.fontFamily){const s=e.fontFamily.split(",")[0].trim().replace(/['"]/g,"");n.fontFamily=s}if(e.fontSize){const s=parseFloat(e.fontSize);isNaN(s)||(n.fontSize=Math.round(s))}if(e.fontWeight&&(n.fontWeight=Math.round(e.fontWeight)),e.textAlign){const s=e.textAlign;["left","center","right","justified"].includes(s)&&(n.textAlignHorizontal=s.toUpperCase())}if(["left","center","right","justified"].includes(e.textAlign)&&(n.textAlignHorizontal=e.textAlign.toUpperCase()),e.textDecoration){const s=e.textDecoration;s.includes("underline")?n.textDecoration="UNDERLINE":s.includes("line-through")&&(n.textDecoration="STRIKETHROUGH")}if(ht(r,e)&&e.lineHeight&&e.lineHeight!=="normal"){const s=parseFloat(e.fontSize),u=e.lineHeight==="normal"?s*1.2:parseFloat(e.lineHeight);if(!pt({fontSize:s,lineHeightPx:u,measuredHeight:t.height,text:n.characters||r.textContent||"",tagName:r.tagName,whiteSpace:e.whiteSpace||"normal"})){const l=N(e.lineHeight);l&&(n.lineHeight=l)}}if(e.letterSpacing&&e.letterSpacing!=="normal"){const s=N(e.letterSpacing);s&&(n.letterSpacing=s)}const a=gt(e);return a.length>0&&(n.effects=a),n}function ft(t){const e=t.background&&(t.background.includes("linear-gradient")||t.background.includes("radial-gradient")||t.background.includes("conic-gradient")),r=t.backgroundClip==="text"||t.webkitBackgroundClip==="text",n=t.backgroundImage&&(t.backgroundImage.includes("linear-gradient")||t.backgroundImage.includes("radial-gradient")||t.backgroundImage.includes("conic-gradient"));return e&&r||n&&r}function gt(t){const e=[];return t.textShadow&&t.textShadow!=="none"&&at(t.textShadow).forEach(n=>{const i=v(n.color);if(i){const o={r:i.r,g:i.g,b:i.b,a:i.a||1};e.push({type:"DROP_SHADOW",color:o,offset:{x:n.offsetX,y:n.offsetY},radius:n.blurRadius,spread:0,visible:!0,blendMode:"NORMAL"})}}),e}async function Fe(t,e,r){if(ft(e)){const h=await V(e,r,{includeImageFills:!1,includeBackgroundColor:!0,includeComplexBackgrounds:!0});h.length>0&&(t.fills=h)}else if(e.color){const h=v(e.color);h&&(t.fills=[{type:"SOLID",color:{r:h.r,g:h.g,b:h.b},opacity:h.a||1}])}(!t.fills||t.fills.length===0)&&(t.fills=[{type:"SOLID",color:{r:0,g:0,b:0,a:1},opacity:1}]);const i=N(e.letterSpacing);i&&(t.letterSpacing=i);const o=ht(r,e),a=parseFloat(e.fontSize),s=e.lineHeight==="normal"?a*1.2:parseFloat(e.lineHeight),u=pt({fontSize:a,lineHeightPx:s,measuredHeight:t.height,text:t.characters||r.textContent||"",tagName:r.tagName,whiteSpace:e.whiteSpace||"normal"}),c=o&&!u?N(e.lineHeight):null;c&&(t.lineHeight=c);const{textTransform:l}=e;switch(l){case"uppercase":{t.textCase="UPPER";break}case"lowercase":{t.textCase="LOWER";break}case"capitalize":{t.textCase="TITLE";break}}const d=N(e.fontSize);if(d&&(t.fontSize=Math.round(d.value)),e.fontFamily){const b=e.fontFamily.split(",")[0].trim().replace(/['"]/g,"");t.fontFamily=b}["underline","strikethrough"].includes(e.textDecoration)&&(t.textDecoration=e.textDecoration.toUpperCase()),["left","center","right","justified"].includes(e.textAlign)&&(t.textAlignHorizontal=e.textAlign.toUpperCase());const f=gt(e);f.length>0&&(t.effects=f);const p=st({computedStyle:e,element:r});return Object.assign(t,p),t}function ve(t){return!(!t||t.length===0||/^\s+$/.test(t))}function Oe(t){return!(t.width<=0||t.height<=0||t.width<3||t.height<3||t.width>1e4||t.height>1e4)}function Ne(t){if(["SCRIPT","STYLE","NOSCRIPT","META","LINK","TITLE","HEAD","HTML","BODY","FRAMESET","FRAME","IFRAME"].includes(t.tagName))return!0;const r=window.getComputedStyle(t);return r.display==="none"||r.visibility==="hidden"||t.children.length===0&&(!t.textContent||t.textContent.trim().length===0)}function ht(t,e){const r=t.tagName.toUpperCase(),n=e||getComputedStyle(t);if(r==="BUTTON"||r==="INPUT"||r==="SELECT"||r==="TEXTAREA")return!1;const i=t.textContent;if(!i||i.trim().length===0||!i.includes(`
`)&&n.whiteSpace!=="normal"&&n.whiteSpace!=="pre-wrap"||n.display==="inline-flex"||n.display==="flex")return!1;const a=parseFloat(n.fontSize);if(Number.isNaN(a))return!1;const s=n.lineHeight==="normal"?a*1.2:parseFloat(n.lineHeight);return!(Number.isNaN(s)||Math.abs(s-a)<1)}function pt(t){const{fontSize:e,lineHeightPx:r,measuredHeight:n,text:i,tagName:o,whiteSpace:a}=t,s=(o||"").toUpperCase();if(s==="BUTTON"||s==="INPUT"||s==="SELECT"||s==="TEXTAREA")return!0;if(!e||!r||!n)return!1;const u=!i.includes(`
`)&&a!=="pre-wrap",c=r/e,l=n/r;return!!(u&&(c>2.5&&l<.7||c>2&&l<.9))}function D(t,e,r,n=!1){if(!t||t.length===0)return null;if(t.length===1)return t[0];const i=U(t);let o=1/0,a=1/0,s=-1/0,u=-1/0;if(i.forEach(p=>{p.x!==void 0&&p.y!==void 0&&(o=Math.min(o,p.x),a=Math.min(a,p.y),s=Math.max(s,p.x+(p.width||0)),u=Math.max(u,p.y+(p.height||0)))}),o===1/0||a===1/0)return i[0];const c=n?"FRAME":"GROUP",l={type:c,name:e||c,x:o,y:a,width:s-o,height:u-a,children:[],clipsContent:!1};let d=-1;const f=i[0];if(f&&f.type==="RECTANGLE"&&n){const p=f.width||0,h=f.height||0,b=l.width,w=l.height;Math.abs(f.x-o)<1&&Math.abs(f.y-a)<1&&Math.abs(p-b)<1&&Math.abs(h-w)<1&&(d=0,f.fills&&(l.fills=f.fills),f.strokes&&(l.strokes=f.strokes),f.strokeWeight&&(l.strokeWeight=f.strokeWeight),f.strokeAlign&&(l.strokeAlign=f.strokeAlign),f.effects&&(l.effects=f.effects),f.opacity!==void 0&&(l.opacity=f.opacity),f.blendMode&&(l.blendMode=f.blendMode),f.cornerRadius!==void 0&&(l.cornerRadius=f.cornerRadius),f.topLeftRadius!==void 0&&(l.topLeftRadius=f.topLeftRadius),f.topRightRadius!==void 0&&(l.topRightRadius=f.topRightRadius),f.bottomLeftRadius!==void 0&&(l.bottomLeftRadius=f.bottomLeftRadius),f.bottomRightRadius!==void 0&&(l.bottomRightRadius=f.bottomRightRadius))}if(l.children=i.filter((p,h)=>h!==d).map(p=>p.x!==void 0&&p.y!==void 0?{...p,x:p.x-o,y:p.y-a}:p),r){const p=r.getBoundingClientRect();k(l,r,r.style,p)}return l}async function B(t){var r;const e=[];for(let n=0;n<t.childNodes.length;n++){const i=t.childNodes[n];if(i.nodeType===Node.TEXT_NODE){const o=((r=i.textContent)==null?void 0:r.trim())||"";if(!o||o.length===0||/^\s+$/.test(o))continue;const a=await Ae({node:i});a&&e.push(a)}}return e}function Ge(t,e){const r=i=>i.display==="none"||i.visibility==="hidden"||i.opacity==="0";if(r(t))return!0;let n=e==null?void 0:e.parentElement;for(;n;){const i=getComputedStyle(n);if(r(i)||n.hasAttribute("hidden")||n.classList&&(n.classList.contains("is-hidden")||n.classList.contains("hidden"))||i.overflow!=="visible"&&n.getBoundingClientRect().height<1)return!0;n=n.parentElement}return!1}function mt(t,e){if(e.backgroundClip==="text"||e.webkitBackgroundClip==="text")return!1;const r=e.backgroundColor!=="rgba(0, 0, 0, 0)"&&e.backgroundColor!=="transparent"||e.borderWidth!=="0px"&&e.borderWidth!==""||e.boxShadow!=="none"&&e.boxShadow!==""||e.borderRadius!=="0px"&&e.borderRadius!==""||e.opacity!=="1"&&e.opacity!==""||e.transform!=="none"&&e.transform!==""&&e.transform!=="matrix(1, 0, 0, 1, 0, 0)"||e.filter!=="none"&&e.filter!==""||e.backdropFilter!=="none"&&e.backdropFilter!=="",n=e.padding!=="0px"&&e.padding!==""||e.margin!=="0px"&&e.margin!==""||e.width!=="auto"&&e.width!==""||e.height!=="auto"&&e.height!=="",i=e.backgroundImage!=="none"&&e.backgroundImage!=="";return r||n||i}function Pe(t){function e(r){if(r.nodeType!==Node.ELEMENT_NODE&&r.nodeType!==Node.TEXT_NODE)return null;const n=r.shadowRoot?Array.from(r.shadowRoot.childNodes):[],o=[...Array.from(r.childNodes),...n];return{type:r.nodeType===Node.ELEMENT_NODE?"element":"text",el:r,children:o.map(a=>e(a)).filter(Boolean)}}return e(t)}function O(t,e=!1){const r=t.tagName.toLowerCase();if(e&&t.hasAttribute("data-label")){const i=t.getAttribute("data-label");if(i&&i.trim())return`${r}.${i.trim()}`}if(t.id&&t.id.trim())return`${r}.${t.id.trim()}`;const n=t.className&&t.className.trim()?t.className.trim().split(/\s+/)[0]:null;return n?`${r}.${n}`:r}async function He(t,e=!1,r=!1){const n=[];if(t instanceof SVGSVGElement){if(t.id!=="snapdom-injected-svg"){const c=await vt(t);n.push(c)}return n}else if(t instanceof SVGElement)return n;if(t.parentElement instanceof HTMLPictureElement&&t instanceof HTMLSourceElement||t instanceof HTMLPictureElement)return n;const i=window.getComputedStyle(t),o=["absolute","fixed"].includes(i.position);if(Ge(i,t)){const c=await B(t);return n.push(...c),n.length>1?[D(n,O(t,e),t,r)]:n}let a=!1;if(mt(t,i)?a=!0:a=(t instanceof HTMLImageElement||t instanceof HTMLVideoElement)&&i.display!=="none",a){const c=Ot(t);if(c.width>=1&&c.height>=1){const l=await V(i,t),d=i.borderWidth!=="0px"&&i.borderWidth!=="",f=i.boxShadow!=="none"&&i.boxShadow!=="",p=i.borderRadius!=="0px"&&i.borderRadius!=="",h=i.opacity!=="1"&&i.opacity!=="",b=i.transform!=="none"&&i.transform!=="",w=(parseFloat(i.paddingTop)||0)>0||(parseFloat(i.paddingRight)||0)>0||(parseFloat(i.paddingBottom)||0)>0||(parseFloat(i.paddingLeft)||0)>0||(parseFloat(i.paddingInlineStart)||0)>0||(parseFloat(i.paddingInlineEnd)||0)>0||(parseFloat(i.paddingBlockStart)||0)>0||(parseFloat(i.paddingBlockEnd)||0)>0;if(l.length===0&&!d&&!f&&!p&&!h&&!b&&!w){const g=await B(t);return n.push(...g),n.length>1?[D(n,O(t,e),t,r)]:n}const y={type:"RECTANGLE",name:O(t,e),x:Math.round(c.left),y:Math.round(c.top),width:Math.round(c.width),height:Math.round(c.height),fills:l};if(o&&(y.layoutPositioning="ABSOLUTE"),k(y,t,i,c),!lt(i)){const g=Bt({computedStyle:i});g&&Object.assign(y,g)}(t instanceof HTMLImageElement||t instanceof HTMLVideoElement||t instanceof SVGSVGElement)&&(y.name=O(t,e));const m=St({computedStyle:i});m&&(y.effects=m);const I=st({computedStyle:i,element:t});Object.assign(y,I),n.push(y)}}const u=await B(t);if(n.push(...u),n.length>1){const c=D(n,O(t,e),t,r);if(o&&c&&(c.layoutPositioning="ABSOLUTE"),(parseFloat(i.flexGrow)||0)>0){c.layoutGrow=1;const d=t.parentElement?window.getComputedStyle(t.parentElement).display:"",f=t.parentElement?window.getComputedStyle(t.parentElement).flexDirection:"";(d==="flex"||d==="inline-flex")&&(f==="row"||f==="row-reverse"?(c.layoutSizingHorizontal="FILL",c.layoutSizingVertical="HUG"):(c.layoutSizingHorizontal="HUG",c.layoutSizingVertical="FILL"))}return[c]}if(n.length===1&&(o&&(n[0].layoutPositioning="ABSOLUTE"),(parseFloat(i.flexGrow)||0)>0)){n[0].layoutGrow=1;const l=t.parentElement?window.getComputedStyle(t.parentElement).display:"",d=t.parentElement?window.getComputedStyle(t.parentElement).flexDirection:"";(l==="flex"||l==="inline-flex")&&(d==="row"||d==="row-reverse"?(n[0].layoutSizingHorizontal="FILL",n[0].layoutSizingVertical="HUG"):(n[0].layoutSizingHorizontal="HUG",n[0].layoutSizingVertical="FILL"))}return n}const T=!1;function _e(t){try{if(t&&t!==document.body&&t!==document.documentElement){const y=t.getBoundingClientRect(),E=t.scrollWidth,m=t.scrollHeight,I=t.clientWidth,g=t.clientHeight,x=Math.max(y.width,E,I),C=Math.max(y.height,m,g);if(x>0&&C>0)return{width:x,height:C}}const e=document.documentElement.scrollWidth,r=document.documentElement.scrollHeight,n=document.body.scrollWidth,i=document.body.scrollHeight,o=t?t.querySelectorAll("*"):document.querySelectorAll("body *");let a=0,s=0,u=1/0,c=1/0;o.forEach(y=>{if(y.offsetParent===null)return;const E=y.getBoundingClientRect();if(E.width===0&&E.height===0)return;const m=E.left+window.scrollX,I=E.top+window.scrollY,g=E.right+window.scrollX,x=E.bottom+window.scrollY;g>0&&x>0&&(a=Math.max(a,g),s=Math.max(s,x),u=Math.min(u,m),c=Math.min(c,I))});const l=document.body.getBoundingClientRect(),d=l.width,f=l.height,p=a-(u===1/0?0:u),h=s-(c===1/0?0:c),b=Math.max(e,n,p,d),w=Math.max(r,i,h,f);if(b<=0||w<=0)throw new Error("主要方法计算出无效尺寸");return{width:b,height:w}}catch{const r=window.innerWidth,n=window.innerHeight,i=document.documentElement.clientWidth,o=document.documentElement.clientHeight,a=document.body.clientWidth,s=document.body.clientHeight,u=Math.max(r,i,a),c=Math.max(n,o,s);return{width:u,height:c}}}async function ke(t={}){const{targetElement:e,filter:r}=t;try{const n=e||document.body,i=_e(n),o=i.width,a=i.height,{snapdom:s}=await rt(async()=>{const{snapdom:I}=await import("./snapdom-q1ENrNRf.js").then(g=>g.s);return{snapdom:I}},__vite__mapDeps([0,1])),u=n.querySelectorAll("img"),c=Array.from(u).filter(I=>I.src.startsWith("data:")),l=Date.now(),d=await s.toBlob(n,{fast:!0,embedFonts:!0,scale:1,dpr:1,format:"svg",filter:typeof r=="function"?r:void 0}),f=Date.now()-l,p=await d.text(),b=new DOMParser().parseFromString(p,"image/svg+xml"),w=b.documentElement;if(w.tagName.toLowerCase()!=="svg")throw console.error("❌ [generatePageSvg] 解析的不是有效的 SVG:",w.tagName),new Error("解析的SVG无效");const y=w.getAttribute("width"),E=w.getAttribute("height"),m=w.getAttribute("viewBox");return{svgBlob:d,svgText:p,svgDoc:b,svgRoot:w,pageWidth:o,pageHeight:a}}catch(n){throw console.error("❌ [generatePageSvg] SVG生成失败:",n),console.error("❌ [generatePageSvg] 错误堆栈:",n.stack),n}}function De(t){try{const e=t.svgRoot.cloneNode(!0);e.style.cssText=`
      position: absolute;
      left: 0;
      top: 0;
      z-index: 999999;
      pointer-events: none;
    `,e.id="snapdom-injected-svg";let r=document.getElementById("snapdom-shadow-host");return r||(r=document.createElement("div"),r.id="snapdom-shadow-host",r.style.cssText=`
        position: fixed;
        left: 0;
        top: 0;
        width: 0;
        height: 0;
        z-index: 999999;
        pointer-events: none;
      `,r.attachShadow({mode:"open"}),document.body.appendChild(r)),(r.shadowRoot||r.attachShadow({mode:"open"})).appendChild(e),e}catch(e){throw console.error("❌ [SnapDOM] SVG注入失败:",e),e}}function tt(){try{const t=document.getElementById("snapdom-shadow-host");if(t){t.remove();return}}catch(t){console.warn("⚠️ [SnapDOM] SVG清理失败:",t)}}const A={LESS_THAN_TWO_VISIBLE_CHILDREN:"LESS_THAN_TWO_VISIBLE_CHILDREN",OUT_OF_FLOW_CHILD:"OUT_OF_FLOW_CHILD",CHILDREN_OVERLAP:"CHILDREN_OVERLAP",GRID_TEMPLATE_AREAS:"GRID_TEMPLATE_AREAS",EXPLICIT_GRID_PLACEMENT:"EXPLICIT_GRID_PLACEMENT",IMPLICIT_GRID_FIXED_DIMS:"IMPLICIT_GRID_FIXED_DIMS",FLEX_WRAP_WITH_CHILD_MARGINS:"FLEX_WRAP_WITH_CHILD_MARGINS",VISUAL_ORDER_MISMATCH:"VISUAL_ORDER_MISMATCH",NEGATIVE_MARGIN_USED:"NEGATIVE_MARGIN_USED",MARGIN_VARIANCE_HIGH:"MARGIN_VARIANCE_HIGH",TRANSFORM_LAYOUT_HACK:"TRANSFORM_LAYOUT_HACK"};function bt(t,e,r){const n=[],i=[],o=[];for(const m of r){const I=m.getBoundingClientRect(),g=window.getComputedStyle(m);g.display!=="none"&&g.visibility!=="hidden"&&I.width>0&&I.height>0&&o.push({element:m,rect:I,style:g})}const a=e.display;if(o.length<2){if(o.length===0)return o.map(I=>I.element),n.push(A.LESS_THAN_TWO_VISIBLE_CHILDREN),{deny:!0,reasons:n,warnings:i};if(!et(e,a,o).hasValue)return o.map(I=>I.element),n.push(A.LESS_THAN_TWO_VISIBLE_CHILDREN),{deny:!0,reasons:n,warnings:i}}if(o.length===2&&!et(e,a,o).hasValue)return o.map(I=>I.element),n.push("TWO_CHILDREN_NO_LAYOUT_VALUE"),{deny:!0,reasons:n,warnings:i};let s=!1,u=!1,c=!1,l=!1;const d=e.flexWrap||"nowrap",f=(a==="flex"||a==="inline-flex")&&(d==="wrap"||d==="wrap-reverse"),p=e.gap||"0px",h=parseFloat(e.rowGap)||0,b=parseFloat(e.columnGap)||0,w=p!=="0px"&&p!=="normal"||h>0||b>0,y=f&&!w;for(const{style:m}of o){if(!s&&(m.position==="absolute"||m.position==="fixed")&&(s=!0),!u&&Ue(m)&&(u=!0),!c){const I=m.transform;I&&I!=="none"&&I.includes("translate")&&(c=!0)}if(y&&!l){const I=parseFloat(m.marginBottom)||0,g=parseFloat(m.marginTop)||0,x=parseFloat(m.marginLeft)||0,C=parseFloat(m.marginRight)||0,M=parseFloat(m.marginInlineStart)||0,L=parseFloat(m.marginInlineEnd)||0,F=parseFloat(m.marginBlockStart)||0,R=parseFloat(m.marginBlockEnd)||0;(I>1||g>1||x>1||C>1||M>1||L>1||F>1||R>1)&&(l=!0)}if(s&&u&&c&&(!y||l))break}if(s)return o.map(m=>m.element),n.push(A.OUT_OF_FLOW_CHILD),{deny:!0,reasons:n,warnings:i};if(Be(o))return o.map(m=>m.element),n.push(A.CHILDREN_OVERLAP),{deny:!0,reasons:n,warnings:i};if(l)return o.map(m=>m.element),n.push(A.FLEX_WRAP_WITH_CHILD_MARGINS),{deny:!0,reasons:n,warnings:i};if(a==="grid"||a==="inline-grid"){const m=e.gridTemplateAreas;if(m&&m!=="none")return o.map(L=>L.element),n.push(A.GRID_TEMPLATE_AREAS),{deny:!0,reasons:n,warnings:i};if(o.some(({style:L})=>{const F=L.gridRowStart,R=L.gridColumnStart;return F&&F!=="auto"||R&&R!=="auto"}))return o.map(L=>L.element),n.push(A.EXPLICIT_GRID_PLACEMENT),{deny:!0,reasons:n,warnings:i};const g=e.gridTemplateColumns,x=e.gridTemplateRows,C=g&&g!=="none"?g.split(" ").filter(L=>L.trim()).length:0,M=x&&x!=="none"?x.split(" ").filter(L=>L.trim()).length:0;(C>1||M>1)&&o.length>=6&&i.push(`${A.IMPLICIT_GRID_FIXED_DIMS}: container appears to be an implicit grid with cols=${C}, rows=${M}`)}if(!We(o))return o.map(m=>m.element),n.push(A.VISUAL_ORDER_MISMATCH),{deny:!0,reasons:n,warnings:i};if(u)return o.map(m=>m.element),n.push(A.NEGATIVE_MARGIN_USED),{deny:!0,reasons:n,warnings:i};const E=Ve(o);return E.relativeStdDev>1.2&&E.mean>0&&i.push(`${A.MARGIN_VARIANCE_HIGH}: mean=${E.mean.toFixed(2)}, relStdDev=${E.relativeStdDev.toFixed(2)}`),c?(o.map(m=>m.element),n.push(A.TRANSFORM_LAYOUT_HACK),{deny:!0,reasons:n,warnings:i}):{deny:!1,reasons:n,warnings:i}}function et(t,e,r){const n=[],i=e==="flex"||e==="inline-flex",o=e==="grid"||e==="inline-grid";if(i){const h=t.justifyContent||"normal",b=t.alignItems||"normal";h!=="normal"&&h!=="flex-start"&&h!=="start"&&n.push(`justify-content: ${h}`),b!=="normal"&&b!=="stretch"&&n.push(`align-items: ${b}`)}if(o){const h=t.justifyItems||"normal",b=t.alignItems||"normal",w=t.justifyContent||"normal";h!=="normal"&&h!=="stretch"&&h!=="legacy"&&n.push(`justify-items: ${h}`),b!=="normal"&&b!=="stretch"&&n.push(`align-items: ${b}`),w!=="normal"&&w!=="start"&&n.push(`justify-content: ${w}`)}const a=t.gap||"0px",s=parseFloat(t.rowGap)||0,u=parseFloat(t.columnGap)||0;a!=="0px"&&a!=="normal"?n.push(`gap: ${a}`):(s>0||u>0)&&n.push(`row-gap: ${s}px, column-gap: ${u}px`);const c=parseFloat(t.paddingTop)||0,l=parseFloat(t.paddingRight)||0,d=parseFloat(t.paddingBottom)||0,f=parseFloat(t.paddingLeft)||0;if(c+l+d+f>8&&n.push(`padding: ${c}/${l}/${d}/${f}`),i){const h=t.flexDirection||"row";(h==="column"||h==="column-reverse")&&n.push(`flex-direction: ${h}`)}if(i){const h=t.flexWrap||"nowrap";(h==="wrap"||h==="wrap-reverse")&&n.push(`flex-wrap: ${h}`)}if(o){const h=t.gridTemplateColumns||"none",b=t.gridTemplateRows||"none";h!=="none"&&n.push(`grid-template-columns: ${h}`),b!=="none"&&n.push(`grid-template-rows: ${b}`)}return i&&r.length>0&&r.some(({style:b})=>(parseFloat(b.flexGrow)||0)>0)&&n.push("child has flex-grow"),r.length>0&&r.some(({style:b})=>(b.alignSelf||"auto")!=="auto")&&n.push("child has align-self"),{hasValue:n.length>0,reasons:n}}function Be(t,e=1){const r=t.map(n=>n.rect);for(let n=0;n<r.length;n++)for(let i=n+1;i<r.length;i++)if(Se(r[n],r[i],e))return!0;return!1}function Se(t,e,r=1){return!(t.x+t.width<=e.x+r||e.x+e.width<=t.x+r||t.y+t.height<=e.y+r||e.y+e.height<=t.y+r)}function We(t){if(t.length<2)return!0;const e=t.map(s=>s.rect),r=Math.max(...e.map(s=>s.x+s.width))-Math.min(...e.map(s=>s.x)),n=Math.max(...e.map(s=>s.y+s.height))-Math.min(...e.map(s=>s.y)),i=r>=n,a=t.map((s,u)=>({idx:u,rect:s.rect})).slice().sort((s,u)=>i?Math.abs(s.rect.y-u.rect.y)>4?s.rect.y-u.rect.y:s.rect.x-u.rect.x:Math.abs(s.rect.x-u.rect.x)>4?s.rect.x-u.rect.x:s.rect.y-u.rect.y);for(let s=0;s<a.length;s++)if(a[s].idx!==s)return!1;return!0}function Ue(t){const e=parseFloat(t.marginTop)<0||parseFloat(t.marginRight)<0||parseFloat(t.marginBottom)<0||parseFloat(t.marginLeft)<0,r=parseFloat(t.marginInlineStart)<0||parseFloat(t.marginInlineEnd)<0||parseFloat(t.marginBlockStart)<0||parseFloat(t.marginBlockEnd)<0;return e||r}function Ve(t){if(t.length<2)return{mean:0,stdDev:0,relativeStdDev:0};const e=t.map(d=>d.rect),r=Math.max(...e.map(d=>d.x+d.width))-Math.min(...e.map(d=>d.x)),n=Math.max(...e.map(d=>d.y+d.height))-Math.min(...e.map(d=>d.y)),i=r>=n,a=t.map((d,f)=>({idx:f,rect:d.rect})).sort((d,f)=>i?Math.abs(d.rect.y-f.rect.y)>4?d.rect.y-f.rect.y:d.rect.x-f.rect.x:Math.abs(d.rect.x-f.rect.x)>4?d.rect.x-f.rect.x:d.rect.y-f.rect.y),s=[];for(let d=0;d<a.length-1;d++){const f=a[d].rect,p=a[d+1].rect,h=i?p.x-(f.x+f.width):p.y-(f.y+f.height);s.push(h)}if(s.length===0)return{mean:0,stdDev:0,relativeStdDev:0};const u=s.reduce((d,f)=>d+f,0)/s.length,c=Math.sqrt(s.reduce((d,f)=>d+Math.pow(f-u,2),0)/s.length),l=u===0?c>0?1/0:0:c/Math.abs(u);return{mean:u,stdDev:c,relativeStdDev:l}}function ze(t,e){if(!t||!e)return!1;const r=e.display;return r==="flex"||r==="inline-flex"||r==="grid"||r==="inline-grid"}function $e(t){switch(t.flexDirection||"row"){case"column":case"column-reverse":return"VERTICAL";case"row":case"row-reverse":default:return"HORIZONTAL"}}function je(t){const e=t.gridTemplateRows||"none",r=t.gridTemplateColumns||"none";e==="none"||e.split(" ").length;const n=r==="none"?0:r.split(" ").length;return n>1?{layoutMode:"GRID",gridColumns:n}:{layoutMode:"VERTICAL"}}function Xe(t){switch(t){case"flex-start":case"start":return{align:"MIN",needsEdgePadding:!1,edgePaddingRatio:0};case"center":return{align:"CENTER",needsEdgePadding:!1,edgePaddingRatio:0};case"flex-end":case"end":return{align:"MAX",needsEdgePadding:!1,edgePaddingRatio:0};case"space-between":return{align:"SPACE_BETWEEN",needsEdgePadding:!1,edgePaddingRatio:0};case"space-around":return{align:"SPACE_BETWEEN",needsEdgePadding:!0,edgePaddingRatio:.5};case"space-evenly":return{align:"SPACE_BETWEEN",needsEdgePadding:!0,edgePaddingRatio:1};default:return{align:"MIN",needsEdgePadding:!1,edgePaddingRatio:0}}}function Ye(t){switch(t){case"flex-start":case"start":return"MIN";case"center":return"CENTER";case"flex-end":case"end":return"MAX";case"baseline":return"BASELINE";case"stretch":return"MIN";default:return"MIN"}}function qe(t){switch(t){case"start":case"flex-start":case"self-start":return"MIN";case"center":return"CENTER";case"end":case"flex-end":case"self-end":return"MAX";case"left":return"MIN";case"right":return"MAX";case"stretch":return"MIN";default:return"MIN"}}function Ke(t,e){const r=t.gap;if(r&&r!=="normal"&&r!=="0px"){const n=r.split(" ");return n.length===2?parseFloat(e==="HORIZONTAL"?n[1]:n[0])||0:parseFloat(r)||0}if(e==="HORIZONTAL"){const n=t.columnGap||t.gridColumnGap;return parseFloat(n)||0}else{const n=t.rowGap||t.gridRowGap;return parseFloat(n)||0}}function Ze(t,e){const r=t.gap;if(r&&r!=="normal"&&r!=="0px"){const n=r.split(" ");return n.length===2?parseFloat(e==="HORIZONTAL"?n[0]:n[1])||0:parseFloat(r)||0}if(e==="HORIZONTAL"){const n=t.rowGap||t.gridRowGap;return parseFloat(n)||0}else{const n=t.columnGap||t.gridColumnGap;return parseFloat(n)||0}}function Je(t){const e=parseFloat(t.paddingTop)||parseFloat(t.paddingBlockStart)||0,r=parseFloat(t.paddingRight)||parseFloat(t.paddingInlineEnd)||0,n=parseFloat(t.paddingBottom)||parseFloat(t.paddingBlockEnd)||0,i=parseFloat(t.paddingLeft)||parseFloat(t.paddingInlineStart)||0;return{paddingTop:e,paddingRight:r,paddingBottom:n,paddingLeft:i}}function Qe(t){const e=t.flexWrap||"nowrap";return e==="wrap"||e==="wrap-reverse"?"WRAP":"NO_WRAP"}function tn(t,e){if(!ze(t,e))return null;const r=Array.from(t.children).filter(g=>g instanceof HTMLElement);if(bt(t,e,r).deny)return null;const i=e.display,o=i==="grid"||i==="inline-grid";let a,s;if(o){const g=je(e);a=g.layoutMode,s=g.gridColumns}else a=$e(e);const u=Ke(e,a),c=Ze(e,a),l=Je(e);if(h.needsEdgePadding&&u>0){const g=u*h.edgePaddingRatio;a==="HORIZONTAL"?(l.paddingLeft+=g,l.paddingRight+=g):a==="VERTICAL"&&(l.paddingTop+=g,l.paddingBottom+=g)}const d=e.justifyContent||"flex-start",f=e.alignItems||"stretch",p=e.justifyItems||"",h=Xe(d),b=h.align;let w=Ye(f);p&&p!=="legacy"&&p!=="normal"&&(w=qe(p));const y=a==="GRID"?void 0:o?"WRAP":Qe(e);let E="AUTO",m="AUTO";if(a==="HORIZONTAL"){const g=e.width;g&&g!=="auto"&&(g.includes("%")&&parseFloat(g)===100||g.includes("px"))&&(E="FIXED");const x=e.height;x&&x!=="auto"&&x.includes("px")&&(m="FIXED")}else if(a==="VERTICAL"){const g=e.height;g&&g!=="auto"&&(g.includes("%")&&parseFloat(g)===100||g.includes("px"))&&(E="FIXED");const x=e.width;x&&x!=="auto"&&x.includes("px")&&(m="FIXED")}const I={layoutMode:a,primaryAxisSizingMode:E,counterAxisSizingMode:m,primaryAxisAlignItems:b,counterAxisAlignItems:w,itemSpacing:u,...l,layoutPositioning:"AUTO"};if(y!==void 0&&(I.layoutWrap=y,y==="WRAP"&&(I.counterAxisSpacing=c||0)),a==="GRID"&&s){I.gridColumnCount=s;const g=parseFloat(e.rowGap||e.gridRowGap)||0,x=parseFloat(e.columnGap||e.gridColumnGap)||0;I.gridColumnGap=x,I.gridRowGap=g}return I}const nt="export-overlay-root";function en(t){return t instanceof Element?!!(t.id===nt||typeof t.closest=="function"&&t.closest(`#${nt}`)):!1}function wt(t){if(!(t instanceof Element))return!1;try{const e=t.style,r=e.overflowX,n=e.overflowY;return r==="hidden"||n==="hidden"}catch{return!1}}function nn(t,e,r,n=null,i=!1){var I;if(!t||t.length===0)return null;const o=()=>{};if(o("start createFrameFromLayers",{layerCount:t.length,firstLayer:t[0]?{type:t[0].type,name:t[0].name,width:t[0].width,height:t[0].height}:null}),t.length===1&&!n)return t[0];const a=U(t),s=a.filter(g=>g.layoutPositioning!=="ABSOLUTE"&&g.layoutPositioning!=="FIXED"),u=s.length>0?s:a,c=g=>{let x=Number.POSITIVE_INFINITY,C=Number.POSITIVE_INFINITY,M=Number.NEGATIVE_INFINITY,L=Number.NEGATIVE_INFINITY,F=0;for(const R of g)typeof R.x=="number"&&typeof R.y=="number"&&typeof R.width=="number"&&typeof R.height=="number"&&(x=Math.min(x,R.x),C=Math.min(C,R.y),M=Math.max(M,R.x+R.width),L=Math.max(L,R.y+R.height),F+=1);return F===0?null:{x,y:C,width:M-x,height:L-C}};let l=null;const d=[];for(const g of u)if(g.type==="RECTANGLE"&&!l){l=g;break}let f,p,h,b;if(l){const g=c(u),x=(I=r==null?void 0:r.getBoundingClientRect)==null?void 0:I.call(r),C=typeof l.name=="string"&&typeof e=="string"&&l.name===e;if(g){const M=l.width>=g.width*.9,L=l.height>=g.height*.9,F=l.x<=g.x+1,R=l.y<=g.y+1,It=l.x+l.width>=g.x+g.width-1,xt=l.y+l.height>=g.y+g.height-1,yt=l.width*l.height>=g.width*g.height*.8,Et=!!x&&Math.abs(l.width-x.width)<=2&&Math.abs(l.height-x.height)<=2&&Math.abs(l.x-x.x)<=2&&Math.abs(l.y-x.y)<=2,Lt=M&&L&&F&&R&&It&&xt&&yt;o("background coverage check",{bgName:l.name,bgSize:{w:l.width,h:l.height}}),!Lt&&!Et&&!C&&(o("background rejected, fallback to element bounding rect",{bgName:l.name}),l=null)}}if(l){f=l.x,p=l.y,h=l.width,b=l.height,o("use backgroundLayer as frame basis",{bgName:l.name,bgType:l.type});for(const g of a)g!==l&&d.push(g)}else{const g=r.getBoundingClientRect();f=g.x,p=g.y,h=g.width,b=g.height,d.push(...a)}let w=d.map(g=>g.x!==void 0&&g.y!==void 0?{...g,x:g.x-f,y:g.y-p}:g);const y=wt(r),E=i?"FRAME":"GROUP",m={type:E,name:e||E,x:f,y:p,width:h,height:b,clipsContent:y,children:[]};if(o("frameLayer created",{name:m.name,x:m.x,y:m.y,width:m.width,height:m.height,childCount:w.length}),l){const g=l.fills&&l.fills.some(x=>x.type==="IMAGE");!i&&g?(o("GROUP mode with image fill, keeping background as separate layer",{bgName:l.name}),w.unshift({...l,x:0,y:0})):(l.fills&&l.fills.length>0&&(m.fills=l.fills),l.strokes&&(m.strokes=l.strokes),l.strokeWeight!==void 0&&(m.strokeWeight=l.strokeWeight),l.strokeAlign!==void 0&&(m.strokeAlign=l.strokeAlign),l.cornerRadius!==void 0&&(m.cornerRadius=l.cornerRadius),l.topLeftRadius!==void 0&&(m.topLeftRadius=l.topLeftRadius,m.topRightRadius=l.topRightRadius,m.bottomLeftRadius=l.bottomLeftRadius,m.bottomRightRadius=l.bottomRightRadius),l.effects&&l.effects.length>0&&(m.effects=l.effects),l.opacity!==void 0&&l.opacity!==1&&(m.opacity=l.opacity))}else i&&(m.fills=[{type:"SOLID",color:{r:1,g:1,b:1},opacity:0}]);if(m.children=w,n&&Object.assign(m,n),r){const g=r.getBoundingClientRect();k(m,r,r.style,g)}return m}const rn=async(t,e)=>{const{useFrames:r,rootName:n,isAxure:i,widgetId:o,enableAutoLayout:a=!0}=e,s=t.className,u="figma-target-element";try{await ne(t),t.classList.add(u);const c=await ke({targetElement:t,filter:p=>!en(p)}),l=De(c);let d=l.querySelector(`.${u}`);d||(d=l.querySelector("body")),d||(d=l);const f=await on(d,{useFrames:r,rootName:n,isAxure:i,widgetId:o,size:{width:c.pageWidth,height:c.pageHeight},isSnapdomProcessing:!0,enableAutoLayout:a});return tt(),t.className=s,f}catch(c){console.error("❌ [processWithSnapDOM] SnapDOM 方案失败:",c),t.className=s;try{tt()}catch{}return null}};async function W(t,e=!1,r=!1,n=!0){const i=[];if(!t)return i;if(t.type==="element"){const o=await He(t.el,r,n);if(t.el instanceof SVGSVGElement&&t.el.id!=="snapdom-injected-svg")return o;const a=wt(t.el);let s=!1,u=null,c=null,l=!1;try{if(c=window.getComputedStyle(t.el),n){const h=tn(t.el,c);if(h!==null){const b=t.children.filter(y=>y.type==="element").map(y=>y.el);bt(t.el,c,b).deny?(u=null,s=!1):(u=h,s=!0)}}const p=c.display;t.children&&t.children.length>2&&p&&!["inline","inline-block","inline-flex","inline-grid"].includes(p)&&(l=!0)}catch{}let d=!1;if(t.children&&t.children.length>0){const p=c||(()=>{try{return window.getComputedStyle(t.el)}catch{return t.el.style}})();try{d=mt(t.el,p)}catch{}}if(!c&&t.children&&t.children.length>0&&(l=!0),(e||a||s||d||l)&&n){const p=[];for(const b of t.children){const w=await W(b,e||s,r,n);p.push(...w)}const h=[...o,...p];if(h.length>0){const b=nn(h,O(t.el,r),t.el,u,n);b&&i.push(b)}return i}else i.push(...o)}if(!e)for(const o of t.children){const a=await W(o,e,r,n);i.push(...a)}return i}const on=async(t,e)=>{const{useFrames:r,rootName:n,size:i,isAxure:o=!1,widgetId:a,enableAutoLayout:s=!0}=e;Rt(t);const u=Pe(t),c=await W(u,r,o,s),l=U(c),d={type:"FRAME",name:n||"FRAME",widgetId:a||null,width:i.width||Math.round(t.scrollWidth),height:i.height||Math.round(t.scrollHeight),x:0,y:0,children:l};return Zt([d])};async function sn(t="body",e){const{useFrames:r=!1,rootName:n,isAxure:i=!1,widgetId:o,enableAutoLayout:a=!0}=e,s=t instanceof HTMLElement?t:document.querySelector(t||"body");return s?rn(s,{useFrames:r,rootName:n,isAxure:i,widgetId:o,enableAutoLayout:a}):[]}export{sn as htmlToFigma,on as processWithOriginalLogic};
